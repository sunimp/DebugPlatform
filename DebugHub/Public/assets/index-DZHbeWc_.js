var Dr=Object.defineProperty;var Mr=(t,s,r)=>s in t?Dr(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r;var ve=(t,s,r)=>Mr(t,typeof s!="symbol"?s+"":s,r);import{r as u,a as _t,u as At,b as Rs,L as ye,c as Rr,d as Or,B as Pr,e as Fr,f as ze,R as zr}from"./vendor-C1y34kgY.js";import{c as ae}from"./zustand-DNIvzKHV.js";import{p as _r,a as He}from"./protobuf-NWeOYLG2.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=r(a);fetch(a.href,i)}})();var Os={exports:{}},mt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ar=u,Br=Symbol.for("react.element"),$r=Symbol.for("react.fragment"),Hr=Object.prototype.hasOwnProperty,Wr=Ar.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ur={key:!0,ref:!0,__self:!0,__source:!0};function Ps(t,s,r){var n,a={},i=null,o=null;r!==void 0&&(i=""+r),s.key!==void 0&&(i=""+s.key),s.ref!==void 0&&(o=s.ref);for(n in s)Hr.call(s,n)&&!Ur.hasOwnProperty(n)&&(a[n]=s[n]);if(t&&t.defaultProps)for(n in s=t.defaultProps,s)a[n]===void 0&&(a[n]=s[n]);return{$$typeof:Br,type:t,key:i,ref:o,props:a,_owner:Wr.current}}mt.Fragment=$r;mt.jsx=Ps;mt.jsxs=Ps;Os.exports=mt;var e=Os.exports,Lt={},ts=_t;Lt.createRoot=ts.createRoot,Lt.hydrateRoot=ts.hydrateRoot;const We=ae(t=>({isServerOnline:!0,isRealtimeConnected:!1,isInDeviceDetail:!1,setServerOnline:s=>t({isServerOnline:s}),setRealtimeConnected:s=>t({isRealtimeConnected:s}),setInDeviceDetail:s=>t({isInDeviceDetail:s}),get isConnected(){return!1},setConnected:s=>t({isRealtimeConnected:s})}));let $e=null;function Vr(){if($e)return;const t=async()=>{try{const s=await fetch("/api/health",{headers:{Accept:"application/json"}});We.getState().setServerOnline(s.ok)}catch{We.getState().setServerOnline(!1)}};t(),$e=setInterval(t,1e4)}function qr(){$e&&(clearInterval($e),$e=null)}const q="/api";async function J(t,s){const r=await fetch(t,{headers:{"Content-Type":"application/json",Accept:"application/json",...s==null?void 0:s.headers},...s});if(!r.ok)throw new Error(`HTTP ${r.status}: ${r.statusText}`);const n=await r.text();if(n)return JSON.parse(n)}const tt={get:t=>J(t),post:(t,s)=>J(t,{method:"POST",body:s!==void 0?JSON.stringify(s):void 0}),put:(t,s)=>J(t,{method:"PUT",body:s!==void 0?JSON.stringify(s):void 0}),delete:t=>J(t,{method:"DELETE"})};async function Yr(){return J(`${q}/devices`)}async function Gr(t){return J(`${q}/devices/${t}`)}async function Nt(t,s,r,n,a){await fetch(`${q}/devices/${t}/control/toggle-capture`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({network:s,log:r,websocket:n,database:a})})}async function Jr(t){await fetch(`${q}/devices/${t}/data`,{method:"DELETE"})}async function Qr(t){const s=await fetch(`${q}/devices/${t}`,{method:"DELETE"});if(!s.ok){const r=await s.text();throw new Error(r||"Failed to remove device")}}async function Kr(){if(!(await fetch(`${q}/devices/offline`,{method:"DELETE"})).ok)throw new Error("Failed to remove offline devices")}async function Xr(t,s=50){return J(`${q}/devices/${t}/sessions?limit=${s}`)}async function Zr(t,s={}){const r=new URLSearchParams;s.page&&r.set("page",String(s.page)),s.pageSize&&r.set("pageSize",String(s.pageSize)),s.method&&r.set("method",s.method),s.statusCode&&r.set("statusCode",String(s.statusCode)),s.urlContains&&r.set("urlContains",s.urlContains),s.isMocked!==void 0&&r.set("isMocked",String(s.isMocked)),s.timeFrom&&r.set("timeFrom",s.timeFrom),s.timeTo&&r.set("timeTo",s.timeTo);const n=r.toString();return J(`${q}/devices/${t}/http${n?`?${n}`:""}`)}async function en(t,s){return J(`${q}/devices/${t}/http/${s}`)}async function tn(t,s){return J(`${q}/devices/${t}/http/${s}/curl`)}async function sn(t,s){return J(`${q}/devices/${t}/http/${s}/replay`,{method:"POST"})}async function rn(t,s){return J(`${q}/devices/${t}/http/batch/delete`,{method:"POST",body:JSON.stringify({ids:s})})}async function nn(){await fetch(`${q}/cleanup/truncate`,{method:"POST"})}async function an(t){return J(`${q}/auth/verify`,{method:"POST",body:JSON.stringify({token:t})})}async function on(t,s={}){var a;const r=new URLSearchParams;s.page&&r.set("page",String(s.page)),s.pageSize&&r.set("pageSize",String(s.pageSize)),s.level&&r.set("level",s.level),(a=s.levels)!=null&&a.length&&r.set("levels",s.levels.join(",")),s.subsystem&&r.set("subsystem",s.subsystem),s.category&&r.set("category",s.category),s.loggerName&&r.set("loggerName",s.loggerName),s.text&&r.set("text",s.text),s.traceId&&r.set("traceId",s.traceId),s.timeFrom&&r.set("timeFrom",s.timeFrom),s.timeTo&&r.set("timeTo",s.timeTo);const n=r.toString();return J(`${q}/devices/${t}/logs${n?`?${n}`:""}`)}async function ln(t){return J(`${q}/devices/${t}/logs/subsystems`)}async function cn(t){return J(`${q}/devices/${t}/logs/categories`)}async function dn(t,s){await fetch(`${q}/devices/${t}/logs/batch-delete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:s})})}async function un(t,s={}){const r=new URLSearchParams;s.page&&r.set("page",String(s.page)),s.pageSize&&r.set("pageSize",String(s.pageSize)),s.urlContains&&r.set("urlContains",s.urlContains),s.host&&r.set("host",s.host),s.isOpen!==void 0&&r.set("isOpen",String(s.isOpen)),s.timeFrom&&r.set("timeFrom",s.timeFrom),s.timeTo&&r.set("timeTo",s.timeTo);const n=r.toString();return J(`${q}/devices/${t}/ws-sessions${n?`?${n}`:""}`)}async function Fs(t,s){return J(`${q}/devices/${t}/ws-sessions/${s}`)}async function ss(t,s,r={}){const n=new URLSearchParams;r.page&&n.set("page",String(r.page)),r.pageSize&&n.set("pageSize",String(r.pageSize)),r.direction&&n.set("direction",r.direction);const a=n.toString();return J(`${q}/devices/${t}/ws-sessions/${s}/frames${a?`?${a}`:""}`)}async function xn(t,s,r){return J(`${q}/devices/${t}/ws-sessions/${s}/frames/${r}`)}async function mn(t,s){return J(`${q}/devices/${t}/ws-sessions/batch/delete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:s})})}async function zs(t){return J(`${q}/devices/${t}/mock-rules`)}async function hn(t,s){return J(`${q}/devices/${t}/mock-rules`,{method:"POST",body:JSON.stringify(s)})}async function rs(t,s,r){return J(`${q}/devices/${t}/mock-rules/${s}`,{method:"PUT",body:JSON.stringify(r)})}async function _s(t,s){await fetch(`${q}/devices/${t}/mock-rules/${s}`,{method:"DELETE"})}async function pn(t){const s=await zs(t);await Promise.all(s.map(r=>_s(t,r.id)))}function ns(t,s="json"){return`${q}/devices/${t}/export/logs?format=${s}`}function fn(t,s="json"){return`${q}/devices/${t}/export/http?format=${s}`}function gn(t,s){const r=new URLSearchParams;s&&s.length>0&&r.set("ids",s.join(","));const n=r.toString();return`${q}/devices/${t}/export/har${n?`?${n}`:""}`}async function As(t){return J(`${q}/devices/${t}/breakpoints`)}async function bn(t,s){return J(`${q}/devices/${t}/breakpoints`,{method:"POST",body:JSON.stringify(s)})}async function as(t,s,r){return J(`${q}/devices/${t}/breakpoints/${s}`,{method:"PUT",body:JSON.stringify(r)})}async function Bs(t,s){await fetch(`${q}/devices/${t}/breakpoints/${s}`,{method:"DELETE"})}async function yn(t){const s=await As(t);await Promise.all(s.map(r=>Bs(t,r.id)))}async function $s(t){return J(`${q}/devices/${t}/breakpoints/pending`)}async function Hs(t,s,r){await fetch(`${q}/devices/${t}/breakpoints/resume/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})}async function Ws(t){return J(`${q}/devices/${t}/chaos`)}async function jn(t,s){return J(`${q}/devices/${t}/chaos`,{method:"POST",body:JSON.stringify(s)})}async function is(t,s,r){return J(`${q}/devices/${t}/chaos/${s}`,{method:"PUT",body:JSON.stringify(r)})}async function Us(t,s){await fetch(`${q}/devices/${t}/chaos/${s}`,{method:"DELETE"})}async function vn(t){const s=await Ws(t);await Promise.all(s.map(r=>Us(t,r.id)))}async function wn(t){return J(`${q}/devices/${t}/databases`)}async function Nn(t,s){return J(`${q}/devices/${t}/databases/${s}/tables`)}async function kn(t,s,r){return J(`${q}/devices/${t}/databases/${s}/tables/${r}/schema`)}async function kt(t,s,r,n){const a=new URLSearchParams;n!=null&&n.page&&a.set("page",n.page.toString()),n!=null&&n.pageSize&&a.set("pageSize",n.pageSize.toString()),n!=null&&n.orderBy&&a.set("orderBy",n.orderBy),(n==null?void 0:n.ascending)!==void 0&&a.set("ascending",n.ascending.toString());const i=a.toString(),o=`${q}/devices/${t}/databases/${s}/tables/${r}/rows${i?"?"+i:""}`;return J(o)}async function Cn(t,s,r){return J(`${q}/devices/${t}/databases/${s}/query`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:r})})}async function En(){return J(`${q}/stats`)}const Oe=ae((t,s)=>({rules:[],deviceRules:[],isLoading:!1,fetchRules:async()=>{t({isLoading:!0});try{const r=await tt.get("/api/traffic-rules");t({rules:r})}catch(r){console.error("Failed to fetch traffic rules",r)}finally{t({isLoading:!1})}},fetchDeviceRules:async r=>{t({isLoading:!0});try{const n=await tt.get(`/api/devices/${r}/traffic-rules`);t({deviceRules:n})}catch(n){console.error("Failed to fetch device traffic rules",n)}finally{t({isLoading:!1})}},createOrUpdateRule:async r=>{try{const n=await tt.post("/api/traffic-rules",r);t(a=>{let i=a.rules;a.rules.some(l=>l.id===n.id)?i=a.rules.map(l=>l.id===n.id?n:l):i=[n,...a.rules];let o=a.deviceRules;return a.deviceRules.some(l=>l.id===n.id)?o=a.deviceRules.map(l=>l.id===n.id?n:l):(n.deviceId===null||r.deviceId&&a.deviceRules.some(l=>l.deviceId===r.deviceId))&&(o=[n,...a.deviceRules]),{rules:i,deviceRules:o}})}catch(n){throw console.error("Failed to save traffic rule",n),n}},deleteRule:async r=>{try{await tt.delete(`/api/traffic-rules/${r}`),t(n=>({rules:n.rules.filter(a=>a.id!==r),deviceRules:n.deviceRules.filter(a=>a.id!==r)}))}catch(n){throw console.error("Failed to delete traffic rule",n),n}},getDomainRule:(r,n)=>{const{deviceRules:a,rules:i}=s();return(n?a:i).find(l=>l.isEnabled&&l.matchType==="domain"&&l.matchValue===r&&(n?l.deviceId===n||l.deviceId===null:!0))},matchRule:(r,n)=>{const{deviceRules:a,rules:i}=s();return(n?a:i).find(l=>{if(!l.isEnabled)return!1;if(l.matchType==="domain")try{return new URL(r.url).hostname===l.matchValue}catch{return!1}if(l.matchType==="urlRegex")try{return new RegExp(l.matchValue).test(r.url)}catch{return!1}return l.matchType==="header",!1})}}));function Vs(t,s){let r;try{r=t()}catch{return}return{getItem:a=>{var i;const o=c=>c===null?null:JSON.parse(c,void 0),l=(i=r.getItem(a))!=null?i:null;return l instanceof Promise?l.then(o):o(l)},setItem:(a,i)=>r.setItem(a,JSON.stringify(i,void 0)),removeItem:a=>r.removeItem(a)}}const Dt=t=>s=>{try{const r=t(s);return r instanceof Promise?r:{then(n){return Dt(n)(r)},catch(n){return this}}}catch(r){return{then(n){return this},catch(n){return Dt(n)(r)}}}},Tn=(t,s)=>(r,n,a)=>{let i={storage:Vs(()=>localStorage),partialize:g=>g,version:0,merge:(g,v)=>({...v,...g}),...s},o=!1;const l=new Set,c=new Set;let d=i.storage;if(!d)return t((...g)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),r(...g)},n,a);const x=()=>{const g=i.partialize({...n()});return d.setItem(i.name,{state:g,version:i.version})},h=a.setState;a.setState=(g,v)=>(h(g,v),x());const j=t((...g)=>(r(...g),x()),n,a);a.getInitialState=()=>j;let y;const p=()=>{var g,v;if(!d)return;o=!1,l.forEach(D=>{var T;return D((T=n())!=null?T:j)});const f=((v=i.onRehydrateStorage)==null?void 0:v.call(i,(g=n())!=null?g:j))||void 0;return Dt(d.getItem.bind(d))(i.name).then(D=>{if(D)if(typeof D.version=="number"&&D.version!==i.version){if(i.migrate){const T=i.migrate(D.state,D.version);return T instanceof Promise?T.then(W=>[!0,W]):[!0,T]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,D.state];return[!1,void 0]}).then(D=>{var T;const[W,H]=D;if(y=i.merge(H,(T=n())!=null?T:j),r(y,!0),W)return x()}).then(()=>{f==null||f(y,void 0),y=n(),o=!0,c.forEach(D=>D(y))}).catch(D=>{f==null||f(void 0,D)})};return a.persist={setOptions:g=>{i={...i,...g},g.storage&&(d=g.storage)},clearStorage:()=>{d==null||d.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>p(),hasHydrated:()=>o,onHydrate:g=>(l.add(g),()=>{l.delete(g)}),onFinishHydration:g=>(c.add(g),()=>{c.delete(g)})},i.skipHydration||p(),y||j},Bt=Tn,Sn={getItem:t=>localStorage.getItem(t),setItem:(t,s)=>{localStorage.setItem(t,s)},removeItem:t=>{localStorage.removeItem(t)}},ht=ae()(Bt((t,s)=>({favoriteUrlsMap:{},isFavorite:(r,n)=>{const a=s().favoriteUrlsMap[r];if(!a||!Array.isArray(a))return!1;const i=st(n);return a.includes(i)},toggleFavorite:(r,n)=>{const a=st(n),i=s().favoriteUrlsMap[r]||[];let o,l;const c=i.indexOf(a);return c>=0?(o=[...i.slice(0,c),...i.slice(c+1)],l=!1):(o=[...i,a],l=!0),t(d=>({favoriteUrlsMap:{...d.favoriteUrlsMap,[r]:o}})),l},addFavorite:(r,n)=>{const a=st(n);t(i=>{const o=i.favoriteUrlsMap[r]||[];return o.includes(a)?i:{favoriteUrlsMap:{...i.favoriteUrlsMap,[r]:[...o,a]}}})},removeFavorite:(r,n)=>{const a=st(n);t(i=>{const o=i.favoriteUrlsMap[r]||[],l=o.indexOf(a);return l<0?i:{favoriteUrlsMap:{...i.favoriteUrlsMap,[r]:[...o.slice(0,l),...o.slice(l+1)]}}})},clearFavorites:r=>{t(n=>({favoriteUrlsMap:{...n.favoriteUrlsMap,[r]:[]}}))},getFavoriteUrls:r=>{const n=s().favoriteUrlsMap[r];return Array.isArray(n)?[...n]:[]}}),{name:"debug-hub-favorite-urls",storage:Vs(()=>Sn)}));function st(t){try{const s=new URL(t);return`${s.protocol}//${s.host}${s.pathname}`}catch{return t}}function Ue(t){return t.type==="session-divider"}function fe(t,s,r){const n=ht.getState().isFavorite;return t.filter(a=>{if(Ue(a))return!1;const i=a;if(s.method&&i.method!==s.method)return!1;if(s.statusRange&&i.statusCode){const[o,l]=s.statusRange.split("-").map(Number);if(i.statusCode<o||i.statusCode>l)return!1}if(s.urlContains&&!i.url.toLowerCase().includes(s.urlContains.toLowerCase())||s.mockedOnly&&!i.isMocked||s.favoritesOnly&&!(r?n(r,i.url):i.isFavorite))return!1;if(s.domains&&s.domains.length>0)try{const o=new URL(i.url);if(!s.domains.includes(o.hostname))return!1}catch{return!1}if(!s.showBlacklisted){const o=Oe.getState().matchRule(i);if(o&&o.action==="hide")return!1}return!0})}const $t=ae((t,s)=>({events:[],listItems:[],filteredItems:[],selectedEventId:null,selectedEvent:null,total:0,page:1,pageSize:100,isLoading:!1,autoScroll:!0,selectedIds:new Set,isSelectMode:!1,currentSessionId:null,currentDeviceId:null,groupMode:"none",filters:{method:"",statusRange:"",urlContains:"",mockedOnly:!1,favoritesOnly:!1,domains:[],showBlacklisted:!1},fetchEvents:async r=>{const{pageSize:n,filters:a}=s();t({isLoading:!0,currentDeviceId:r});try{const i=await Zr(r,{pageSize:n,method:a.method||void 0,urlContains:a.urlContains||void 0,isMocked:a.mockedOnly?!0:void 0}),o=i.items,l=fe(o,a,r);t({events:o,listItems:o,filteredItems:l,total:i.total,page:i.page,isLoading:!1}),s().fetchSessionHistory(r)}catch(i){console.error("Failed to fetch HTTP events:",i),t({isLoading:!1})}},fetchSessionHistory:async r=>{},selectEvent:async(r,n)=>{if(!n){t({selectedEventId:null,selectedEvent:null});return}t({selectedEventId:n});try{const a=await en(r,n);t({selectedEvent:a})}catch(a){console.error("Failed to fetch HTTP event detail:",a)}},clearSelection:()=>{t({selectedEventId:null,selectedEvent:null})},addRealtimeEvent:r=>{t(n=>{const a=[r,...n.events].slice(0,1e3),i=[r,...n.listItems].slice(0,1e3),o=fe(i,n.filters,n.currentDeviceId??void 0);return{events:a,listItems:i,filteredItems:o,total:n.total+1}})},clearEvents:()=>{t({events:[],listItems:[],filteredItems:[],total:0,selectedEventId:null,selectedEvent:null,selectedIds:new Set,currentSessionId:null})},addSessionDivider:(r,n)=>{},setFilter:(r,n)=>{t(a=>{const i={...a.filters,[r]:n},o=fe(a.listItems,i,a.currentDeviceId??void 0);return{filters:i,filteredItems:o}})},toggleDomain:r=>{t(n=>{const a=n.filters.domains,i=a.includes(r)?a.filter(c=>c!==r):[...a,r],o={...n.filters,domains:i},l=fe(n.listItems,o,n.currentDeviceId??void 0);return{filters:o,filteredItems:l}})},clearDomains:()=>{t(r=>{const n={...r.filters,domains:[]},a=fe(r.listItems,n,r.currentDeviceId??void 0);return{filters:n,filteredItems:a}})},applyFilters:()=>{t(r=>({filteredItems:fe(r.listItems,r.filters,r.currentDeviceId??void 0)}))},setAutoScroll:r=>{t({autoScroll:r})},setGroupMode:r=>{t({groupMode:r})},updateEventFavorite:(r,n)=>{t(a=>{var c;const i=a.events.map(d=>d.id===r?{...d,isFavorite:n}:d),o=a.listItems.map(d=>!Ue(d)&&d.id===r?{...d,isFavorite:n}:d),l=fe(o,a.filters,a.currentDeviceId??void 0);return{events:i,listItems:o,filteredItems:l,selectedEvent:((c=a.selectedEvent)==null?void 0:c.id)===r?{...a.selectedEvent,isFavorite:n}:a.selectedEvent}})},toggleSelectMode:()=>{t(r=>({isSelectMode:!r.isSelectMode,selectedIds:r.isSelectMode?new Set:r.selectedIds}))},toggleSelectId:r=>{t(n=>{const a=new Set(n.selectedIds);return a.has(r)?a.delete(r):a.add(r),{selectedIds:a}})},selectAll:()=>{t(r=>{const n=r.filteredItems.filter(o=>!Ue(o)),a=new Set(n.map(o=>o.id));return{selectedIds:r.selectedIds.size===a.size&&[...r.selectedIds].every(o=>a.has(o))?new Set:a}})},clearSelectedIds:()=>{t({selectedIds:new Set})},batchDelete:async r=>{const{selectedIds:n,events:a}=s();if(n.size!==0)try{await rn(r,Array.from(n)),t({events:a.filter(i=>!n.has(i.id)),selectedIds:new Set,total:s().total-n.size})}catch(i){console.error("Failed to batch delete:",i)}},batchFavorite:async(r,n)=>{const{selectedIds:a,events:i,listItems:o,filters:l,currentDeviceId:c}=s();if(a.size!==0)try{const{addFavorite:d,removeFavorite:x}=ht.getState(),h=i.filter(y=>a.has(y.id));for(const y of h)n?d(r,y.url):x(r,y.url);const j=fe(o,l,c??void 0);return t({filteredItems:j}),a.size}catch(d){throw console.error("Failed to batch favorite:",d),d}}})),Mt={verbose:0,debug:1,info:2,warning:3,error:4};function In(t){const s={};if(!t.trim())return s;const r=[{field:"level",pattern:/level:(>=)?(\w+)/gi},{field:"subsystem",pattern:/subsystem:("([^"]+)"|(\S+))/gi},{field:"category",pattern:/category:("([^"]+)"|(\S+))/gi},{field:"message",pattern:/message:("([^"]+)"|(\S+))/gi},{field:"traceId",pattern:/traceId:(\S+)/gi},{field:"file",pattern:/file:("([^"]+)"|(\S+))/gi},{field:"function",pattern:/function:("([^"]+)"|(\S+))/gi},{field:"timestampFrom",pattern:/timestamp:>(\S+)/gi},{field:"timestampTo",pattern:/timestamp:<(\S+)/gi}];let n=t;for(const{field:i,pattern:o}of r){let l;for(;(l=o.exec(t))!==null;)switch(n=n.replace(l[0],""),i){case"level":{const c=l[1]===">=",d=l[2].toLowerCase();Mt[d]!==void 0&&(c?s.minLevel=d:s.level=d);break}case"subsystem":s.subsystem=l[2]||l[3];break;case"category":s.category=l[2]||l[3];break;case"message":{const c=l[2]||l[3];s.message=c;try{s.messageRegex=new RegExp(c,"i")}catch{}break}case"traceId":s.traceId=l[1];break;case"file":s.file=l[2]||l[3];break;case"function":s.function=l[2]||l[3];break;case"timestampFrom":{const c=new Date(l[1]);isNaN(c.getTime())||(s.timestampFrom=c);break}case"timestampTo":{const c=new Date(l[1]);isNaN(c.getTime())||(s.timestampTo=c);break}}}const a=n.trim();return a&&(s.freeText=a),s}function Ln(t,s,r="verbose"){const n=s.minLevel||s.level||r,a=Mt[n];return t.filter(i=>{var l,c,d,x;const o=Mt[i.level]??0;if(s.level&&i.level!==s.level||o<a||s.subsystem&&i.subsystem!==s.subsystem||s.category&&i.category!==s.category)return!1;if(s.message){if(s.messageRegex){if(!s.messageRegex.test(i.message))return!1}else if(!i.message.toLowerCase().includes(s.message.toLowerCase()))return!1}if(s.traceId&&i.traceId!==s.traceId||s.file&&i.file&&!i.file.toLowerCase().includes(s.file.toLowerCase())||s.function&&i.function&&!i.function.toLowerCase().includes(s.function.toLowerCase()))return!1;if(s.timestampFrom||s.timestampTo){const h=new Date(i.timestamp);if(s.timestampFrom&&h<s.timestampFrom||s.timestampTo&&h>s.timestampTo)return!1}if(s.freeText){const h=s.freeText.toLowerCase(),j=i.message.toLowerCase().includes(h),y=(l=i.subsystem)==null?void 0:l.toLowerCase().includes(h),p=(c=i.category)==null?void 0:c.toLowerCase().includes(h),g=(d=i.file)==null?void 0:d.toLowerCase().includes(h),v=(x=i.function)==null?void 0:x.toLowerCase().includes(h);if(!j&&!y&&!p&&!g&&!v)return!1}return!0})}const Dn=`
支持的搜索语法:
• level:error - 精确匹配级别
• level:>=warning - 显示 warning 及以上级别
• subsystem:Network - 匹配 subsystem
• category:API - 匹配 category
• message:"error message" - 搜索消息内容
• traceId:xxx - 匹配 traceId
• file:ViewController - 匹配文件名
• function:viewDidLoad - 匹配函数名
• timestamp:>2025-12-05T10:00:00 - 时间范围
• 直接输入文本搜索消息内容
`.trim(),os={verbose:0,debug:1,info:2,warning:3,error:4};function Mn(t,s){const r=os[s.minLevel];return t.filter(n=>!((os[n.level]??0)<r||s.subsystem&&n.subsystem!==s.subsystem||s.category&&n.category!==s.category||s.text&&!s.searchQuery&&!n.message.toLowerCase().includes(s.text.toLowerCase())||s.traceId&&n.traceId!==s.traceId))}function we(t,s){let r=Mn(t,s);if(s.searchQuery){const n=In(s.searchQuery);r=Ln(r,n,s.minLevel)}return r}const qs=ae((t,s)=>({events:[],filteredEvents:[],total:0,page:1,pageSize:500,isLoading:!1,autoScroll:!0,selectedIds:new Set,isSelectMode:!1,subsystems:[],categories:[],filters:{minLevel:"verbose",subsystem:"",category:"",text:"",traceId:"",searchQuery:""},fetchEvents:async r=>{const{pageSize:n}=s();t({isLoading:!0});try{const a=await on(r,{pageSize:n}),{filters:i}=s(),o=we(a.items,i);t({events:a.items,filteredEvents:o,total:a.total,page:a.page,isLoading:!1})}catch(a){console.error("Failed to fetch log events:",a),t({isLoading:!1})}},fetchFilterOptions:async r=>{try{const[n,a]=await Promise.all([ln(r),cn(r)]);t({subsystems:n,categories:a})}catch(n){console.error("Failed to fetch filter options:",n)}},addRealtimeEvent:r=>{t(n=>{const a=[r,...n.events].slice(0,5e3),i=we(a,n.filters);return{events:a,filteredEvents:i,total:n.total+1}})},clearEvents:()=>{t({events:[],filteredEvents:[],total:0})},setFilter:(r,n)=>{t(a=>{const i={...a.filters,[r]:n},o=we(a.events,i);return{filters:i,filteredEvents:o}})},setMinLevel:r=>{t(n=>{const a={...n.filters,minLevel:r},i=we(n.events,a);return{filters:a,filteredEvents:i}})},setSearchQuery:r=>{t(n=>{const a={...n.filters,searchQuery:r},i=we(n.events,a);return{filters:a,filteredEvents:i}})},applyFilters:()=>{t(r=>({filteredEvents:we(r.events,r.filters)}))},setAutoScroll:r=>{t({autoScroll:r})},toggleSelectMode:()=>{t(r=>({isSelectMode:!r.isSelectMode,selectedIds:r.isSelectMode?new Set:r.selectedIds}))},toggleSelectId:r=>{t(n=>{const a=new Set(n.selectedIds);return a.has(r)?a.delete(r):a.add(r),{selectedIds:a}})},selectAll:()=>{t(r=>{const n=new Set(r.filteredEvents.map(i=>i.id));return{selectedIds:r.selectedIds.size===n.size&&[...r.selectedIds].every(i=>n.has(i))?new Set:n}})},clearSelectedIds:()=>{t({selectedIds:new Set})},batchDelete:async r=>{const{selectedIds:n,events:a,filters:i}=s();if(n.size!==0)try{await dn(r,Array.from(n));const o=a.filter(l=>!n.has(l.id));t({events:o,filteredEvents:we(o,i),selectedIds:new Set,total:s().total-n.size})}catch(o){throw console.error("Failed to batch delete logs:",o),o}}})),Ys="debug-hub-favorite-devices",Rn=()=>{try{const t=localStorage.getItem(Ys);if(t)return new Set(JSON.parse(t))}catch(t){console.error("Failed to load favorite devices:",t)}return new Set},On=t=>{try{localStorage.setItem(Ys,JSON.stringify([...t]))}catch(s){console.error("Failed to save favorite devices:",s)}},pt=ae((t,s)=>({devices:[],currentDeviceId:null,currentDevice:null,isLoading:!1,error:null,favoriteDeviceIds:Rn(),fetchDevices:async()=>{t({isLoading:!0,error:null});try{const r=await Yr();t({devices:r,isLoading:!1})}catch(r){t({error:r.message,isLoading:!1})}},selectDevice:async r=>{t({currentDeviceId:r,isLoading:!0,error:null});try{const n=await Gr(r);t({currentDevice:n,isLoading:!1})}catch(n){t({error:n.message,isLoading:!1})}},clearSelection:()=>{t({currentDeviceId:null,currentDevice:null})},toggleCapture:async(r,n)=>{const{currentDeviceId:a,currentDevice:i}=s();if(!(!a||!i))try{await Nt(a,r,n,i.deviceInfo.wsCaptureEnabled,i.deviceInfo.dbInspectorEnabled)}catch(o){t({error:o.message})}},toggleWebSocketCapture:async r=>{const{currentDeviceId:n,currentDevice:a}=s();if(!(!n||!a))try{await Nt(n,a.deviceInfo.captureEnabled,a.deviceInfo.logCaptureEnabled,r,a.deviceInfo.dbInspectorEnabled)}catch(i){t({error:i.message})}},toggleDatabaseInspector:async r=>{const{currentDeviceId:n,currentDevice:a}=s();if(!(!n||!a))try{await Nt(n,a.deviceInfo.captureEnabled,a.deviceInfo.logCaptureEnabled,a.deviceInfo.wsCaptureEnabled,r)}catch(i){t({error:i.message})}},clearDeviceData:async()=>{const{currentDeviceId:r}=s();if(r)try{await Jr(r),await Promise.all([pn(r),yn(r),vn(r)]),$t.getState().clearEvents(),qs.getState().clearEvents()}catch(n){t({error:n.message})}},removeDevice:async r=>{try{await Qr(r),t(n=>({devices:n.devices.filter(a=>a.deviceId!==r)}))}catch(n){throw t({error:n.message}),n}},removeAllOfflineDevices:async()=>{try{await Kr(),t(r=>({devices:r.devices.filter(n=>n.isOnline)}))}catch(r){throw t({error:r.message}),r}},toggleFavorite:r=>{const{favoriteDeviceIds:n}=s(),a=new Set(n);a.has(r)?a.delete(r):a.add(r),On(a),t({favoriteDeviceIds:a})},isFavorite:r=>s().favoriteDeviceIds.has(r)})),Gs=ae((t,s)=>({sessions:[],totalSessions:0,sessionsLoading:!1,sessionsError:null,selectedSessionId:null,selectedSession:null,sessionLoading:!1,frames:[],totalFrames:0,framesLoading:!1,framesError:null,filters:{page:1,pageSize:50},framePage:1,framePageSize:100,frameDirection:"",autoScroll:!0,isSelectMode:!1,selectedIds:new Set,fetchSessions:async r=>{t({sessionsLoading:!0,sessionsError:null});try{const n=await un(r,s().filters);t({sessions:n.items,totalSessions:n.total,sessionsLoading:!1})}catch(n){console.error("[wsStore] fetchSessions error:",n),t({sessionsLoading:!1,sessionsError:n instanceof Error?n.message:"加载失败"})}},selectSession:async(r,n)=>{t({selectedSessionId:n,sessionLoading:!0,frames:[],totalFrames:0});try{const[a]=await Promise.all([Fs(r,n),s().fetchFrames(r,n)]);t({selectedSession:a,sessionLoading:!1})}catch{t({sessionLoading:!1})}},fetchFrames:async(r,n)=>{t({framesLoading:!0,framesError:null,framePage:1});try{const a=await ss(r,n,{page:1,pageSize:s().framePageSize,direction:s().frameDirection||void 0});t({frames:a.items,totalFrames:a.total,framesLoading:!1})}catch(a){t({framesLoading:!1,framesError:a instanceof Error?a.message:"加载失败"})}},loadMoreFrames:async(r,n)=>{const{framePage:a,framePageSize:i,frames:o,totalFrames:l}=s();if(!(o.length>=l)){t({framesLoading:!0});try{const c=await ss(r,n,{page:a+1,pageSize:i,direction:s().frameDirection||void 0});t({frames:[...o,...c.items],framePage:a+1,framesLoading:!1})}catch{t({framesLoading:!1})}}},setFilter:(r,n)=>{t(a=>({filters:{...a.filters,[r]:n}}))},setFrameDirection:r=>{t({frameDirection:r})},clearSelection:()=>{t({selectedSessionId:null,selectedSession:null,frames:[],totalFrames:0})},clearSessions:()=>{t({sessions:[],totalSessions:0,selectedSessionId:null,selectedSession:null,frames:[],totalFrames:0})},setAutoScroll:r=>{t({autoScroll:r})},addRealtimeSession:r=>{t(n=>n.sessions.some(a=>a.id===r.id)?n:{sessions:[r,...n.sessions],totalSessions:n.totalSessions+1})},updateSessionStatus:(r,n,a,i)=>{t(o=>{var l;return{sessions:o.sessions.map(c=>c.id===r?{...c,isOpen:n,closeCode:a??c.closeCode,closeReason:i??c.closeReason}:c),selectedSession:((l=o.selectedSession)==null?void 0:l.id)===r?{...o.selectedSession,closeCode:a??null,closeReason:i??null}:o.selectedSession}})},updateSessionUrl:(r,n)=>{t(a=>({sessions:a.sessions.map(i=>i.id===r?{...i,url:n}:i)}))},addRealtimeFrame:r=>{const{selectedSessionId:n}=s();r.sessionId===n&&t(a=>({frames:[...a.frames,r],totalFrames:a.totalFrames+1}))},toggleSelectMode:()=>{t(r=>({isSelectMode:!r.isSelectMode,selectedIds:r.isSelectMode?new Set:r.selectedIds}))},toggleSelectId:r=>{t(n=>{const a=new Set(n.selectedIds);return a.has(r)?a.delete(r):a.add(r),{selectedIds:a}})},selectAll:()=>{t(r=>{const n=new Set(r.sessions.map(i=>i.id));return{selectedIds:r.selectedIds.size===r.sessions.length?new Set:n}})},clearSelectedIds:()=>{t({selectedIds:new Set})},batchDelete:async r=>{const{selectedIds:n,sessions:a}=s();if(n.size!==0)try{await mn(r,Array.from(n)),t({sessions:a.filter(i=>!n.has(i.id)),selectedIds:new Set,totalSessions:s().totalSessions-n.size,selectedSessionId:n.has(s().selectedSessionId??"")?null:s().selectedSessionId,selectedSession:n.has(s().selectedSessionId??"")?null:s().selectedSession})}catch(i){console.error("Failed to batch delete WS sessions:",i)}}})),S={size:20,strokeWidth:1.5},me=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:r}),e.jsx("path",{d:"M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})]}),ke=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M9 12l-4-4.5M15 12l4-4.5M9 12v8M15 12v8M9 12h6",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M5 7.5L3 9M19 7.5L21 9",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})]}),je=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M14 2v6h6M16 13H8M16 17H8M10 9H8",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})]}),Ht=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:r}),e.jsx("path",{d:"M10 15V9M14 15V9",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})]}),ce=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M12 2a10 10 0 0 1 10 10 10 10 0 0 1-10 10 10 10 0 0 1-10-10 10 10 0 0 1 10-10z",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M8 14s1.5 2 4 2 4-2 4-2M9 9h.01M15 9h.01",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})]}),Ve=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M12 9v4M12 17h.01",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})]}),qe=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",stroke:"currentColor",strokeWidth:r}),e.jsx("path",{d:"M21 12c0 1.66-4 3-9 3s-9-1.34-9-3",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round"}),e.jsx("path",{d:"M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round"})]}),de=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"5",y:"2",width:"14",height:"20",rx:"3",stroke:"currentColor",strokeWidth:r}),e.jsx("path",{d:"M9 2h6",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round"}),e.jsx("path",{d:"M10 19h4",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round"})]}),Pn=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"2",y:"3",width:"20",height:"18",rx:"2",stroke:"currentColor",strokeWidth:r}),e.jsx("path",{d:"M12 17h.01",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round"})]}),Fn=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",stroke:"currentColor",strokeWidth:r}),e.jsx("path",{d:"M8 21h8M12 17v4",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round"})]}),zn=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"6",y:"5",width:"12",height:"14",rx:"4",stroke:"currentColor",strokeWidth:r}),e.jsx("path",{d:"M9 2v3M15 2v3M9 19v3M15 19v3",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round"})]}),_n=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"2",y:"7",width:"20",height:"12",rx:"2",stroke:"currentColor",strokeWidth:r}),e.jsx("path",{d:"M12 7V3M8 3h8",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round"})]}),An=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",stroke:"currentColor",strokeWidth:r}),e.jsx("path",{d:"M8 21h8M12 17v4",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round"}),e.jsx("rect",{x:"9",y:"5",width:"6",height:"10",rx:"1",stroke:"currentColor",strokeWidth:r})]}),ft=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M3 3v5h5",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M21 21v-5h-5",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})]}),Pe=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M10 11v6M14 11v6",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})]}),Bn=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M7 10l5 5 5-5M12 15V3",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})]}),Rt=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8",stroke:"currentColor",strokeWidth:r}),e.jsx("path",{d:"M21 21l-4.35-4.35",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})]}),he=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth,filled:n=!1})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:n?"currentColor":"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})}),$n=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",stroke:"currentColor",strokeWidth:r}),e.jsx("path",{d:"M6 8h2M10 8h2M14 8h2M18 8h.01M6 12h2M10 12h2M14 12h2M18 12h.01M7 16h10",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round"})]}),Js=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"12",cy:"12",r:"1",stroke:"currentColor",strokeWidth:r}),e.jsx("circle",{cx:"12",cy:"5",r:"1",stroke:"currentColor",strokeWidth:r}),e.jsx("circle",{cx:"12",cy:"19",r:"1",stroke:"currentColor",strokeWidth:r})]}),Wt=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})}),Qs=({size:t=10,className:s})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 10 10",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("circle",{cx:"5",cy:"5",r:"4",fill:"#10B981"})}),Ut=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M6 9l6 6 6-6",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})}),pe=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M12 3l8 4.5v9L12 21l-8-4.5v-9L12 3z",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M12 12l8-4.5M12 12v9M12 12L4 7.5",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})]}),ot=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:r}),e.jsx("path",{d:"M12 6v6l4 2",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})]}),Hn=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})]}),Wn=me,Un=je,Vn=ke,qn=qe,Vt=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("line",{x1:"7",y1:"7",x2:"7.01",y2:"7",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})]}),Me=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})]}),Ce=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M3 6h18",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})]}),Ke=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M20 6L9 17l-5-5",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})}),Yn=({size:t=S.size,className:s})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"successGrad",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#00d4aa"}),e.jsx("stop",{offset:"100%",stopColor:"#00b894"})]})}),e.jsx("circle",{cx:"12",cy:"12",r:"10",fill:"url(#successGrad)"}),e.jsx("path",{d:"M17 9L10.5 15.5L7 12",stroke:"white",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),Ks=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})]}),Gn=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})]}),Jn=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.48-.56.93-1.23 1.35-2h-4.35z",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M12 15l-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M9 9l-3.8 3.8a2.5 2.5 0 0 0 0 3.5l1.5 1.5a2.5 2.5 0 0 0 3.5 0L14 14",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})]}),Re=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:[e.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),e.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),e.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),Qn=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]}),Kn=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:e.jsx("path",{d:"m21 2-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0 3 3L22 7l-3-3m-3.5 3.5L19 4"})}),Ye=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:[e.jsx("line",{x1:"12",y1:"19",x2:"12",y2:"5"}),e.jsx("polyline",{points:"5 12 12 5 19 12"})]}),Ge=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("polyline",{points:"19 12 12 19 5 12"})]}),Xs=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:e.jsx("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})}),Xn=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:[e.jsx("path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91"}),e.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]}),Zn=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:e.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"})}),Zs=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),ea=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:[e.jsx("rect",{x:"8",y:"6",width:"8",height:"12",rx:"4"}),e.jsx("path",{d:"M12 12h.01"}),e.jsx("path",{d:"M16 10l2-2"}),e.jsx("path",{d:"M16 14l2 2"}),e.jsx("path",{d:"M8 10l-2-2"}),e.jsx("path",{d:"M8 14l-2 2"})]}),er=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("polyline",{points:"10 9 9 9 8 9"})]}),ta=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:e.jsx("path",{d:"M12 3l1.912 5.813a2 2 0 0 0 1.272 1.272L21 12l-5.813 1.912a2 2 0 0 0-1.272 1.272L12 21l-1.912-5.813a2 2 0 0 0-1.272-1.272L3 12l5.813-1.912a2 2 0 0 0 1.272-1.272L12 3z"})}),sa=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:[e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"}),e.jsx("polyline",{points:"12 5 19 12 12 19"})]}),tr=({size:t=24,className:s=""})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:e.jsx("path",{d:"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"})}),Ot=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"17 8 12 3 7 8"}),e.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),Pt=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"7 10 12 15 17 10"}),e.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),lt=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:[e.jsx("rect",{x:"7",y:"2",width:"10",height:"20",rx:"5"}),e.jsx("circle",{cx:"12",cy:"7",r:"1",fill:"currentColor"}),e.jsx("circle",{cx:"12",cy:"12",r:"1",fill:"currentColor"}),e.jsx("circle",{cx:"12",cy:"17",r:"1",fill:"currentColor"})]}),ra=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:[e.jsx("line",{x1:"18",y1:"20",x2:"18",y2:"10"}),e.jsx("line",{x1:"12",y1:"20",x2:"12",y2:"4"}),e.jsx("line",{x1:"6",y1:"20",x2:"6",y2:"14"})]}),sr=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:[e.jsx("path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"}),e.jsx("rect",{x:"8",y:"2",width:"8",height:"4",rx:"1",ry:"1"})]}),na=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M5 3l14 9-14 9V3z",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})}),Ft=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M6 4h4v16H6zM14 4h4v16h-4z",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})}),aa=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:r}),e.jsx("path",{d:"M4.93 4.93l14.14 14.14",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})]}),ia=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:r}),e.jsx("path",{d:"M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})]}),oa=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9 18l6-6-6-6",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})}),la=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",stroke:"currentColor",strokeWidth:r}),e.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5",fill:"currentColor"}),e.jsx("circle",{cx:"15.5",cy:"15.5",r:"1.5",fill:"currentColor"}),e.jsx("circle",{cx:"15.5",cy:"8.5",r:"1.5",fill:"currentColor"}),e.jsx("circle",{cx:"8.5",cy:"15.5",r:"1.5",fill:"currentColor"}),e.jsx("circle",{cx:"12",cy:"12",r:"1.5",fill:"currentColor"})]}),ca=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"12",cy:"13",r:"8",stroke:"currentColor",strokeWidth:r}),e.jsx("path",{d:"M12 9v4l2 2",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M5 3L2 6",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M22 6L19 3",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M12 2v4",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})]}),da=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M12 22v-5",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M9 8V2",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M15 8V2",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M18 8v5a4 4 0 0 1-4 4h-4a4 4 0 0 1-4-4V8h12z",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})]}),ua=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"11",cy:"13",r:"9",stroke:"currentColor",strokeWidth:r}),e.jsx("path",{d:"M11 4a9 9 0 0 0-9 9",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M18.5 5.5L22 2",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M22 6l-1.5-1.5",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M19 2l-1.5 1.5",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})]}),xa=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M2 13a6 6 0 1 0 12 0 4 4 0 1 0-8 0 2 2 0 0 0 4 0",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:"10",cy:"13",r:"8",stroke:"currentColor",strokeWidth:r}),e.jsx("path",{d:"M2 21h16c2.5 0 4-1.5 4-3v-2h-2",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M18 14l2-2",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M22 14l-2-2",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})]}),rr=ft,ma=({size:t=24,className:s=""})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:s,children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),ha=({size:t=S.size,className:s})=>e.jsxs("svg",{width:t,height:t,viewBox:"0 0 64 64",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{width:"64",height:"64",rx:"16",fill:"url(#debugHubGrad)"}),e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M32 14C26.4772 14 22 18.4772 22 24V26H18C16.8954 26 16 26.8954 16 28C16 29.1046 16.8954 30 18 30H22V34H16C14.8954 34 14 34.8954 14 36C14 37.1046 14.8954 38 16 38H22V42C22 47.5228 26.4772 52 32 52C37.5228 52 42 47.5228 42 42V38H48C49.1046 38 50 37.1046 50 36C50 34.8954 49.1046 34 48 34H42V30H46C47.1046 30 48 29.1046 48 28C48 26.8954 47.1046 26 46 26H42V24C42 18.4772 37.5228 14 32 14ZM26 24C26 20.6863 28.6863 18 32 18C35.3137 18 38 20.6863 38 24V26H26V24ZM26 30H38V34H26V30ZM26 38H38V42C38 45.3137 35.3137 48 32 48C28.6863 48 26 45.3137 26 42V38Z",fill:"white"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"debugHubGrad",x1:"0",y1:"0",x2:"64",y2:"64",gradientUnits:"userSpaceOnUse",children:[e.jsx("stop",{stopColor:"#00d4aa"}),e.jsx("stop",{offset:"1",stopColor:"#00b894"})]})})]}),nr=({size:t=S.size,className:s,strokeWidth:r=S.strokeWidth})=>e.jsx("svg",{width:t,height:t,viewBox:"0 0 24 24",fill:"none",className:s,xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})}),qt=(t,s=24,r)=>{const n={className:r,size:s};if(t.toLowerCase().includes("simulator"))return e.jsx(An,{...n});switch(t){case"iOS":return e.jsx(de,{...n});case"iPadOS":return e.jsx(Pn,{...n});case"macOS":return e.jsx(Fn,{...n});case"watchOS":return e.jsx(zn,{...n});case"tvOS":return e.jsx(_n,{...n});default:return e.jsx(de,{...n})}};let pa=0;const gt=ae((t,s)=>({toasts:[],show:(r,n,a=3e3)=>{const i=`toast-${++pa}`;t(o=>({toasts:[...o.toasts,{id:i,type:r,message:n}]})),setTimeout(()=>{s().remove(i)},a)},remove:r=>{t(n=>({toasts:n.toasts.filter(a=>a.id!==r)}))}}));function ar(t){var s,r,n="";if(typeof t=="string"||typeof t=="number")n+=t;else if(typeof t=="object")if(Array.isArray(t)){var a=t.length;for(s=0;s<a;s++)t[s]&&(r=ar(t[s]))&&(n&&(n+=" "),n+=r)}else for(r in t)t[r]&&(n&&(n+=" "),n+=r);return n}function b(){for(var t,s,r=0,n="",a=arguments.length;r<a;r++)(t=arguments[r])&&(s=ar(t))&&(n&&(n+=" "),n+=s);return n}function fa({isOpen:t,onClose:s,onConfirm:r,title:n,message:a,confirmText:i="确认执行",cancelText:o="取消",loading:l=!1}){const[c,d]=u.useState(""),[x,h]=u.useState(!1),[j,y]=u.useState(null),[p,g]=u.useState(!1);if(u.useEffect(()=>{t||(d(""),y(null),g(!1))},[t]),!t)return null;const v=async()=>{if(!c.trim()){y({valid:!1,message:"请输入 Token"});return}h(!0),y(null);try{const T=await an(c.trim());y(T),g(T.valid)}catch(T){y({valid:!1,message:"验证失败: "+(T instanceof Error?T.message:"未知错误")}),g(!1)}finally{h(!1)}},f=()=>{p&&!l&&r()},D=T=>{T.key==="Enter"&&(p?f():v()),T.key==="Escape"&&s()};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70",children:e.jsxs("div",{className:"bg-bg-dark border border-border rounded-lg shadow-lg w-[480px] overflow-hidden animate-in fade-in zoom-in-95 duration-200",children:[e.jsx("div",{className:"px-6 py-4 border-b border-border bg-red-500/5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center bg-red-500/15",children:e.jsx(Re,{size:24,className:"text-red-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-red-400",children:n}),e.jsx("p",{className:"text-xs text-text-muted",children:"此操作需要 Token 验证"})]})]})}),e.jsxs("div",{className:"px-6 py-5",children:[e.jsx("p",{className:"text-text-secondary whitespace-pre-line mb-4",children:a}),e.jsxs("div",{className:"bg-bg-medium rounded-lg p-4 border border-border",children:[e.jsxs("p",{className:"text-sm text-text-muted mb-2 flex items-center gap-2",children:[e.jsx(Kn,{size:14}),"请输入服务器 Token 以验证身份："]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"password",value:c,onChange:T=>{d(T.target.value),y(null),g(!1)},onKeyDown:D,placeholder:"输入 Token...",autoFocus:!0,disabled:p,className:b("flex-1 px-3 py-2 bg-bg-dark border rounded text-text-primary font-mono focus:outline-none transition-colors",p?"border-green-500 bg-green-500/5":j&&!j.valid?"border-red-500/50 focus:border-red-400":"border-border focus:border-primary")}),e.jsx("button",{onClick:v,disabled:x||p||!c.trim(),className:b("px-4 py-2 rounded text-sm font-medium transition-all",p?"bg-green-500 text-white":"bg-primary text-bg-darkest hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed"),children:x?e.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin inline-block"}):p?"已验证 ✓":"验证"})]}),j&&e.jsx("p",{className:b("text-xs mt-2",j.valid?"text-green-400":"text-red-400"),children:j.message})]}),p&&e.jsx("div",{className:"mt-4 p-3 bg-green-500/10 border border-green-500/30 rounded-lg",children:e.jsx("p",{className:"text-sm text-green-400",children:"✓ Token 验证通过，您现在可以执行此操作。"})})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-border bg-bg-medium/30 flex justify-end gap-3",children:[e.jsx("button",{onClick:s,disabled:l,className:"px-4 py-2 rounded-lg text-sm font-medium text-text-secondary hover:text-text-primary hover:bg-bg-light transition-all disabled:opacity-50",children:o}),e.jsx("button",{onClick:f,disabled:!p||l,className:b("px-4 py-2 rounded-lg text-sm font-medium text-white transition-all",p?"bg-red-500 hover:bg-red-600":"bg-red-500/30 cursor-not-allowed",l&&"opacity-50"),children:l?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"处理中..."]}):i})]})]})})}function ga(t){if(t==null)return"-";if(t===0)return"0 B";if(isNaN(t))return"-";const s=1024,r=["B","KB","MB","GB"],n=Math.floor(Math.log(t)/Math.log(s)),a=Math.min(n,r.length-1);return parseFloat((t/Math.pow(s,a)).toFixed(1))+" "+r[a]}function Ee(t){return t>=1e6?(t/1e6).toFixed(1)+"M":t>=1e3?(t/1e3).toFixed(1)+"K":t.toString()}function ba(){const[t,s]=u.useState(null),[r,n]=u.useState(!1),[a,i]=u.useState(!1),[o,l]=u.useState(!1),[c,d]=u.useState(!1),x=gt(),h=async()=>{i(!0);try{const p=await En();s(p)}catch(p){console.error("Failed to fetch server stats:",p)}finally{i(!1)}},j=async()=>{d(!0);try{await nn(),x.show("success","已清空所有数据"),l(!1),await h()}catch(p){x.show("error","清空数据失败: "+(p instanceof Error?p.message:"未知错误"))}finally{d(!1)}};if(u.useEffect(()=>{h();const p=setInterval(h,3e4);return()=>clearInterval(p)},[]),!t)return null;const y=({icon:p,label:g,value:v})=>e.jsxs("div",{className:"flex justify-between items-center py-1",children:[e.jsxs("span",{className:"text-text-muted flex items-center gap-1.5",children:[p,g]}),e.jsx("span",{className:"font-mono text-text-primary",children:v})]});return e.jsxs("div",{className:"border-t border-border",children:[e.jsxs("button",{onClick:()=>n(!r),className:"w-full px-4 py-2 flex items-center justify-between hover:bg-bg-light transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ra,{size:14}),e.jsx("span",{className:"text-xs font-medium text-text-primary",children:"服务器统计"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!r&&t&&e.jsxs("span",{className:"text-xs text-text-muted",children:[Ee(t.httpEventCount)," HTTP · ",Ee(t.logEventCount)," Log"]}),e.jsx("span",{className:`text-xs text-text-muted transition-transform ${r?"":"rotate-180"}`,children:e.jsx(Ut,{size:12})})]})]}),r&&e.jsxs("div",{className:"px-4 pb-3 text-xs space-y-0.5",children:[e.jsx("div",{className:"text-text-muted/60 text-2xs uppercase tracking-wider mt-1 mb-1",children:"数据记录"}),e.jsx(y,{icon:e.jsx(me,{size:12}),label:"HTTP 事件",value:Ee(t.httpEventCount)}),e.jsx(y,{icon:e.jsx(je,{size:12}),label:"日志条目",value:Ee(t.logEventCount)}),e.jsx(y,{icon:e.jsx(ke,{size:12}),label:"WS 会话",value:Ee(t.wsSessionCount)}),e.jsx(y,{icon:e.jsx(er,{size:12}),label:"WS 帧",value:Ee(t.wsFrameCount)}),e.jsx("div",{className:"text-text-muted/60 text-2xs uppercase tracking-wider mt-2 mb-1",children:"规则配置"}),e.jsx(y,{icon:e.jsx(ce,{size:12}),label:"Mock 规则",value:t.mockRuleCount}),e.jsx(y,{icon:e.jsx(Ht,{size:12}),label:"断点规则",value:t.breakpointRuleCount}),e.jsx(y,{icon:e.jsx(Ve,{size:12}),label:"故障注入规则",value:t.chaosRuleCount}),e.jsx(y,{icon:e.jsx(lt,{size:12}),label:"流量规则",value:t.trafficRuleCount}),e.jsx("div",{className:"text-text-muted/60 text-2xs uppercase tracking-wider mt-2 mb-1",children:"设备连接"}),e.jsx(y,{icon:e.jsx(de,{size:12}),label:"在线设备",value:t.onlineDeviceCount}),e.jsx(y,{icon:e.jsx(ot,{size:12}),label:"历史会话",value:t.deviceSessionCount}),t.databaseSizeBytes!==null&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-text-muted/60 text-2xs uppercase tracking-wider mt-2 mb-1",children:"存储"}),e.jsx(y,{icon:e.jsx(qe,{size:12}),label:"数据库大小",value:ga(t.databaseSizeBytes)})]}),e.jsx("button",{onClick:h,disabled:a,className:"mt-2 w-full py-1.5 text-center text-xs text-text-muted hover:text-text-primary hover:bg-bg-light rounded transition-colors disabled:opacity-50 flex items-center justify-center gap-1",children:a?"刷新中...":e.jsxs(e.Fragment,{children:[e.jsx(rr,{size:12})," 刷新统计"]})}),e.jsxs("button",{onClick:()=>l(!0),className:"mt-1 w-full py-1.5 text-center text-xs text-red-400/70 hover:text-red-400 hover:bg-red-500/10 rounded transition-colors flex items-center justify-center gap-1",children:[e.jsx(Pe,{size:12})," 清空所有数据"]})]}),e.jsx(fa,{isOpen:o,onClose:()=>l(!1),onConfirm:j,title:"清空所有数据",message:`此操作将永久删除数据库中的所有数据，包括：
• HTTP 请求记录
• 日志条目
• WebSocket 会话和帧
• Mock/断点/故障注入规则
• 流量规则

此操作不可逆，请确认您已备份重要数据。`,confirmText:"确认清空",loading:c})]})}function ya(){return typeof window>"u"||window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function Ct(t){return t==="system"?ya():t}function Et(t){const s=document.documentElement;t==="light"?(s.classList.add("light"),s.classList.remove("dark")):(s.classList.add("dark"),s.classList.remove("light"))}const bt=ae()(Bt((t,s)=>({theme:"dark",resolvedTheme:"dark",setTheme:r=>{const n=Ct(r);Et(n),t({theme:r,resolvedTheme:n})},toggleTheme:()=>{const{theme:r}=s(),n=r==="dark"?"light":r==="light"?"system":"dark",a=Ct(n);Et(a),t({theme:n,resolvedTheme:a})}}),{name:"debug-platform-theme",onRehydrateStorage:()=>t=>{if(t){const s=Ct(t.theme);Et(s),t.resolvedTheme=s}}}));typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{const{theme:t,setTheme:s}=bt.getState();t==="system"&&s("system")});function ja(){const{theme:t,setTheme:s}=bt(),r=()=>{s(t==="dark"?"light":t==="light"?"system":"dark")};return e.jsxs("button",{onClick:r,className:"p-2 rounded-lg hover:bg-bg-light transition-colors text-text-muted hover:text-text-primary",title:`当前主题: ${t==="dark"?"深色":t==="light"?"浅色":"跟随系统"}`,children:[t==="dark"&&e.jsx(va,{className:"w-5 h-5"}),t==="light"&&e.jsx(wa,{className:"w-5 h-5"}),t==="system"&&e.jsx(Na,{className:"w-5 h-5"})]})}function va({className:t=""}){return e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})})}function wa({className:t=""}){return e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})})}function Na({className:t=""}){return e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}function ka(){const t=At(),s=Rs(),{isServerOnline:r}=We(),{devices:n,fetchDevices:a,currentDeviceId:i,selectDevice:o,favoriteDeviceIds:l,toggleFavorite:c}=pt(),{events:d,toggleDomain:x,clearDomains:h,filters:j}=$t(),{sessions:y,setFilter:p,filters:g}=Gs(),{getDomainRule:v,createOrUpdateRule:f,deleteRule:D,fetchRules:T}=Oe(),[W,H]=u.useState(!1),z=u.useMemo(()=>new URLSearchParams(s.search).get("tab")||"http",[s.search]),[P,F]=u.useState(""),[G,C]=u.useState(new Set),_=u.useRef({});u.useEffect(()=>{a(),T()},[]);const U=u.useMemo(()=>{if(z==="websocket"){const I={};return y.forEach(V=>{try{const ee=new URL(V.url).hostname;I[ee]=(I[ee]||0)+1}catch{}}),Object.entries(I).map(([V,B])=>({domain:V,count:B})).sort((V,B)=>B.count-V.count)}else{const I={};return d.forEach(V=>{try{const B=new URL(V.url).hostname;I[B]=(I[B]||0)+1}catch{}}),Object.entries(I).map(([V,B])=>({domain:V,count:B})).sort((V,B)=>B.count-V.count)}},[d,y,z]),L=u.useRef(z);u.useEffect(()=>{if(L.current!==z){L.current=z;const B={};U.forEach(({domain:ee,count:$})=>{B[ee]=$}),_.current=B;return}const I={};U.forEach(({domain:B,count:ee})=>{I[B]=ee});const V=new Set;for(const[B,ee]of Object.entries(I)){const $=_.current[B]||0;ee>$&&V.add(B)}V.size>0&&(C(B=>new Set([...B,...V])),setTimeout(()=>{C(B=>{const ee=new Set(B);return V.forEach($=>ee.delete($)),ee})},1500)),_.current=I},[U,z]);const E=u.useMemo(()=>{if(!P.trim())return U;const I=P.toLowerCase();return U.filter(({domain:V})=>V.toLowerCase().includes(I))},[U,P]),m=u.useMemo(()=>W?n:n.filter(I=>I.deviceId===i||l.has(I.deviceId)),[n,i,l,W]),N=n.length-m.length,w=I=>{o(I),t(`/device/${I}`)},M=(I,V)=>{I.stopPropagation(),c(V)},k=I=>{z==="websocket"?g.host===I?p("host",""):p("host",I):x(I)},O=()=>{z==="websocket"?p("host",""):h()},Q=I=>z==="websocket"?g.host===I:j.domains.includes(I),Y=()=>z==="websocket"?!g.host:j.domains.length===0,X=async(I,V)=>{I.stopPropagation();const B=v(V);B?B.action==="highlight"?await f({...B,action:"hide"}):B.id&&await D(B.id):await f({name:V,matchType:"domain",matchValue:V,action:"highlight",isEnabled:!0,priority:0})};return e.jsxs("aside",{className:"w-72 bg-bg-dark border-r border-border flex flex-col h-full",children:[e.jsxs(ye,{to:"/",className:"p-5 border-b border-border flex items-center gap-3 hover:bg-bg-light/50 transition-colors",children:[e.jsx(ha,{size:40}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-semibold text-text-primary text-lg",children:"Debug Hub"}),e.jsx("p",{className:"text-2xs text-text-muted",children:"iOS 调试平台"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"px-4 py-2 border-b border-border flex items-center gap-2",children:[e.jsxs(ye,{to:"/api-docs",className:"flex items-center gap-1 px-2 py-1 text-xs text-text-muted hover:text-primary hover:bg-bg-light rounded transition-colors",title:"API 文档",children:[e.jsx(Ks,{size:12}),e.jsx("span",{children:"API"})]}),e.jsxs(ye,{to:"/health",className:"flex items-center gap-1 px-2 py-1 text-xs text-text-muted hover:text-green-400 hover:bg-bg-light rounded transition-colors",title:"健康检查",children:[e.jsx(Ke,{size:12}),e.jsx("span",{children:"健康"})]})]}),e.jsxs("div",{className:"px-3 pt-4 pb-3",children:[e.jsxs("div",{className:"px-2 mb-3 text-xs font-semibold text-text-secondary uppercase tracking-wider flex justify-between items-center",children:[e.jsxs("button",{onClick:()=>t("/"),className:"flex items-center gap-2 hover:text-primary transition-colors",title:"查看设备列表",children:[e.jsx(de,{size:14}),"设备列表"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[N>0&&!W&&e.jsxs("button",{onClick:()=>H(!0),className:"text-2xs text-text-muted hover:text-primary transition-colors",title:"显示所有设备",children:["+",N," 更多"]}),W&&e.jsx("button",{onClick:()=>H(!1),className:"text-2xs text-text-muted hover:text-primary transition-colors",title:"只显示收藏设备",children:"收起"}),e.jsx("span",{className:"bg-primary/10 text-primary px-2 py-0.5 rounded-full text-2xs font-bold",children:n.length})]})]}),e.jsxs("div",{className:"space-y-1",children:[m.map(I=>{const V=l.has(I.deviceId),B=i===I.deviceId,ee=!I.isOnline;return e.jsxs("div",{onClick:()=>w(I.deviceId),className:b("group relative flex items-center gap-2.5 px-2.5 py-2 rounded-lg cursor-pointer transition-colors",B?"bg-primary/15":ee?"text-text-muted hover:bg-bg-light/50":"text-text-secondary hover:bg-bg-light hover:text-text-primary"),children:[B&&e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-[3px] bg-primary"}),e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("div",{className:b("w-9 h-9 rounded-lg flex items-center justify-center",B?"bg-primary/20":ee?"bg-bg-medium/50":"bg-bg-medium"),children:qt(I.platform,18)}),I.isOnline?e.jsx("span",{className:"absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 bg-green-500 border-2 border-bg-dark rounded-full"}):e.jsx("span",{className:"absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 bg-gray-500 border-2 border-bg-dark rounded-full"})]}),e.jsxs("div",{className:b("min-w-0 flex-1",ee&&"opacity-60"),children:[e.jsxs("div",{className:b("font-medium truncate text-xs flex items-center gap-1.5",B?"text-primary":"text-text-primary"),children:[I.deviceName,I.isSimulator&&e.jsx("span",{className:"text-2xs px-1 py-0.5 rounded bg-purple-500/20 text-purple-400 font-medium",children:"模拟器"})]}),e.jsxs("div",{className:b("text-2xs truncate",B?"text-accent-blue/70":"text-text-muted"),title:I.deviceModel,children:[I.deviceModel," · ",I.platform," ",e.jsx("span",{className:"opacity-60",children:I.systemVersion})]}),e.jsxs("div",{className:b("text-2xs truncate mt-1 pt-1 border-t border-border flex items-center gap-1",B?"text-accent-blue/70":"text-text-muted"),children:[e.jsx("div",{className:"w-3.5 h-3.5 rounded overflow-hidden bg-bg-light flex items-center justify-center flex-shrink-0",children:I.appIcon?e.jsx("img",{src:`data:image/png;base64,${I.appIcon}`,alt:I.appName,className:"w-full h-full object-cover"}):e.jsx(pe,{size:8,className:"text-text-muted"})}),e.jsx("span",{className:"truncate",children:I.appName}),e.jsx("span",{className:"opacity-60 flex-shrink-0",children:I.appVersion})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:$=>M($,I.deviceId),className:b("p-1.5 rounded transition-all",V?"text-yellow-400 hover:text-yellow-300":"text-text-muted opacity-0 group-hover:opacity-100 hover:text-yellow-400"),title:V?"取消收藏":"收藏设备",children:e.jsx(he,{size:14,filled:V})}),e.jsx(Ut,{size:14,className:"opacity-0 group-hover:opacity-100 transition-opacity -rotate-90 text-text-muted"})]})]},I.deviceId)}),m.length===0&&n.length>0&&e.jsx("div",{className:"px-4 py-4 text-center text-xs text-text-muted",children:e.jsxs("button",{onClick:()=>H(!0),className:"text-primary hover:underline",children:["显示全部 ",n.length," 个设备"]})}),n.length===0&&!r&&e.jsxs("div",{className:"px-4 py-6 text-center text-xs text-text-muted bg-bg-light/20 rounded-lg border border-dashed border-border",children:[e.jsx(me,{size:32,className:"block mb-2 opacity-50 mx-auto"}),"等待服务连接..."]})]})]}),i&&(z==="http"||z==="websocket")&&e.jsx("div",{className:"h-px bg-border"}),i&&(z==="http"||z==="websocket")&&e.jsxs("div",{className:"px-3 py-3",children:[e.jsxs("div",{className:"px-2 mb-3 text-xs font-semibold text-text-secondary uppercase tracking-wider flex justify-between items-center",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[z==="websocket"?e.jsx(ke,{size:14}):e.jsx(me,{size:14}),z==="websocket"?"WS Hosts":"Domains"]}),e.jsx("span",{className:"bg-accent-blue/10 text-accent-blue px-2 py-0.5 rounded-full text-2xs font-bold",children:U.length})]}),e.jsx("div",{className:"px-1 mb-3",children:e.jsxs("div",{className:"relative",children:[e.jsx(Rt,{size:12,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted"}),e.jsx("input",{type:"text",value:P,onChange:I=>F(I.target.value),placeholder:z==="websocket"?"搜索主机...":"搜索域名...",className:"w-full pl-8 pr-3 py-2 text-xs bg-bg-medium border border-border rounded text-text-primary placeholder:text-text-muted focus:outline-none focus:border-primary transition-colors"})]})}),e.jsxs("div",{className:"space-y-0.5 max-h-[400px] overflow-y-auto pr-1",children:[e.jsxs("div",{onClick:O,className:b("flex items-center justify-between px-3 py-2 rounded cursor-pointer text-xs transition-colors group",Y()?"bg-accent-blue text-white font-medium":"text-text-secondary hover:bg-bg-light"),children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(je,{size:14}),e.jsx("span",{className:"font-medium",children:z==="websocket"?"全部主机":"全部域名"})]}),e.jsx("span",{className:b("font-mono text-2xs px-1.5 py-0.5 rounded",Y()?"text-white font-bold bg-white/20":"opacity-60 bg-bg-medium"),children:U.reduce((I,{count:V})=>I+V,0)})]}),U.length>0&&e.jsx("div",{className:"border-t border-border-subtle my-1"}),E.map(({domain:I,count:V})=>{const B=v(I),ee=(B==null?void 0:B.action)==="highlight",$=(B==null?void 0:B.action)==="hide",oe=Q(I),le=G.has(I);return e.jsxs("div",{onClick:()=>k(I),className:b("flex items-center justify-between px-3 py-2 rounded cursor-pointer text-xs transition-colors group",oe?"bg-accent-blue text-white font-medium":"text-text-secondary hover:bg-bg-light",le&&"animate-domain-highlight"),children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[z==="http"&&e.jsx("input",{type:"checkbox",checked:oe,onChange:()=>k(I),onClick:te=>te.stopPropagation(),className:"w-4 h-4 min-w-4 min-h-4 flex-shrink-0 rounded border-border cursor-pointer accent-primary"}),ee&&e.jsx(he,{size:12,filled:!0,className:"text-yellow-500"}),$&&e.jsx(Pe,{size:12,className:"text-red-400"}),e.jsx("span",{className:b("truncate font-mono",$&&"opacity-50 line-through"),children:I})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:b("font-mono text-2xs px-1.5 py-0.5 rounded",le?"text-primary font-bold bg-primary/10":"opacity-60 bg-bg-medium"),children:V}),e.jsx("button",{onClick:te=>X(te,I),className:"opacity-0 group-hover:opacity-100 p-1.5 hover:bg-bg-medium rounded transition-colors text-text-muted hover:text-text-primary",title:"Toggle Rule (None -> Highlight -> Hide)",children:e.jsx(Js,{size:14})})]})]},I)}),E.length===0&&P&&e.jsxs("div",{className:"px-4 py-4 text-center text-xs text-text-muted bg-bg-light/20 rounded border border-dashed border-border",children:[e.jsx(Rt,{size:24,className:"block mb-1 opacity-50 mx-auto"}),z==="websocket"?"未找到匹配的主机":"未找到匹配的域名"]}),U.length===0&&!P&&e.jsxs("div",{className:"px-4 py-4 text-center text-xs text-text-muted bg-bg-light/20 rounded border border-dashed border-border",children:[z==="websocket"?e.jsx(ke,{size:24,className:"block mb-1 opacity-50 mx-auto"}):e.jsx(me,{size:24,className:"block mb-1 opacity-50 mx-auto"}),z==="websocket"?"暂无 WebSocket 主机":"暂无域名记录"]})]})]})]}),e.jsx(ba,{}),e.jsxs("div",{className:"px-4 py-2 bg-bg-darker border-t border-border text-xs text-text-muted flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ja,{}),e.jsx("div",{className:"h-4 w-px bg-border"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:b("w-2 h-2 rounded-full",r?"bg-green-500":"bg-red-500")}),e.jsx("span",{className:"font-medium",children:r?"在线":"离线"})]})]}),e.jsx("span",{className:"text-text-muted/50",children:"1.0.0"})]})]})}function ls(){return{name:"新规则",targetType:"httpResponse",condition:{urlPattern:"",method:null,statusCode:null,headerContains:null,bodyContains:null,wsPayloadContains:null,enabled:!0},action:{modifyRequestHeaders:null,modifyRequestBody:null,mockResponseStatusCode:200,mockResponseHeaders:{"Content-Type":"application/json"},mockResponseBody:btoa(JSON.stringify({mock:!0})),mockWebSocketPayload:null,delayMilliseconds:null},priority:0,enabled:!0}}const Ca=ae((t,s)=>({rules:[],loading:!1,error:null,editingRule:null,isEditorOpen:!1,fetchRules:async r=>{t({loading:!0,error:null});try{const n=await zs(r);t({rules:n,loading:!1})}catch(n){t({loading:!1,error:n instanceof Error?n.message:"加载失败"})}},createRule:async(r,n)=>{t({loading:!0,error:null});try{const a=await hn(r,n);t(i=>({rules:[a,...i.rules],loading:!1,isEditorOpen:!1,editingRule:null}))}catch(a){throw t({loading:!1,error:a instanceof Error?a.message:"创建失败"}),a}},updateRule:async(r,n,a)=>{t({loading:!0,error:null});try{const i=await rs(r,n,a);t(o=>({rules:o.rules.map(l=>l.id===n?i:l),loading:!1,isEditorOpen:!1,editingRule:null}))}catch(i){throw t({loading:!1,error:i instanceof Error?i.message:"更新失败"}),i}},deleteRule:async(r,n)=>{t({loading:!0,error:null});try{await _s(r,n),t(a=>({rules:a.rules.filter(i=>i.id!==n),loading:!1}))}catch(a){t({loading:!1,error:a instanceof Error?a.message:"删除失败"})}},toggleRuleEnabled:async(r,n)=>{const a=s().rules.find(i=>i.id===n);if(a)try{await rs(r,n,{enabled:!a.enabled}),t(i=>({rules:i.rules.map(o=>o.id===n?{...o,enabled:!o.enabled}:o)}))}catch(i){console.error("Failed to toggle rule:",i)}},openEditor:r=>{t({isEditorOpen:!0,editingRule:r||null})},openEditorWithTemplate:r=>{let n=r.url;try{n=`*${new URL(r.url).pathname}*`}catch{}const a={id:"",deviceId:null,name:`Mock ${r.method||"GET"} ${n}`,targetType:"httpResponse",condition:{urlPattern:n,method:r.method||null,statusCode:null,headerContains:null,bodyContains:null,wsPayloadContains:null,enabled:!0},action:{modifyRequestHeaders:null,modifyRequestBody:null,mockResponseStatusCode:200,mockResponseHeaders:r.responseHeaders||{"Content-Type":"application/json"},mockResponseBody:r.responseBody||null,mockWebSocketPayload:null,delayMilliseconds:null},priority:0,enabled:!0,createdAt:null,updatedAt:null};t({isEditorOpen:!0,editingRule:a})},closeEditor:()=>{t({isEditorOpen:!1,editingRule:null})},clearRules:()=>{t({rules:[],editingRule:null,isEditorOpen:!1})}})),ir=ae((t,s)=>({activities:[],maxActivities:100,isLoading:!1,addActivity:r=>t(n=>({activities:[r,...n.activities].slice(0,n.maxActivities)})),clearActivities:()=>t({activities:[]}),getActivitiesForDevice:r=>s().activities.filter(n=>n.deviceId===r),loadDeviceActivities:async r=>{t({isLoading:!0});try{const n=await Xr(r,20),a=[];for(const i of n)a.push({id:`${i.sessionId}-connected`,deviceId:i.deviceId,sessionId:i.sessionId,timestamp:i.connectedAt,type:"connected",deviceName:i.deviceName}),i.disconnectedAt&&a.push({id:`${i.sessionId}-disconnected`,deviceId:i.deviceId,sessionId:i.sessionId,timestamp:i.disconnectedAt,type:"disconnected",deviceName:i.deviceName});a.sort((i,o)=>new Date(o.timestamp).getTime()-new Date(i.timestamp).getTime()),t(i=>{const o=new Set(i.activities.map(d=>d.id)),l=a.filter(d=>!o.has(d.id));return{activities:[...i.activities,...l].sort((d,x)=>new Date(x.timestamp).getTime()-new Date(d.timestamp).getTime()).slice(0,i.maxActivities),isLoading:!1}})}catch(n){console.error("[sessionActivityStore] Failed to load activities:",n),t({isLoading:!1})}}})),Ea=ae((t,s)=>({pendingHits:[],loading:!1,fetchPendingHits:async r=>{t({loading:!0});try{const n=await $s(r);t({pendingHits:n})}catch(n){console.error("Failed to fetch pending breakpoints:",n)}finally{t({loading:!1})}},addHit:r=>{t(n=>n.pendingHits.some(a=>a.requestId===r.requestId)?n:{pendingHits:[...n.pendingHits,r]})},removeHit:r=>{t(n=>({pendingHits:n.pendingHits.filter(a=>a.requestId!==r)}))},resumeBreakpoint:async(r,n,a)=>{try{await Hs(r,n,a),s().removeHit(n)}catch(i){throw console.error("Failed to resume breakpoint:",i),i}},clear:()=>{t({pendingHits:[]})}}));class Ta{constructor(){ve(this,"ws",null);ve(this,"messageHandlers",new Set);ve(this,"connectionHandlers",new Set);ve(this,"reconnectTimer",null);ve(this,"currentDeviceId",null);ve(this,"shouldReconnect",!1)}connect(s,r="both"){this.disconnect(),this.currentDeviceId=s,this.shouldReconnect=!0;const a=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws/live?deviceId=${s}&type=${r}`;this.ws=new WebSocket(a),this.ws.onopen=()=>{console.log("[Realtime] Connected"),this.notifyConnectionHandlers(!0)},this.ws.onclose=()=>{console.log("[Realtime] Disconnected"),this.notifyConnectionHandlers(!1),this.scheduleReconnect()},this.ws.onerror=i=>{console.error("[Realtime] Error:",i)},this.ws.onmessage=i=>{try{const o=JSON.parse(i.data);this.notifyMessageHandlers(o)}catch(o){console.error("[Realtime] Failed to parse message:",o)}}}disconnect(){this.shouldReconnect=!1,this.currentDeviceId=null,this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.ws&&(this.ws.close(),this.ws=null)}pauseReconnect(){this.shouldReconnect=!1,this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.ws&&(this.ws.close(),this.ws=null)}resumeReconnect(){this.currentDeviceId&&(this.shouldReconnect=!0,this.connect(this.currentDeviceId))}scheduleReconnect(){!this.shouldReconnect||!this.currentDeviceId||(this.reconnectTimer=window.setTimeout(()=>{this.currentDeviceId&&(console.log("[Realtime] Reconnecting..."),this.connect(this.currentDeviceId))},3e3))}onMessage(s){return this.messageHandlers.add(s),()=>this.messageHandlers.delete(s)}onConnection(s){return this.connectionHandlers.add(s),()=>this.connectionHandlers.delete(s)}notifyMessageHandlers(s){this.messageHandlers.forEach(r=>r(s))}notifyConnectionHandlers(s){this.connectionHandlers.forEach(r=>r(s))}get isConnected(){var s;return((s=this.ws)==null?void 0:s.readyState)===WebSocket.OPEN}}const Te=new Ta;function Sa(t){var r,n,a;const s=JSON.parse(t);return{id:s.request.id,method:s.request.method,url:s.request.url,statusCode:((r=s.response)==null?void 0:r.statusCode)??null,startTime:s.request.startTime,duration:((n=s.response)==null?void 0:n.duration)??null,isMocked:s.isMocked,mockRuleId:s.mockRuleId??null,errorDescription:((a=s.response)==null?void 0:a.errorDescription)??null,traceId:s.request.traceId??null,isFavorite:s.isFavorite??!1}}function Ia(t){return JSON.parse(t)}function La(t){const s=JSON.parse(t),r=n=>n&&typeof n=="object"&&"_0"in n?n._0:n;return s.kind.sessionCreated?{type:"sessionCreated",data:r(s.kind.sessionCreated)}:s.kind.sessionClosed?{type:"sessionClosed",data:r(s.kind.sessionClosed)}:s.kind.frame?{type:"frame",data:r(s.kind.frame)}:{type:"unknown",data:s}}function Se(t,s,r){let n=r.initialDeps??[],a;function i(){var o,l,c,d;let x;r.key&&((o=r.debug)!=null&&o.call(r))&&(x=Date.now());const h=t();if(!(h.length!==n.length||h.some((p,g)=>n[g]!==p)))return a;n=h;let y;if(r.key&&((l=r.debug)!=null&&l.call(r))&&(y=Date.now()),a=s(...h),r.key&&((c=r.debug)!=null&&c.call(r))){const p=Math.round((Date.now()-x)*100)/100,g=Math.round((Date.now()-y)*100)/100,v=g/16,f=(D,T)=>{for(D=String(D);D.length<T;)D=" "+D;return D};console.info(`%c⏱ ${f(g,5)} /${f(p,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*v,120))}deg 100% 31%);`,r==null?void 0:r.key)}return(d=r==null?void 0:r.onChange)==null||d.call(r,a),a}return i.updateDeps=o=>{n=o},i}function cs(t,s){if(t===void 0)throw new Error("Unexpected undefined");return t}const Da=(t,s)=>Math.abs(t-s)<1.01,Ma=(t,s,r)=>{let n;return function(...a){t.clearTimeout(n),n=t.setTimeout(()=>s.apply(this,a),r)}},ds=t=>{const{offsetWidth:s,offsetHeight:r}=t;return{width:s,height:r}},Ra=t=>t,Oa=t=>{const s=Math.max(t.startIndex-t.overscan,0),r=Math.min(t.endIndex+t.overscan,t.count-1),n=[];for(let a=s;a<=r;a++)n.push(a);return n},Pa=(t,s)=>{const r=t.scrollElement;if(!r)return;const n=t.targetWindow;if(!n)return;const a=o=>{const{width:l,height:c}=o;s({width:Math.round(l),height:Math.round(c)})};if(a(ds(r)),!n.ResizeObserver)return()=>{};const i=new n.ResizeObserver(o=>{const l=()=>{const c=o[0];if(c!=null&&c.borderBoxSize){const d=c.borderBoxSize[0];if(d){a({width:d.inlineSize,height:d.blockSize});return}}a(ds(r))};t.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(l):l()});return i.observe(r,{box:"border-box"}),()=>{i.unobserve(r)}},us={passive:!0},xs=typeof window>"u"?!0:"onscrollend"in window,Fa=(t,s)=>{const r=t.scrollElement;if(!r)return;const n=t.targetWindow;if(!n)return;let a=0;const i=t.options.useScrollendEvent&&xs?()=>{}:Ma(n,()=>{s(a,!1)},t.options.isScrollingResetDelay),o=x=>()=>{const{horizontal:h,isRtl:j}=t.options;a=h?r.scrollLeft*(j&&-1||1):r.scrollTop,i(),s(a,x)},l=o(!0),c=o(!1);c(),r.addEventListener("scroll",l,us);const d=t.options.useScrollendEvent&&xs;return d&&r.addEventListener("scrollend",c,us),()=>{r.removeEventListener("scroll",l),d&&r.removeEventListener("scrollend",c)}},za=(t,s,r)=>{if(s!=null&&s.borderBoxSize){const n=s.borderBoxSize[0];if(n)return Math.round(n[r.options.horizontal?"inlineSize":"blockSize"])}return t[r.options.horizontal?"offsetWidth":"offsetHeight"]},_a=(t,{adjustments:s=0,behavior:r},n)=>{var a,i;const o=t+s;(i=(a=n.scrollElement)==null?void 0:a.scrollTo)==null||i.call(a,{[n.options.horizontal?"left":"top"]:o,behavior:r})};class Aa{constructor(s){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let r=null;const n=()=>r||(!this.targetWindow||!this.targetWindow.ResizeObserver?null:r=new this.targetWindow.ResizeObserver(a=>{a.forEach(i=>{const o=()=>{this._measureElement(i.target,i)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(o):o()})}));return{disconnect:()=>{var a;(a=n())==null||a.disconnect(),r=null},observe:a=>{var i;return(i=n())==null?void 0:i.observe(a,{box:"border-box"})},unobserve:a=>{var i;return(i=n())==null?void 0:i.unobserve(a)}}})(),this.range=null,this.setOptions=r=>{Object.entries(r).forEach(([n,a])=>{typeof a>"u"&&delete r[n]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:Ra,rangeExtractor:Oa,onChange:()=>{},measureElement:za,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...r}},this.notify=r=>{var n,a;(a=(n=this.options).onChange)==null||a.call(n,this,r)},this.maybeNotify=Se(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),r=>{this.notify(r)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(r=>r()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var r;const n=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==n){if(this.cleanup(),!n){this.maybeNotify();return}this.scrollElement=n,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=((r=this.scrollElement)==null?void 0:r.window)??null,this.elementsCache.forEach(a=>{this.observer.observe(a)}),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,a=>{this.scrollRect=a,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(a,i)=>{this.scrollAdjustments=0,this.scrollDirection=i?this.getScrollOffset()<a?"forward":"backward":null,this.scrollOffset=a,this.isScrolling=i,this.maybeNotify()}))}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??(typeof this.options.initialOffset=="function"?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(r,n)=>{const a=new Map,i=new Map;for(let o=n-1;o>=0;o--){const l=r[o];if(a.has(l.lane))continue;const c=i.get(l.lane);if(c==null||l.end>c.end?i.set(l.lane,l):l.end<c.end&&a.set(l.lane,!0),a.size===this.options.lanes)break}return i.size===this.options.lanes?Array.from(i.values()).sort((o,l)=>o.end===l.end?o.index-l.index:o.end-l.end)[0]:void 0},this.getMeasurementOptions=Se(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled],(r,n,a,i,o)=>(this.pendingMeasuredCacheIndexes=[],{count:r,paddingStart:n,scrollMargin:a,getItemKey:i,enabled:o}),{key:!1}),this.getMeasurements=Se(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:r,paddingStart:n,scrollMargin:a,getItemKey:i,enabled:o},l)=>{if(!o)return this.measurementsCache=[],this.itemSizeCache.clear(),[];this.measurementsCache.length===0&&(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(x=>{this.itemSizeCache.set(x.key,x.size)}));const c=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const d=this.measurementsCache.slice(0,c);for(let x=c;x<r;x++){const h=i(x),j=this.options.lanes===1?d[x-1]:this.getFurthestMeasurement(d,x),y=j?j.end+this.options.gap:n+a,p=l.get(h),g=typeof p=="number"?p:this.options.estimateSize(x),v=y+g,f=j?j.lane:x%this.options.lanes;d[x]={index:x,start:y,size:g,end:v,key:h,lane:f}}return this.measurementsCache=d,d},{key:!1,debug:()=>this.options.debug}),this.calculateRange=Se(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(r,n,a,i)=>this.range=r.length>0&&n>0?Ba({measurements:r,outerSize:n,scrollOffset:a,lanes:i}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=Se(()=>{let r=null,n=null;const a=this.calculateRange();return a&&(r=a.startIndex,n=a.endIndex),this.maybeNotify.updateDeps([this.isScrolling,r,n]),[this.options.rangeExtractor,this.options.overscan,this.options.count,r,n]},(r,n,a,i,o)=>i===null||o===null?[]:r({startIndex:i,endIndex:o,overscan:n,count:a}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=r=>{const n=this.options.indexAttribute,a=r.getAttribute(n);return a?parseInt(a,10):(console.warn(`Missing attribute name '${n}={index}' on measured element.`),-1)},this._measureElement=(r,n)=>{const a=this.indexFromElement(r),i=this.measurementsCache[a];if(!i)return;const o=i.key,l=this.elementsCache.get(o);l!==r&&(l&&this.observer.unobserve(l),this.observer.observe(r),this.elementsCache.set(o,r)),r.isConnected&&this.resizeItem(a,this.options.measureElement(r,n,this))},this.resizeItem=(r,n)=>{const a=this.measurementsCache[r];if(!a)return;const i=this.itemSizeCache.get(a.key)??a.size,o=n-i;o!==0&&((this.shouldAdjustScrollPositionOnItemSizeChange!==void 0?this.shouldAdjustScrollPositionOnItemSizeChange(a,o,this):a.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=o,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(a.index),this.itemSizeCache=new Map(this.itemSizeCache.set(a.key,n)),this.notify(!1))},this.measureElement=r=>{if(!r){this.elementsCache.forEach((n,a)=>{n.isConnected||(this.observer.unobserve(n),this.elementsCache.delete(a))});return}this._measureElement(r,void 0)},this.getVirtualItems=Se(()=>[this.getVirtualIndexes(),this.getMeasurements()],(r,n)=>{const a=[];for(let i=0,o=r.length;i<o;i++){const l=r[i],c=n[l];a.push(c)}return a},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=r=>{const n=this.getMeasurements();if(n.length!==0)return cs(n[or(0,n.length-1,a=>cs(n[a]).start,r)])},this.getOffsetForAlignment=(r,n,a=0)=>{const i=this.getSize(),o=this.getScrollOffset();n==="auto"&&(n=r>=o+i?"end":"start"),n==="center"?r+=(a-i)/2:n==="end"&&(r-=i);const l=this.getTotalSize()+this.options.scrollMargin-i;return Math.max(Math.min(l,r),0)},this.getOffsetForIndex=(r,n="auto")=>{r=Math.max(0,Math.min(r,this.options.count-1));const a=this.measurementsCache[r];if(!a)return;const i=this.getSize(),o=this.getScrollOffset();if(n==="auto")if(a.end>=o+i-this.options.scrollPaddingEnd)n="end";else if(a.start<=o+this.options.scrollPaddingStart)n="start";else return[o,n];const l=n==="end"?a.end+this.options.scrollPaddingEnd:a.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(l,n,a.size),n]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(r,{align:n="start",behavior:a}={})=>{a==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(r,n),{adjustments:void 0,behavior:a})},this.scrollToIndex=(r,{align:n="auto",behavior:a}={})=>{a==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),r=Math.max(0,Math.min(r,this.options.count-1));let i=0;const o=10,l=d=>{if(!this.targetWindow)return;const x=this.getOffsetForIndex(r,d);if(!x){console.warn("Failed to get offset for index:",r);return}const[h,j]=x;this._scrollToOffset(h,{adjustments:void 0,behavior:a}),this.targetWindow.requestAnimationFrame(()=>{const y=this.getScrollOffset(),p=this.getOffsetForIndex(r,j);if(!p){console.warn("Failed to get offset for index:",r);return}Da(p[0],y)||c(j)})},c=d=>{this.targetWindow&&(i++,i<o?this.targetWindow.requestAnimationFrame(()=>l(d)):console.warn(`Failed to scroll to index ${r} after ${o} attempts.`))};l(n)},this.scrollBy=(r,{behavior:n}={})=>{n==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+r,{adjustments:void 0,behavior:n})},this.getTotalSize=()=>{var r;const n=this.getMeasurements();let a;if(n.length===0)a=this.options.paddingStart;else if(this.options.lanes===1)a=((r=n[n.length-1])==null?void 0:r.end)??0;else{const i=Array(this.options.lanes).fill(null);let o=n.length-1;for(;o>=0&&i.some(l=>l===null);){const l=n[o];i[l.lane]===null&&(i[l.lane]=l.end),o--}a=Math.max(...i.filter(l=>l!==null))}return Math.max(a-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(r,{adjustments:n,behavior:a})=>{this.options.scrollToFn(r,{behavior:a,adjustments:n},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(s)}}const or=(t,s,r,n)=>{for(;t<=s;){const a=(t+s)/2|0,i=r(a);if(i<n)t=a+1;else if(i>n)s=a-1;else return a}return t>0?t-1:0};function Ba({measurements:t,outerSize:s,scrollOffset:r,lanes:n}){const a=t.length-1,i=c=>t[c].start;if(t.length<=n)return{startIndex:0,endIndex:a};let o=or(0,a,i,r),l=o;if(n===1)for(;l<a&&t[l].end<r+s;)l++;else if(n>1){const c=Array(n).fill(0);for(;l<a&&c.some(x=>x<r+s);){const x=t[l];c[x.lane]=x.end,l++}const d=Array(n).fill(r+s);for(;o>=0&&d.some(x=>x>=r);){const x=t[o];d[x.lane]=x.start,o--}o=Math.max(0,o-o%n),l=Math.min(a,l+(n-1-l%n))}return{startIndex:o,endIndex:l}}const ms=typeof document<"u"?u.useLayoutEffect:u.useEffect;function $a(t){const s=u.useReducer(()=>({}),{})[1],r={...t,onChange:(a,i)=>{var o;i?_t.flushSync(s):s(),(o=t.onChange)==null||o.call(t,a,i)}},[n]=u.useState(()=>new Aa(r));return n.setOptions(r),ms(()=>n._didMount(),[]),ms(()=>n._willUpdate()),n}function lr(t){return $a({observeElementRect:Pa,observeElementOffset:Fa,scrollToFn:_a,...t})}const cr=6048e5,Ha=864e5,Yt=6e4,Gt=36e5,hs=Symbol.for("constructDateFrom");function ie(t,s){return typeof t=="function"?t(s):t&&typeof t=="object"&&hs in t?t[hs](s):t instanceof Date?new t.constructor(s):new Date(s)}function se(t,s){return ie(s||t,t)}function Wa(t,s,r){const n=se(t,r==null?void 0:r.in);return isNaN(s)?ie(t,NaN):(n.setDate(n.getDate()+s),n)}let Ua={};function yt(){return Ua}function Je(t,s){var l,c,d,x;const r=yt(),n=(s==null?void 0:s.weekStartsOn)??((c=(l=s==null?void 0:s.locale)==null?void 0:l.options)==null?void 0:c.weekStartsOn)??r.weekStartsOn??((x=(d=r.locale)==null?void 0:d.options)==null?void 0:x.weekStartsOn)??0,a=se(t,s==null?void 0:s.in),i=a.getDay(),o=(i<n?7:0)+i-n;return a.setDate(a.getDate()-o),a.setHours(0,0,0,0),a}function ct(t,s){return Je(t,{...s,weekStartsOn:1})}function dr(t,s){const r=se(t,s==null?void 0:s.in),n=r.getFullYear(),a=ie(r,0);a.setFullYear(n+1,0,4),a.setHours(0,0,0,0);const i=ct(a),o=ie(r,0);o.setFullYear(n,0,4),o.setHours(0,0,0,0);const l=ct(o);return r.getTime()>=i.getTime()?n+1:r.getTime()>=l.getTime()?n:n-1}function ps(t){const s=se(t),r=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()));return r.setUTCFullYear(s.getFullYear()),+t-+r}function Jt(t,...s){const r=ie.bind(null,s.find(n=>typeof n=="object"));return s.map(r)}function dt(t,s){const r=se(t,s==null?void 0:s.in);return r.setHours(0,0,0,0),r}function Va(t,s,r){const[n,a]=Jt(r==null?void 0:r.in,t,s),i=dt(n),o=dt(a),l=+i-ps(i),c=+o-ps(o);return Math.round((l-c)/Ha)}function qa(t,s){const r=dr(t,s),n=ie(t,0);return n.setFullYear(r,0,4),n.setHours(0,0,0,0),ct(n)}function ur(t){return ie(t,Date.now())}function xr(t,s,r){const[n,a]=Jt(r==null?void 0:r.in,t,s);return+dt(n)==+dt(a)}function Ya(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function Ga(t){return!(!Ya(t)&&typeof t!="number"||isNaN(+se(t)))}function Qt(t){return s=>{const r=Math.trunc,n=r(s);return n===0?0:n}}function Ja(t,s,r){const[n,a]=Jt(r==null?void 0:r.in,t,s),i=(+n-+a)/Gt;return Qt()(i)}function mr(t,s){return+se(t)-+se(s)}function hr(t,s,r){const n=mr(t,s)/Yt;return Qt()(n)}function Qa(t,s,r){const n=mr(t,s)/1e3;return Qt()(n)}function Ka(t,s){const r=se(t,s==null?void 0:s.in);return r.setFullYear(r.getFullYear(),0,1),r.setHours(0,0,0,0),r}const Xa={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Za=(t,s,r)=>{let n;const a=Xa[t];return typeof a=="string"?n=a:s===1?n=a.one:n=a.other.replace("{{count}}",s.toString()),r!=null&&r.addSuffix?r.comparison&&r.comparison>0?"in "+n:n+" ago":n};function Tt(t){return(s={})=>{const r=s.width?String(s.width):t.defaultWidth;return t.formats[r]||t.formats[t.defaultWidth]}}const ei={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},ti={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},si={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},ri={date:Tt({formats:ei,defaultWidth:"full"}),time:Tt({formats:ti,defaultWidth:"full"}),dateTime:Tt({formats:si,defaultWidth:"full"})},ni={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},ai=(t,s,r,n)=>ni[t];function _e(t){return(s,r)=>{const n=r!=null&&r.context?String(r.context):"standalone";let a;if(n==="formatting"&&t.formattingValues){const o=t.defaultFormattingWidth||t.defaultWidth,l=r!=null&&r.width?String(r.width):o;a=t.formattingValues[l]||t.formattingValues[o]}else{const o=t.defaultWidth,l=r!=null&&r.width?String(r.width):t.defaultWidth;a=t.values[l]||t.values[o]}const i=t.argumentCallback?t.argumentCallback(s):s;return a[i]}}const ii={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},oi={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},li={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},ci={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},di={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},ui={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},xi=(t,s)=>{const r=Number(t),n=r%100;if(n>20||n<10)switch(n%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},mi={ordinalNumber:xi,era:_e({values:ii,defaultWidth:"wide"}),quarter:_e({values:oi,defaultWidth:"wide",argumentCallback:t=>t-1}),month:_e({values:li,defaultWidth:"wide"}),day:_e({values:ci,defaultWidth:"wide"}),dayPeriod:_e({values:di,defaultWidth:"wide",formattingValues:ui,defaultFormattingWidth:"wide"})};function Ae(t){return(s,r={})=>{const n=r.width,a=n&&t.matchPatterns[n]||t.matchPatterns[t.defaultMatchWidth],i=s.match(a);if(!i)return null;const o=i[0],l=n&&t.parsePatterns[n]||t.parsePatterns[t.defaultParseWidth],c=Array.isArray(l)?pi(l,h=>h.test(o)):hi(l,h=>h.test(o));let d;d=t.valueCallback?t.valueCallback(c):c,d=r.valueCallback?r.valueCallback(d):d;const x=s.slice(o.length);return{value:d,rest:x}}}function hi(t,s){for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&s(t[r]))return r}function pi(t,s){for(let r=0;r<t.length;r++)if(s(t[r]))return r}function fi(t){return(s,r={})=>{const n=s.match(t.matchPattern);if(!n)return null;const a=n[0],i=s.match(t.parsePattern);if(!i)return null;let o=t.valueCallback?t.valueCallback(i[0]):i[0];o=r.valueCallback?r.valueCallback(o):o;const l=s.slice(a.length);return{value:o,rest:l}}}const gi=/^(\d+)(th|st|nd|rd)?/i,bi=/\d+/i,yi={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},ji={any:[/^b/i,/^(a|c)/i]},vi={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},wi={any:[/1/i,/2/i,/3/i,/4/i]},Ni={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},ki={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Ci={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Ei={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Ti={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Si={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Ii={ordinalNumber:fi({matchPattern:gi,parsePattern:bi,valueCallback:t=>parseInt(t,10)}),era:Ae({matchPatterns:yi,defaultMatchWidth:"wide",parsePatterns:ji,defaultParseWidth:"any"}),quarter:Ae({matchPatterns:vi,defaultMatchWidth:"wide",parsePatterns:wi,defaultParseWidth:"any",valueCallback:t=>t+1}),month:Ae({matchPatterns:Ni,defaultMatchWidth:"wide",parsePatterns:ki,defaultParseWidth:"any"}),day:Ae({matchPatterns:Ci,defaultMatchWidth:"wide",parsePatterns:Ei,defaultParseWidth:"any"}),dayPeriod:Ae({matchPatterns:Ti,defaultMatchWidth:"any",parsePatterns:Si,defaultParseWidth:"any"})},Li={code:"en-US",formatDistance:Za,formatLong:ri,formatRelative:ai,localize:mi,match:Ii,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Di(t,s){const r=se(t,s==null?void 0:s.in);return Va(r,Ka(r))+1}function Mi(t,s){const r=se(t,s==null?void 0:s.in),n=+ct(r)-+qa(r);return Math.round(n/cr)+1}function pr(t,s){var x,h,j,y;const r=se(t,s==null?void 0:s.in),n=r.getFullYear(),a=yt(),i=(s==null?void 0:s.firstWeekContainsDate)??((h=(x=s==null?void 0:s.locale)==null?void 0:x.options)==null?void 0:h.firstWeekContainsDate)??a.firstWeekContainsDate??((y=(j=a.locale)==null?void 0:j.options)==null?void 0:y.firstWeekContainsDate)??1,o=ie((s==null?void 0:s.in)||t,0);o.setFullYear(n+1,0,i),o.setHours(0,0,0,0);const l=Je(o,s),c=ie((s==null?void 0:s.in)||t,0);c.setFullYear(n,0,i),c.setHours(0,0,0,0);const d=Je(c,s);return+r>=+l?n+1:+r>=+d?n:n-1}function Ri(t,s){var l,c,d,x;const r=yt(),n=(s==null?void 0:s.firstWeekContainsDate)??((c=(l=s==null?void 0:s.locale)==null?void 0:l.options)==null?void 0:c.firstWeekContainsDate)??r.firstWeekContainsDate??((x=(d=r.locale)==null?void 0:d.options)==null?void 0:x.firstWeekContainsDate)??1,a=pr(t,s),i=ie((s==null?void 0:s.in)||t,0);return i.setFullYear(a,0,n),i.setHours(0,0,0,0),Je(i,s)}function Oi(t,s){const r=se(t,s==null?void 0:s.in),n=+Je(r,s)-+Ri(r,s);return Math.round(n/cr)+1}function K(t,s){const r=t<0?"-":"",n=Math.abs(t).toString().padStart(s,"0");return r+n}const ge={y(t,s){const r=t.getFullYear(),n=r>0?r:1-r;return K(s==="yy"?n%100:n,s.length)},M(t,s){const r=t.getMonth();return s==="M"?String(r+1):K(r+1,2)},d(t,s){return K(t.getDate(),s.length)},a(t,s){const r=t.getHours()/12>=1?"pm":"am";switch(s){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];case"aaaa":default:return r==="am"?"a.m.":"p.m."}},h(t,s){return K(t.getHours()%12||12,s.length)},H(t,s){return K(t.getHours(),s.length)},m(t,s){return K(t.getMinutes(),s.length)},s(t,s){return K(t.getSeconds(),s.length)},S(t,s){const r=s.length,n=t.getMilliseconds(),a=Math.trunc(n*Math.pow(10,r-3));return K(a,s.length)}},Ie={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},fs={G:function(t,s,r){const n=t.getFullYear()>0?1:0;switch(s){case"G":case"GG":case"GGG":return r.era(n,{width:"abbreviated"});case"GGGGG":return r.era(n,{width:"narrow"});case"GGGG":default:return r.era(n,{width:"wide"})}},y:function(t,s,r){if(s==="yo"){const n=t.getFullYear(),a=n>0?n:1-n;return r.ordinalNumber(a,{unit:"year"})}return ge.y(t,s)},Y:function(t,s,r,n){const a=pr(t,n),i=a>0?a:1-a;if(s==="YY"){const o=i%100;return K(o,2)}return s==="Yo"?r.ordinalNumber(i,{unit:"year"}):K(i,s.length)},R:function(t,s){const r=dr(t);return K(r,s.length)},u:function(t,s){const r=t.getFullYear();return K(r,s.length)},Q:function(t,s,r){const n=Math.ceil((t.getMonth()+1)/3);switch(s){case"Q":return String(n);case"QQ":return K(n,2);case"Qo":return r.ordinalNumber(n,{unit:"quarter"});case"QQQ":return r.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return r.quarter(n,{width:"wide",context:"formatting"})}},q:function(t,s,r){const n=Math.ceil((t.getMonth()+1)/3);switch(s){case"q":return String(n);case"qq":return K(n,2);case"qo":return r.ordinalNumber(n,{unit:"quarter"});case"qqq":return r.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return r.quarter(n,{width:"wide",context:"standalone"})}},M:function(t,s,r){const n=t.getMonth();switch(s){case"M":case"MM":return ge.M(t,s);case"Mo":return r.ordinalNumber(n+1,{unit:"month"});case"MMM":return r.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return r.month(n,{width:"wide",context:"formatting"})}},L:function(t,s,r){const n=t.getMonth();switch(s){case"L":return String(n+1);case"LL":return K(n+1,2);case"Lo":return r.ordinalNumber(n+1,{unit:"month"});case"LLL":return r.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return r.month(n,{width:"wide",context:"standalone"})}},w:function(t,s,r,n){const a=Oi(t,n);return s==="wo"?r.ordinalNumber(a,{unit:"week"}):K(a,s.length)},I:function(t,s,r){const n=Mi(t);return s==="Io"?r.ordinalNumber(n,{unit:"week"}):K(n,s.length)},d:function(t,s,r){return s==="do"?r.ordinalNumber(t.getDate(),{unit:"date"}):ge.d(t,s)},D:function(t,s,r){const n=Di(t);return s==="Do"?r.ordinalNumber(n,{unit:"dayOfYear"}):K(n,s.length)},E:function(t,s,r){const n=t.getDay();switch(s){case"E":case"EE":case"EEE":return r.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(n,{width:"short",context:"formatting"});case"EEEE":default:return r.day(n,{width:"wide",context:"formatting"})}},e:function(t,s,r,n){const a=t.getDay(),i=(a-n.weekStartsOn+8)%7||7;switch(s){case"e":return String(i);case"ee":return K(i,2);case"eo":return r.ordinalNumber(i,{unit:"day"});case"eee":return r.day(a,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(a,{width:"short",context:"formatting"});case"eeee":default:return r.day(a,{width:"wide",context:"formatting"})}},c:function(t,s,r,n){const a=t.getDay(),i=(a-n.weekStartsOn+8)%7||7;switch(s){case"c":return String(i);case"cc":return K(i,s.length);case"co":return r.ordinalNumber(i,{unit:"day"});case"ccc":return r.day(a,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(a,{width:"narrow",context:"standalone"});case"cccccc":return r.day(a,{width:"short",context:"standalone"});case"cccc":default:return r.day(a,{width:"wide",context:"standalone"})}},i:function(t,s,r){const n=t.getDay(),a=n===0?7:n;switch(s){case"i":return String(a);case"ii":return K(a,s.length);case"io":return r.ordinalNumber(a,{unit:"day"});case"iii":return r.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(n,{width:"short",context:"formatting"});case"iiii":default:return r.day(n,{width:"wide",context:"formatting"})}},a:function(t,s,r){const a=t.getHours()/12>=1?"pm":"am";switch(s){case"a":case"aa":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(a,{width:"narrow",context:"formatting"});case"aaaa":default:return r.dayPeriod(a,{width:"wide",context:"formatting"})}},b:function(t,s,r){const n=t.getHours();let a;switch(n===12?a=Ie.noon:n===0?a=Ie.midnight:a=n/12>=1?"pm":"am",s){case"b":case"bb":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(a,{width:"narrow",context:"formatting"});case"bbbb":default:return r.dayPeriod(a,{width:"wide",context:"formatting"})}},B:function(t,s,r){const n=t.getHours();let a;switch(n>=17?a=Ie.evening:n>=12?a=Ie.afternoon:n>=4?a=Ie.morning:a=Ie.night,s){case"B":case"BB":case"BBB":return r.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(a,{width:"narrow",context:"formatting"});case"BBBB":default:return r.dayPeriod(a,{width:"wide",context:"formatting"})}},h:function(t,s,r){if(s==="ho"){let n=t.getHours()%12;return n===0&&(n=12),r.ordinalNumber(n,{unit:"hour"})}return ge.h(t,s)},H:function(t,s,r){return s==="Ho"?r.ordinalNumber(t.getHours(),{unit:"hour"}):ge.H(t,s)},K:function(t,s,r){const n=t.getHours()%12;return s==="Ko"?r.ordinalNumber(n,{unit:"hour"}):K(n,s.length)},k:function(t,s,r){let n=t.getHours();return n===0&&(n=24),s==="ko"?r.ordinalNumber(n,{unit:"hour"}):K(n,s.length)},m:function(t,s,r){return s==="mo"?r.ordinalNumber(t.getMinutes(),{unit:"minute"}):ge.m(t,s)},s:function(t,s,r){return s==="so"?r.ordinalNumber(t.getSeconds(),{unit:"second"}):ge.s(t,s)},S:function(t,s){return ge.S(t,s)},X:function(t,s,r){const n=t.getTimezoneOffset();if(n===0)return"Z";switch(s){case"X":return bs(n);case"XXXX":case"XX":return Ne(n);case"XXXXX":case"XXX":default:return Ne(n,":")}},x:function(t,s,r){const n=t.getTimezoneOffset();switch(s){case"x":return bs(n);case"xxxx":case"xx":return Ne(n);case"xxxxx":case"xxx":default:return Ne(n,":")}},O:function(t,s,r){const n=t.getTimezoneOffset();switch(s){case"O":case"OO":case"OOO":return"GMT"+gs(n,":");case"OOOO":default:return"GMT"+Ne(n,":")}},z:function(t,s,r){const n=t.getTimezoneOffset();switch(s){case"z":case"zz":case"zzz":return"GMT"+gs(n,":");case"zzzz":default:return"GMT"+Ne(n,":")}},t:function(t,s,r){const n=Math.trunc(+t/1e3);return K(n,s.length)},T:function(t,s,r){return K(+t,s.length)}};function gs(t,s=""){const r=t>0?"-":"+",n=Math.abs(t),a=Math.trunc(n/60),i=n%60;return i===0?r+String(a):r+String(a)+s+K(i,2)}function bs(t,s){return t%60===0?(t>0?"-":"+")+K(Math.abs(t)/60,2):Ne(t,s)}function Ne(t,s=""){const r=t>0?"-":"+",n=Math.abs(t),a=K(Math.trunc(n/60),2),i=K(n%60,2);return r+a+s+i}const ys=(t,s)=>{switch(t){case"P":return s.date({width:"short"});case"PP":return s.date({width:"medium"});case"PPP":return s.date({width:"long"});case"PPPP":default:return s.date({width:"full"})}},fr=(t,s)=>{switch(t){case"p":return s.time({width:"short"});case"pp":return s.time({width:"medium"});case"ppp":return s.time({width:"long"});case"pppp":default:return s.time({width:"full"})}},Pi=(t,s)=>{const r=t.match(/(P+)(p+)?/)||[],n=r[1],a=r[2];if(!a)return ys(t,s);let i;switch(n){case"P":i=s.dateTime({width:"short"});break;case"PP":i=s.dateTime({width:"medium"});break;case"PPP":i=s.dateTime({width:"long"});break;case"PPPP":default:i=s.dateTime({width:"full"});break}return i.replace("{{date}}",ys(n,s)).replace("{{time}}",fr(a,s))},Fi={p:fr,P:Pi},zi=/^D+$/,_i=/^Y+$/,Ai=["D","DD","YY","YYYY"];function Bi(t){return zi.test(t)}function $i(t){return _i.test(t)}function Hi(t,s,r){const n=Wi(t,s,r);if(console.warn(n),Ai.includes(t))throw new RangeError(n)}function Wi(t,s,r){const n=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${s}\`) for formatting ${n} to the input \`${r}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const Ui=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Vi=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,qi=/^'([^]*?)'?$/,Yi=/''/g,Gi=/[a-zA-Z]/;function De(t,s,r){var x,h,j,y;const n=yt(),a=n.locale??Li,i=n.firstWeekContainsDate??((h=(x=n.locale)==null?void 0:x.options)==null?void 0:h.firstWeekContainsDate)??1,o=n.weekStartsOn??((y=(j=n.locale)==null?void 0:j.options)==null?void 0:y.weekStartsOn)??0,l=se(t,r==null?void 0:r.in);if(!Ga(l))throw new RangeError("Invalid time value");let c=s.match(Vi).map(p=>{const g=p[0];if(g==="p"||g==="P"){const v=Fi[g];return v(p,a.formatLong)}return p}).join("").match(Ui).map(p=>{if(p==="''")return{isToken:!1,value:"'"};const g=p[0];if(g==="'")return{isToken:!1,value:Ji(p)};if(fs[g])return{isToken:!0,value:p};if(g.match(Gi))throw new RangeError("Format string contains an unescaped latin alphabet character `"+g+"`");return{isToken:!1,value:p}});a.localize.preprocessor&&(c=a.localize.preprocessor(l,c));const d={firstWeekContainsDate:i,weekStartsOn:o,locale:a};return c.map(p=>{if(!p.isToken)return p.value;const g=p.value;($i(g)||Bi(g))&&Hi(g,s,String(t));const v=fs[g[0]];return v(l,g,a.localize,d)}).join("")}function Ji(t){const s=t.match(qi);return s?s[1].replace(Yi,"'"):t}function gr(t,s){return xr(ie(t,t),ur(t))}function Qi(t,s,r){return Wa(t,-1,r)}function br(t,s){return xr(ie(t,t),Qi(ur(t)))}function yr(t,s){const r=()=>ie(s==null?void 0:s.in,NaN),a=eo(t);let i;if(a.date){const d=to(a.date,2);i=so(d.restDateString,d.year)}if(!i||isNaN(+i))return r();const o=+i;let l=0,c;if(a.time&&(l=ro(a.time),isNaN(l)))return r();if(a.timezone){if(c=no(a.timezone),isNaN(c))return r()}else{const d=new Date(o+l),x=se(0,s==null?void 0:s.in);return x.setFullYear(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()),x.setHours(d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()),x}return se(o+l+c,s==null?void 0:s.in)}const rt={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Ki=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Xi=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Zi=/^([+-])(\d{2})(?::?(\d{2}))?$/;function eo(t){const s={},r=t.split(rt.dateTimeDelimiter);let n;if(r.length>2)return s;if(/:/.test(r[0])?n=r[0]:(s.date=r[0],n=r[1],rt.timeZoneDelimiter.test(s.date)&&(s.date=t.split(rt.timeZoneDelimiter)[0],n=t.substr(s.date.length,t.length))),n){const a=rt.timezone.exec(n);a?(s.time=n.replace(a[1],""),s.timezone=a[1]):s.time=n}return s}function to(t,s){const r=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+s)+"})|(\\d{2}|[+-]\\d{"+(2+s)+"})$)"),n=t.match(r);if(!n)return{year:NaN,restDateString:""};const a=n[1]?parseInt(n[1]):null,i=n[2]?parseInt(n[2]):null;return{year:i===null?a:i*100,restDateString:t.slice((n[1]||n[2]).length)}}function so(t,s){if(s===null)return new Date(NaN);const r=t.match(Ki);if(!r)return new Date(NaN);const n=!!r[4],a=Be(r[1]),i=Be(r[2])-1,o=Be(r[3]),l=Be(r[4]),c=Be(r[5])-1;if(n)return co(s,l,c)?ao(s,l,c):new Date(NaN);{const d=new Date(0);return!oo(s,i,o)||!lo(s,a)?new Date(NaN):(d.setUTCFullYear(s,i,Math.max(a,o)),d)}}function Be(t){return t?parseInt(t):1}function ro(t){const s=t.match(Xi);if(!s)return NaN;const r=St(s[1]),n=St(s[2]),a=St(s[3]);return uo(r,n,a)?r*Gt+n*Yt+a*1e3:NaN}function St(t){return t&&parseFloat(t.replace(",","."))||0}function no(t){if(t==="Z")return 0;const s=t.match(Zi);if(!s)return 0;const r=s[1]==="+"?-1:1,n=parseInt(s[2]),a=s[3]&&parseInt(s[3])||0;return xo(n,a)?r*(n*Gt+a*Yt):NaN}function ao(t,s,r){const n=new Date(0);n.setUTCFullYear(t,0,4);const a=n.getUTCDay()||7,i=(s-1)*7+r+1-a;return n.setUTCDate(n.getUTCDate()+i),n}const io=[31,null,31,30,31,30,31,31,30,31,30,31];function jr(t){return t%400===0||t%4===0&&t%100!==0}function oo(t,s,r){return s>=0&&s<=11&&r>=1&&r<=(io[s]||(jr(t)?29:28))}function lo(t,s){return s>=1&&s<=(jr(t)?366:365)}function co(t,s,r){return s>=1&&s<=53&&r>=0&&r<=6}function uo(t,s,r){return t===24?s===0&&r===0:r>=0&&r<60&&s>=0&&s<60&&t>=0&&t<25}function xo(t,s){return s>=0&&s<=59}function vr(t){try{const s=typeof t=="string"?yr(t):new Date(t),r=new Date,n=Qa(r,s),a=hr(r,s),i=Ja(r,s);return n<5?"刚刚":n<60?`${n} 秒前`:a<60?`${a} 分钟前`:i<24?`${i} 小时前`:gr(s)?`今天 ${De(s,"HH:mm")}`:br(s)?`昨天 ${De(s,"HH:mm")}`:De(s,"MM-dd HH:mm")}catch{return t}}function ue(t){try{const s=typeof t=="string"?yr(t):new Date(t);return hr(new Date,s)<5?vr(t):gr(s)?De(s,"HH:mm:ss"):br(s)?`昨天 ${De(s,"HH:mm")}`:De(s,"MM/dd HH:mm")}catch{return t}}function wr(t){if(t==null)return"text-text-muted";const s=t*1e3;return s<100?"text-green-400":s<500?"text-green-300":s<1e3?"text-yellow-400":s<3e3?"text-orange-400":"text-red-400"}function Qe(t,s){let r;if(t instanceof Date&&s instanceof Date)r=s.getTime()-t.getTime();else if(typeof t=="number"){if(t===null)return"-";r=t*1e3}else return"-";if(r<0)return"-";if(r<1)return`${Math.round(r*1e3)}µs`;if(r<1e3)return`${Math.round(r)}ms`;if(r<6e4)return`${(r/1e3).toFixed(1)}s`;if(r<36e5){const i=Math.floor(r/6e4),o=Math.floor(r%6e4/1e3);return`${i}m ${o}s`}const n=Math.floor(r/36e5),a=Math.floor(r%36e5/6e4);return`${n}h ${a}m`}function ut(t){if(t===0)return"0 B";if(t<0)return"-";const s=1024,r=["B","KB","MB","GB"],n=Math.floor(Math.log(t)/Math.log(s));return parseFloat((t/Math.pow(s,n)).toFixed(2))+" "+r[n]}function mo(t,s=60){try{const r=new URL(t),n=r.pathname+r.search;return n.length>s?n.substring(0,s)+"...":n}catch{return t.length>s?t.substring(0,s)+"...":t}}function Kt(t){try{return new URL(t).hostname}catch{return t}}function Xt(t){return t?t>=200&&t<300?"bg-green-500/15 text-green-400 border border-green-500/30":t>=300&&t<400?"bg-blue-500/15 text-blue-400 border border-blue-500/30":t>=400&&t<500?"bg-yellow-500/15 text-yellow-400 border border-yellow-500/30":"bg-red-500/15 text-red-400 border border-red-500/30":"bg-red-500/20 text-red-400 border border-red-500/30"}function Zt(t){return{GET:"bg-method-get/20 text-method-get border border-method-get/30",POST:"bg-method-post/20 text-method-post border border-method-post/30",PUT:"bg-method-put/20 text-method-put border border-method-put/30",DELETE:"bg-method-delete/20 text-method-delete border border-method-delete/30",PATCH:"bg-method-patch/20 text-method-patch border border-method-patch/30"}[t.toUpperCase()]||"bg-gray-500/20 text-gray-400 border border-gray-500/30"}function js(t){try{return atob(t)}catch{return t}}function ho(t){const s={verbose:{color:"text-level-verbose",bg:"bg-level-verbose/10",border:"border-l-level-verbose"},debug:{color:"text-level-debug",bg:"bg-level-debug/10",border:"border-l-level-debug"},info:{color:"text-level-info",bg:"bg-level-info/10",border:"border-l-level-info"},warning:{color:"text-level-warning",bg:"bg-level-warning/10",border:"border-l-level-warning"},error:{color:"text-level-error",bg:"bg-level-error/10",border:"border-l-level-error"}};return s[t.toLowerCase()]||s.debug}const po={httpRequest:{label:"HTTP 请求",icon:e.jsx(Ot,{size:12}),color:"text-blue-400"},httpResponse:{label:"HTTP 响应",icon:e.jsx(Pt,{size:12}),color:"text-green-400"},wsOutgoing:{label:"WS 发送",icon:e.jsx(Ot,{size:12}),color:"text-purple-400"},wsIncoming:{label:"WS 接收",icon:e.jsx(Pt,{size:12}),color:"text-orange-400"}};function fo(t,s){if(!s)return!0;if(s.startsWith("^")||s.includes("\\"))try{return new RegExp(s).test(t)}catch{}const r=s.replace(/[.+?^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*");try{return new RegExp(`^${r}$`,"i").test(t)}catch{return!1}}function go(t,s,r){if(r){const n=s.find(a=>a.id===r);if(n)return[n]}return s.filter(n=>!n.enabled||n.targetType!=="httpRequest"&&n.targetType!=="httpResponse"?!1:fo(t,n.condition.urlPattern))}function Nr({url:t,mockRuleId:s,rules:r,onEditRule:n,children:a}){const[i,o]=u.useState(!1),l=u.useRef(null),c=u.useRef(null),d=go(t,r,s);u.useEffect(()=>{const g=v=>{l.current&&!l.current.contains(v.target)&&c.current&&!c.current.contains(v.target)&&o(!1)};return i&&document.addEventListener("mousedown",g),()=>{document.removeEventListener("mousedown",g)}},[i]);const x=g=>{g.stopPropagation(),o(!i)},h=(g,v)=>{v.stopPropagation(),o(!1),n==null||n(g)},[j,y]=u.useState({top:0,left:0});u.useLayoutEffect(()=>{if(i&&c.current){const g=c.current.getBoundingClientRect();y({top:g.top-8,left:g.left+g.width/2})}},[i]);const p=i?_t.createPortal(e.jsxs("div",{ref:l,style:{position:"fixed",top:j.top,left:j.left,transform:"translate(-50%, -100%)"},className:"z-[300] min-w-[280px] max-w-[360px]",children:[e.jsxs("div",{className:"bg-bg-dark border border-border rounded-xl shadow-2xl overflow-hidden",children:[e.jsx("div",{className:"px-3 py-2 border-b border-border bg-bg-medium/50",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{size:14,className:"text-purple-400"}),e.jsx("span",{className:"text-xs font-medium text-text-primary",children:"匹配的 Mock 规则"}),e.jsxs("span",{className:"text-xs text-text-muted",children:["(",d.length,")"]})]})}),e.jsx("div",{className:"max-h-[240px] overflow-auto",children:d.length>0?e.jsx("div",{className:"divide-y divide-border/50",children:d.map(g=>{const v=po[g.targetType];return e.jsx("div",{className:"px-3 py-2 hover:bg-bg-light/50 transition-colors group",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:b("flex items-center gap-1 text-xs",v.color),children:[v.icon,v.label]}),e.jsx("span",{className:"text-xs font-medium text-text-primary truncate",children:g.name})]}),e.jsx("div",{className:"text-xs text-text-muted font-mono truncate",title:g.condition.urlPattern||"所有 URL",children:g.condition.urlPattern||"*"})]}),n&&e.jsx("button",{onClick:f=>h(g,f),className:"p-1.5 rounded-lg text-text-muted hover:text-primary hover:bg-bg-light opacity-0 group-hover:opacity-100 transition-all",title:"编辑规则",children:e.jsx(tr,{size:12})})]})},g.id)})}):e.jsx("div",{className:"px-3 py-4 text-center text-text-muted text-xs",children:"没有找到匹配的规则"})}),e.jsx("div",{className:"px-3 py-2 border-t border-border bg-bg-medium/30",children:e.jsx("p",{className:"text-xs text-text-muted text-center",children:"点击规则可编辑"})})]}),e.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -bottom-1 w-2 h-2 bg-bg-dark border-r border-b border-border rotate-45",style:{bottom:"-4px"}})]}),document.body):null;return e.jsxs("div",{className:"relative inline-flex",children:[e.jsx("div",{ref:c,onClick:x,className:"cursor-pointer",children:a}),p]})}const bo=56;function vs(t,s){return s.find(r=>{if(!r.isEnabled)return!1;if(r.matchType==="domain")try{const n=new URL(t.url);return n.hostname===r.matchValue||n.hostname.endsWith("."+r.matchValue)}catch{return!1}if(r.matchType==="urlRegex")try{return new RegExp(r.matchValue).test(t.url)}catch{return!1}return!1})}function yo({items:t,selectedId:s,onSelect:r,autoScroll:n,deviceId:a,isSelectMode:i=!1,selectedIds:o=new Set,onToggleSelect:l,mockRules:c=[],onEditMockRule:d}){const x=u.useRef(null),h=u.useRef(null),{deviceRules:j,rules:y,fetchDeviceRules:p,fetchRules:g}=Oe(),{isFavorite:v}=ht();u.useEffect(()=>{a?p(a):g()},[a,p,g]);const f=u.useMemo(()=>a?j:y,[a,j,y]),D=u.useMemo(()=>t.filter(F=>!Ue(F)),[t]),T=u.useMemo(()=>f.length===0?D:D.filter(F=>{const G=vs(F,f);return!G||G.action!=="hide"}),[D,f]),W=lr({count:T.length,getScrollElement:()=>x.current,estimateSize:()=>bo,overscan:10}),H=W.getVirtualItems();u.useEffect(()=>{const F=T[0],G=(F==null?void 0:F.id)??null,C=G!==null&&G!==h.current;n&&C&&W.scrollToIndex(0,{align:"start",behavior:"smooth"}),h.current=G},[T,n,W]);const z=u.useCallback((F,G)=>{i&&l?(G.preventDefault(),l(F.id)):s===F.id?r(""):r(F.id)},[i,l,r,s]),P=(F,G)=>{const C=!F.statusCode||F.statusCode>=400,_=F.id===s,U=o.has(F.id),L=a?v(a,F.url):F.isFavorite,E=vs(F,f),m=(E==null?void 0:E.action)==="highlight",N=(E==null?void 0:E.action)==="mark",w=E==null?void 0:E.color,M=N&&w&&!_?{...G,borderLeftColor:w}:G;return e.jsxs("div",{style:M,onClick:k=>z(F,k),className:b("flex items-center cursor-pointer transition-all duration-150 group border-b border-border-light",C&&!_&&!m&&"bg-red-500/5 hover:bg-red-500/10",_&&"bg-accent-blue/15 border-l-2 border-l-accent-blue",U&&!_&&"bg-primary/15",m&&!_&&"bg-yellow-500/10 hover:bg-yellow-500/20 border-l-4 border-l-yellow-500",N&&!_&&!m&&"border-l-4",!_&&!U&&!C&&!m&&!N&&"hover:bg-bg-light/60"),children:[(m||N)&&!_&&e.jsxs("div",{className:"w-6 flex-shrink-0 flex items-center justify-center",children:[m&&e.jsx(he,{size:12,filled:!0,className:"text-yellow-500"}),N&&!m&&e.jsx(Vt,{size:12,style:{color:w||"currentColor"}})]}),i&&e.jsx("div",{className:"px-3 py-3.5 w-10 flex-shrink-0",onClick:k=>k.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:U,onChange:()=>l==null?void 0:l(F.id),className:"w-4 h-4 rounded border-border cursor-pointer accent-primary"})}),e.jsx("div",{className:b("px-4 py-3.5 w-[100px] flex-shrink-0",_?"text-accent-blue":"text-text-muted"),children:e.jsx("span",{className:"text-sm font-mono",children:ue(F.startTime)})}),e.jsx("div",{className:"px-4 py-3.5 w-[90px] flex-shrink-0",children:e.jsx("span",{className:b("inline-flex items-center justify-center px-3 py-1.5 rounded-lg text-xs font-mono font-bold min-w-[60px] shadow-sm",Zt(F.method)),children:F.method})}),e.jsx("div",{className:"px-4 py-3.5 w-[80px] flex-shrink-0",children:e.jsx("span",{className:b("inline-flex items-center justify-center px-3 py-1.5 rounded-lg text-xs font-mono font-semibold min-w-[44px] shadow-sm",Xt(F.statusCode)),children:F.statusCode??"ERR"})}),e.jsx("div",{className:"px-4 py-3.5 flex-1 min-w-0 overflow-hidden",children:e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("span",{className:b("text-sm truncate transition-colors",_?"text-accent-blue font-medium":"text-text-primary group-hover:text-primary"),title:F.url,children:mo(F.url)}),e.jsx("span",{className:b("text-xs truncate font-mono",_?"text-accent-blue/70":"text-text-muted opacity-70"),children:Kt(F.url)})]})}),e.jsx("div",{className:"px-4 py-3.5 w-[90px] flex-shrink-0",children:e.jsx("span",{className:b("text-sm font-mono font-medium",wr(F.duration)),children:Qe(F.duration)})}),e.jsxs("div",{className:"px-4 py-3.5 w-[80px] flex-shrink-0 flex items-center justify-center gap-2",children:[F.isMocked&&e.jsx(Nr,{url:F.url,mockRuleId:F.mockRuleId,rules:c,onEditRule:d,children:e.jsx("span",{className:"inline-flex items-center justify-center w-7 h-7 rounded-lg bg-purple-500/15 text-purple-400 shadow-sm shadow-purple-500/10 hover:bg-purple-500/25 transition-colors cursor-pointer",title:"已 Mock - 点击查看规则",children:e.jsx(ce,{size:14})})}),L&&e.jsx("span",{className:"badge-favorite text-base",title:"已收藏",children:e.jsx(he,{size:14,filled:!0})}),!F.isMocked&&!L&&e.jsx("span",{className:"w-7 h-7"})]})]},F.id)};return e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex items-center bg-bg-medium border-b border-border text-text-secondary sticky top-0 z-10",children:[i&&e.jsx("div",{className:"px-3 py-2 w-10 flex-shrink-0",children:e.jsx("span",{className:"sr-only",children:"选择"})}),e.jsx("div",{className:"px-4 py-2 w-[100px] flex-shrink-0 font-semibold text-xs uppercase tracking-wider",children:"时间"}),e.jsx("div",{className:"px-4 py-2 w-[90px] flex-shrink-0 font-semibold text-xs uppercase tracking-wider",children:"方法"}),e.jsx("div",{className:"px-4 py-2 w-[80px] flex-shrink-0 font-semibold text-xs uppercase tracking-wider",children:"状态"}),e.jsx("div",{className:"px-4 py-2 flex-1 font-semibold text-xs uppercase tracking-wider",children:"URL / 域名"}),e.jsx("div",{className:"px-4 py-2 w-[90px] flex-shrink-0 font-semibold text-xs uppercase tracking-wider",children:"耗时"}),e.jsx("div",{className:"px-4 py-2 w-[80px] flex-shrink-0 font-semibold text-xs uppercase tracking-wider text-center",children:"标记"})]}),e.jsx("div",{ref:x,className:"flex-1 overflow-auto",children:T.length>0?e.jsx("div",{style:{height:`${W.getTotalSize()}px`,width:"100%",position:"relative"},children:H.map(F=>{const G=T[F.index];return P(G,{position:"absolute",top:0,left:0,width:"100%",height:`${F.size}px`,transform:`translateY(${F.start}px)`})})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted py-20",children:[e.jsx("div",{className:"w-16 h-16 rounded-lg bg-bg-light flex items-center justify-center mb-4 border border-border",children:e.jsx(me,{size:32,className:"opacity-60"})}),e.jsx("p",{className:"text-sm font-medium text-text-secondary mb-1",children:"暂无 HTTP 请求"}),e.jsx("p",{className:"text-xs text-text-muted",children:"等待网络请求被捕获..."})]})})]})}function ws(t,s){return s.find(r=>{if(!r.isEnabled)return!1;if(r.matchType==="domain")try{const n=new URL(t.url);return n.hostname===r.matchValue||n.hostname.endsWith("."+r.matchValue)}catch{return!1}if(r.matchType==="urlRegex")try{return new RegExp(r.matchValue).test(t.url)}catch{return!1}return!1})}function jo(t){const s=new Map;for(const r of t){const n=Kt(r.url)||"unknown";s.has(n)||s.set(n,[]),s.get(n).push(r)}return s}function vo(t){const s=new Map;for(const r of t)try{const n=new URL(r.url),a=n.pathname.split("/").filter(Boolean),i=a.length>0?`${n.hostname}/${a.slice(0,2).join("/")}`:n.hostname;s.has(i)||s.set(i,[]),s.get(i).push(r)}catch{const n="invalid-url";s.has(n)||s.set(n,[]),s.get(n).push(r)}return s}function wo(t,s,r){if(s==="none")return[];const n=s==="domain"?jo(t):vo(t),a=[];for(const[i,o]of n){const l=o.filter(c=>c.duration!==null).map(c=>c.duration);a.push({key:i,label:i,count:o.length,events:o,expanded:r.has(i),avgDuration:l.length>0?l.reduce((c,d)=>c+d,0)/l.length:0,errorCount:o.filter(c=>!c.statusCode||c.statusCode>=400).length,mockedCount:o.filter(c=>c.isMocked).length})}return a.sort((i,o)=>o.count-i.count),a}function No(t){const s=[];for(let r=0;r<t.length;r++){const n=t[r];if(s.push({type:"group-header",group:n,index:r}),n.expanded)for(const a of n.events)s.push({type:"event",event:a,groupKey:n.key})}return s}const ko=48,Co=56;function Eo({events:t,groupMode:s,selectedId:r,onSelect:n,deviceId:a,isSelectMode:i=!1,selectedIds:o=new Set,onToggleSelect:l}){const c=u.useRef(null),[d,x]=u.useState(new Set),{deviceRules:h,rules:j,fetchDeviceRules:y,fetchRules:p}=Oe();u.useEffect(()=>{a?y(a):p()},[a,y,p]);const g=u.useMemo(()=>a?h:j,[a,h,j]),v=u.useMemo(()=>g.length===0?t:t.filter(C=>{const _=ws(C,g);return!_||_.action!=="hide"}),[t,g]),f=u.useMemo(()=>wo(v,s,d),[v,s,d]),D=u.useMemo(()=>No(f),[f]),T=lr({count:D.length,getScrollElement:()=>c.current,estimateSize:C=>D[C].type==="group-header"?ko:Co,overscan:10}),W=u.useCallback(C=>{x(_=>{const U=new Set(_);return U.has(C)?U.delete(C):U.add(C),U})},[]),H=u.useCallback(()=>{x(new Set(f.map(C=>C.key)))},[f]),z=u.useCallback(()=>{x(new Set)},[]);if(s==="none")return null;const P=(C,_)=>{i&&l?(_.preventDefault(),l(C.id)):n(C.id)},F=(C,_)=>e.jsxs("div",{style:_,className:"flex items-center px-4 py-2 bg-bg-light border-b border-border cursor-pointer hover:bg-bg-lighter",onClick:()=>W(C.key),children:[e.jsx("span",{className:"mr-2 text-text-secondary",children:C.expanded?e.jsx(Ut,{size:16}):e.jsx(oa,{size:16})}),e.jsx("span",{className:"font-medium text-text-primary flex-1 truncate",children:C.label}),e.jsxs("div",{className:"flex items-center gap-3 text-xs",children:[e.jsxs("span",{className:"px-2 py-1 bg-bg-medium rounded text-text-secondary",children:[C.count," 请求"]}),e.jsxs("span",{className:"px-2 py-1 bg-bg-medium rounded text-text-muted",children:["平均 ",Qe(C.avgDuration)]}),C.errorCount>0&&e.jsxs("span",{className:"px-2 py-1 bg-red-500/20 rounded text-red-400",children:[C.errorCount," 错误"]}),C.mockedCount>0&&e.jsxs("span",{className:"px-2 py-1 bg-purple-500/20 rounded text-purple-400",children:[C.mockedCount," Mock"]})]})]},`group-${C.key}`),G=(C,_)=>{const U=!C.statusCode||C.statusCode>=400,L=C.id===r,E=o.has(C.id),m=ws(C,g),N=(m==null?void 0:m.action)==="highlight",w=(m==null?void 0:m.action)==="mark",M=m==null?void 0:m.color;return e.jsxs("div",{style:w&&M&&!L?{..._,borderLeftColor:M}:_,onClick:k=>P(C,k),className:b("flex items-center cursor-pointer transition-all duration-150 group border-b border-border-light pl-8",U&&!L&&!N&&"bg-red-500/5 hover:bg-red-500/10",L&&"bg-accent-blue/15 border-l-2 border-l-accent-blue",E&&!L&&"bg-primary/15",N&&!L&&"bg-yellow-500/10 hover:bg-yellow-500/20 border-l-4 border-l-yellow-500",w&&!L&&!N&&"border-l-4",!L&&!E&&!U&&!N&&!w&&"hover:bg-bg-light/60"),children:[(N||w)&&!L&&e.jsxs("div",{className:"w-6 flex-shrink-0 flex items-center justify-center -ml-6",children:[N&&e.jsx(he,{size:12,filled:!0,className:"text-yellow-500"}),w&&!N&&e.jsx(Vt,{size:12,style:{color:M||"currentColor"}})]}),i&&e.jsx("div",{className:"px-3 py-3.5 w-10 flex-shrink-0",onClick:k=>k.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:E,onChange:()=>l==null?void 0:l(C.id),className:"w-4 h-4 rounded border-border cursor-pointer accent-primary"})}),e.jsx("div",{className:b("px-3 py-3.5 w-[90px] flex-shrink-0",L?"text-accent-blue":"text-text-muted"),children:e.jsx("span",{className:"text-sm font-mono",children:ue(C.startTime)})}),e.jsx("div",{className:"px-3 py-3.5 w-[80px] flex-shrink-0",children:e.jsx("span",{className:b("inline-flex items-center justify-center px-2 py-1 rounded-lg text-xs font-mono font-bold min-w-[50px] shadow-sm",Zt(C.method)),children:C.method})}),e.jsx("div",{className:"px-3 py-3.5 w-[70px] flex-shrink-0",children:e.jsx("span",{className:b("inline-flex items-center justify-center px-2 py-1 rounded-lg text-xs font-mono font-semibold min-w-[40px] shadow-sm",Xt(C.statusCode)),children:C.statusCode??"ERR"})}),e.jsx("div",{className:"px-3 py-3.5 flex-1 min-w-0 overflow-hidden",children:e.jsx("span",{className:b("text-sm truncate",L?"text-accent-blue font-medium":"text-text-primary"),title:C.url,children:(()=>{try{return new URL(C.url).pathname}catch{return C.url}})()})}),e.jsx("div",{className:"px-3 py-3.5 w-[80px] flex-shrink-0",children:e.jsx("span",{className:b("text-sm font-mono font-medium",wr(C.duration)),children:Qe(C.duration)})}),e.jsxs("div",{className:"px-3 py-3.5 w-[60px] flex-shrink-0 flex items-center justify-center gap-1",children:[C.isMocked&&e.jsx("span",{title:"已 Mock",children:e.jsx(ce,{size:14})}),C.isFavorite&&e.jsx("span",{title:"已收藏",children:e.jsx(he,{size:14,filled:!0,className:"text-accent-yellow"})})]})]},C.id)};return e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 bg-bg-medium border-b border-border",children:[e.jsxs("span",{className:"text-sm text-text-secondary",children:[f.length," 个分组，",t.length," 个请求"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:H,className:"px-2 py-1 text-xs text-text-muted hover:text-text-secondary hover:bg-bg-light rounded",children:"展开全部"}),e.jsx("button",{onClick:z,className:"px-2 py-1 text-xs text-text-muted hover:text-text-secondary hover:bg-bg-light rounded",children:"收起全部"})]})]}),e.jsx("div",{ref:c,className:"flex-1 overflow-auto",children:D.length>0?e.jsx("div",{style:{height:`${T.getTotalSize()}px`,width:"100%",position:"relative"},children:T.getVirtualItems().map(C=>{const _=D[C.index],U={position:"absolute",top:0,left:0,width:"100%",height:`${C.size}px`,transform:`translateY(${C.start}px)`};return _.type==="group-header"?F(_.group,U):G(_.event,U)})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted py-20",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-bg-light/50 flex items-center justify-center mb-4",children:e.jsx(ia,{size:32,className:"opacity-60"})}),e.jsx("p",{className:"text-sm font-medium text-text-secondary mb-1",children:"暂无 HTTP 请求"}),e.jsx("p",{className:"text-xs text-text-muted",children:"等待网络请求被捕获..."})]})})]})}function kr({data:t,initialExpanded:s=!0,maxInitialDepth:r=2}){return e.jsx("div",{className:"font-mono text-xs",children:e.jsx(Cr,{value:t,depth:0,initialExpanded:s,maxInitialDepth:r})})}function Cr({keyName:t,value:s,depth:r,initialExpanded:n,maxInitialDepth:a,isLast:i=!0}){const o=n&&r<a,[l,c]=u.useState(o),d=u.useMemo(()=>s===null?"null":Array.isArray(s)?"array":typeof s,[s]),x=d==="object"||d==="array",h=x&&(d==="array"?s.length===0:Object.keys(s).length===0),j=()=>{switch(d){case"string":return e.jsxs("span",{className:"text-emerald-400",children:['"',String(s),'"']});case"number":return e.jsx("span",{className:"text-amber-400",children:String(s)});case"boolean":return e.jsx("span",{className:"text-purple-400",children:String(s)});case"null":return e.jsx("span",{className:"text-gray-500",children:"null"});case"undefined":return e.jsx("span",{className:"text-gray-500",children:"undefined"});default:return null}},y=()=>{const p=d==="array"?s.map((f,D)=>[String(D),f]):Object.entries(s),g=d==="array"?["[","]"]:["{","}"],v=d==="array"?`Array(${s.length})`:`Object(${Object.keys(s).length})`;return h?e.jsxs("span",{className:"text-gray-500",children:[g[0],g[1]]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>c(!l),className:"inline-flex items-center hover:bg-bg-light rounded px-0.5 -ml-0.5",children:[e.jsx("span",{className:"w-4 text-center text-gray-500",children:l?"▼":"▶"}),!l&&e.jsx("span",{className:"text-gray-500 ml-1",children:v})]}),l?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-400",children:g[0]}),e.jsx("div",{className:"pl-4 border-l border-border ml-1",children:p.map(([f,D],T)=>e.jsx(Cr,{keyName:d==="array"?void 0:f,value:D,depth:r+1,initialExpanded:n,maxInitialDepth:a,isLast:T===p.length-1},f))}),e.jsx("span",{className:"text-gray-400",children:g[1]})]}):null]})};return e.jsxs("div",{className:b("leading-relaxed",!i&&"mb-0.5"),children:[t!==void 0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sky-400",children:t}),e.jsx("span",{className:"text-gray-500",children:": "})]}),x?y():j(),!i&&!l&&e.jsx("span",{className:"text-gray-500",children:","})]})}function Ns({content:t,className:s}){const[r,n]=u.useState("tree"),a=u.useMemo(()=>{try{return JSON.parse(t)}catch{return null}},[t]);return a!==null?e.jsxs("div",{className:s,children:[e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("button",{onClick:()=>n("tree"),className:b("px-2 py-1 text-xs rounded",r==="tree"?"bg-primary text-white":"bg-bg-light text-text-muted hover:bg-bg-lighter"),children:"树形"}),e.jsx("button",{onClick:()=>n("raw"),className:b("px-2 py-1 text-xs rounded",r==="raw"?"bg-primary text-white":"bg-bg-light text-text-muted hover:bg-bg-lighter"),children:"原始"})]}),r==="tree"?e.jsx("div",{className:"bg-bg-dark p-3 rounded overflow-x-auto max-h-96 overflow-y-auto",children:e.jsx(kr,{data:a})}):e.jsx("pre",{className:"text-xs font-mono bg-bg-dark p-3 rounded overflow-x-auto whitespace-pre-wrap break-all max-h-96 overflow-y-auto",children:JSON.stringify(a,null,2)})]}):e.jsx("pre",{className:b("text-xs font-mono whitespace-pre-wrap break-all",s),children:t})}function To({timing:t,totalDuration:s}){const r=[{label:"DNS",value:t.dnsLookup,color:"bg-cyan-500",description:"DNS 解析"},{label:"TCP",value:t.tcpConnection,color:"bg-green-500",description:"TCP 连接"},{label:"TLS",value:t.tlsHandshake,color:"bg-purple-500",description:"TLS 握手"},{label:"TTFB",value:t.timeToFirstByte,color:"bg-amber-500",description:"首字节时间"},{label:"Download",value:t.contentDownload,color:"bg-blue-500",description:"内容下载"}],n=r.reduce((l,c)=>l+(c.value||0),0),a=s||n||1,i=l=>{if(l==null)return"-";const c=l*1e3;return c<1?`${Math.round(c*1e3)}µs`:c<1e3?`${Math.round(c)}ms`:`${(c/1e3).toFixed(2)}s`},o=l=>l==null?0:l/a*100;return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"space-y-2",children:r.map(l=>{const c=o(l.value);return l.value===null?null:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-16 text-xs text-text-muted shrink-0",children:l.label}),e.jsxs("div",{className:"flex-1 h-5 bg-bg-dark rounded overflow-hidden relative",children:[e.jsx("div",{className:`h-full ${l.color} transition-all duration-300`,style:{width:`${Math.max(c,1)}%`}}),e.jsx("span",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-xs font-mono",children:i(l.value)})]}),e.jsxs("div",{className:"w-12 text-xs text-text-muted text-right shrink-0",children:[c.toFixed(1),"%"]})]},l.label)})}),e.jsxs("div",{className:"flex items-center gap-3 pt-2 border-t border-border",children:[e.jsx("div",{className:"w-16 text-xs font-medium shrink-0",children:"Total"}),e.jsx("div",{className:"flex-1 text-xs font-mono text-primary",children:i(a)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2 border-t border-border text-xs",children:[t.protocolName&&e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"协议:"})," ",e.jsx("span",{className:"font-mono text-primary",children:t.protocolName})]}),t.connectionReused!==null&&e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"连接复用:"})," ",e.jsx("span",{className:t.connectionReused?"text-green-400":"text-yellow-400",children:t.connectionReused?"是":"否"})]}),t.localAddress&&e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"本地地址:"})," ",e.jsx("span",{className:"font-mono",children:t.localAddress})]}),t.remoteAddress&&e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"远程地址:"})," ",e.jsx("span",{className:"font-mono",children:t.remoteAddress})]}),t.requestBodyBytesSent!==null&&e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"发送:"})," ",e.jsx("span",{className:"font-mono",children:ut(t.requestBodyBytesSent)})]}),t.responseBodyBytesReceived!==null&&e.jsxs("div",{children:[e.jsx("span",{className:"text-text-muted",children:"接收:"})," ",e.jsx("span",{className:"font-mono",children:ut(t.responseBodyBytesReceived)})]})]}),e.jsx("div",{className:"flex flex-wrap gap-3 pt-2 border-t border-border",children:r.map(l=>e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[e.jsx("div",{className:`w-3 h-3 rounded ${l.color}`}),e.jsx("span",{className:"text-text-muted",children:l.description})]},l.label))})]})}function So({base64Data:t,contentType:s,className:r=""}){const[n,a]=u.useState(!1),[i,o]=u.useState(!1),l=u.useMemo(()=>{const c=Lo(s);return c?`data:${c};base64,${t}`:null},[t,s]);return!l||i?null:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`relative ${r}`,children:[e.jsx("img",{src:l,alt:"Response preview",className:"image-preview cursor-pointer",onClick:()=>a(!0),onError:()=>o(!0)}),e.jsxs("div",{className:"absolute bottom-2 right-2 flex gap-2",children:[e.jsx("button",{onClick:()=>a(!0),className:"p-1.5 bg-bg-dark/80 rounded-lg hover:bg-bg-dark transition-colors",title:"全屏预览",children:e.jsx(Do,{className:"w-4 h-4"})}),e.jsx("a",{href:l,download:"response-image",className:"p-1.5 bg-bg-dark/80 rounded-lg hover:bg-bg-dark transition-colors",title:"下载图片",children:e.jsx(Mo,{className:"w-4 h-4"})})]})]}),n&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90",onClick:()=>a(!1),children:[e.jsx("button",{className:"absolute top-4 right-4 p-2 text-white/70 hover:text-white transition-colors",onClick:()=>a(!1),children:e.jsx(Ro,{className:"w-6 h-6"})}),e.jsx("img",{src:l,alt:"Response preview fullscreen",className:"max-w-[90vw] max-h-[90vh] object-contain",onClick:c=>c.stopPropagation()})]})]})}function Io(t){if(!t)return!1;const s=t.toLowerCase();return s.startsWith("image/")||s.includes("image/png")||s.includes("image/jpeg")||s.includes("image/gif")||s.includes("image/webp")||s.includes("image/svg+xml")||s.includes("image/bmp")||s.includes("image/ico")}function Lo(t){if(!t)return null;const s=t.split(";")[0].trim().toLowerCase();return["image/png","image/jpeg","image/jpg","image/gif","image/webp","image/svg+xml","image/bmp","image/x-icon","image/ico"].some(n=>s.includes(n)||s===n)||s.startsWith("image/")?s:null}function Do({className:t=""}){return e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}function Mo({className:t=""}){return e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})})}function Ro({className:t=""}){return e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}function ks(t){if(!t)return!1;const s=t.toLowerCase();return s.includes("application/x-protobuf")||s.includes("application/protobuf")||s.includes("application/grpc")||s.includes("application/grpc+proto")||s.includes("application/octet-stream")}function Cs(t){const s=atob(t),r=new Uint8Array(s.length);for(let n=0;n<s.length;n++)r[n]=s.charCodeAt(n);return r}function It(t,s){let r=0n,n=0n,a=0;for(;s+a<t.length;){const i=t[s+a];if(r|=BigInt(i&127)<<n,a++,!(i&128))break;if(n+=7n,a>10)throw new Error("Varint too long")}return{value:r,bytesRead:a}}function Er(t){const s=[],r=[];let n=0;for(;n<t.length;)try{const a=n,{value:i,bytesRead:o}=It(t,n);n+=o;const l=Number(i>>3n),c=Number(i&0x7n);if(l===0){r.push(`Invalid field number 0 at offset ${a}`);break}let d,x;switch(c){case 0:{const{value:h,bytesRead:j}=It(t,n);d=h,n+=j,x=n-a;break}case 1:{if(n+8>t.length)throw new Error("Unexpected end of data for Fixed64");d=new DataView(t.buffer,t.byteOffset+n,8).getBigUint64(0,!0),n+=8,x=n-a;break}case 2:{const{value:h,bytesRead:j}=It(t,n);n+=j;const y=Number(h);if(n+y>t.length)throw new Error(`Length-delimited field extends beyond data: ${y} bytes at offset ${n}`);const p=t.slice(n,n+y);d=Oo(p),n+=y,x=n-a;break}case 5:{if(n+4>t.length)throw new Error("Unexpected end of data for Fixed32");d=new DataView(t.buffer,t.byteOffset+n,4).getUint32(0,!0),n+=4,x=n-a;break}case 3:case 4:r.push(`Deprecated wire type ${c} at field ${l}`),n=t.length,x=0;break;default:throw new Error(`Unknown wire type ${c}`)}s.push({fieldNumber:l,wireType:c,value:d,rawBytes:t.slice(a,n),offset:a,length:x})}catch(a){r.push(`Parse error at offset ${n}: ${a instanceof Error?a.message:String(a)}`);break}return{fields:s,errors:r}}function Oo(t){try{const r=new TextDecoder("utf-8",{fatal:!0}).decode(t);if(Po(r))return{type:"string",value:r}}catch{}if(t.length>0)try{const s=Er(t);if(s.fields.length>0&&s.errors.length===0&&s.fields.reduce((n,a)=>n+a.length,0)===t.length)return{type:"nested",value:s.fields}}catch{}return{type:"bytes",value:t}}function Po(t){if(t.length===0)return!1;let s=0;for(const r of t){const n=r.charCodeAt(0);(n>=32&&n<127||n>127)&&s++}return s/t.length>.9}function Fo(t,s=32){const r=Array.from(t.slice(0,s)).map(n=>n.toString(16).padStart(2,"0")).join(" ");return t.length>s?`${r} ... (${t.length} bytes)`:r}function zo(t){const s=Number(t),r=[];r.push(`uint: ${t}`);const n=Number(t>>1n^-(t&1n));if(n!==s&&r.push(`sint: ${n}`),(t===0n||t===1n)&&r.push(`bool: ${t===1n}`),s>1e9&&s<2e9){const a=new Date(s*1e3);r.push(`timestamp(s): ${a.toISOString()}`)}else if(s>1e12&&s<2e12){const a=new Date(s);r.push(`timestamp(ms): ${a.toISOString()}`)}return e.jsx("span",{className:"text-xs",children:r.map((a,i)=>e.jsx("span",{className:i===0?"text-green-400":"text-text-muted ml-2",children:a},i))})}function _o(t){switch(t){case 0:return"Varint";case 1:return"Fixed64";case 2:return"Length-Delimited";case 5:return"Fixed32";case 3:return"StartGroup (deprecated)";case 4:return"EndGroup (deprecated)";default:return"Unknown"}}function zt({base64Data:t,contentType:s,className:r}){const[n,a]=u.useState(new Set),[i,o]=u.useState("parsed"),l=u.useMemo(()=>{try{const x=Cs(t);return Er(x)}catch(x){return{fields:[],errors:[`Failed to decode base64: ${x instanceof Error?x.message:String(x)}`]}}},[t]),c=u.useMemo(()=>{try{return Cs(t)}catch{return new Uint8Array}},[t]),d=x=>{const h=new Set(n);h.has(x)?h.delete(x):h.add(x),a(h)};return e.jsxs("div",{className:b("bg-bg-dark rounded-lg overflow-hidden",r),children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 bg-bg-darker border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-medium text-purple-400 flex items-center gap-1",children:[e.jsx(pe,{size:14})," Protobuf"]}),s&&e.jsx("span",{className:"text-xs text-text-muted",children:s}),e.jsxs("span",{className:"text-xs text-text-muted",children:["(",c.length," bytes)"]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>o("parsed"),className:b("px-2 py-1 text-xs rounded transition-colors",i==="parsed"?"bg-primary/20 text-primary":"text-text-muted hover:text-text-primary"),children:"Parsed"}),e.jsx("button",{onClick:()=>o("hex"),className:b("px-2 py-1 text-xs rounded transition-colors",i==="hex"?"bg-primary/20 text-primary":"text-text-muted hover:text-text-primary"),children:"Hex"})]})]}),e.jsxs("div",{className:"p-3 max-h-96 overflow-auto",children:[l.errors.length>0&&e.jsx("div",{className:"mb-3 p-2 bg-red-500/10 border border-red-500/30 rounded text-xs text-red-400",children:l.errors.map((x,h)=>e.jsx("div",{children:x},h))}),i==="parsed"?l.fields.length>0?e.jsx(Tr,{fields:l.fields,expandedFields:n,toggleField:d}):e.jsx("div",{className:"text-text-muted text-xs",children:"无法解析为有效的 Protobuf 消息"}):e.jsx(Bo,{bytes:c})]})]})}function Tr({fields:t,expandedFields:s,toggleField:r,prefix:n=""}){return e.jsx("div",{className:"space-y-1 font-mono text-xs",children:t.map((a,i)=>{const o=`${n}${a.fieldNumber}-${i}`,l=s.has(o),c=typeof a.value=="object"&&a.value!==null&&"type"in a.value&&a.value.type==="nested";return e.jsxs("div",{className:"border-l-2 border-border pl-2",children:[e.jsxs("div",{className:b("flex items-start gap-2 py-1",c&&"cursor-pointer hover:bg-bg-lighter rounded"),onClick:c?()=>r(o):void 0,children:[c&&e.jsx("span",{className:"text-text-muted",children:l?"▼":"▶"}),e.jsxs("span",{className:"text-yellow-400",children:["field ",a.fieldNumber]}),e.jsxs("span",{className:"text-text-muted",children:["(",_o(a.wireType),")"]}),e.jsx("span",{className:"text-text-muted",children:"="}),e.jsx(Ao,{field:a,expanded:l})]}),c&&l&&e.jsx("div",{className:"ml-4 mt-1",children:e.jsx(Tr,{fields:a.value.value,expandedFields:s,toggleField:r,prefix:`${o}-`})})]},o)})})}function Ao({field:t,expanded:s}){const{wireType:r,value:n}=t;if(r===0)return zo(n);if(r===5){const a=n,i=new DataView(new Uint32Array([a]).buffer).getFloat32(0,!0);return e.jsxs("span",{className:"text-xs",children:[e.jsxs("span",{className:"text-green-400",children:["uint32: ",a]}),!isNaN(i)&&isFinite(i)&&e.jsxs("span",{className:"text-text-muted ml-2",children:["float: ",i.toFixed(4)]})]})}if(r===1){const a=n;return e.jsx("span",{className:"text-xs",children:e.jsxs("span",{className:"text-green-400",children:["uint64: ",a.toString()]})})}if(r===2&&typeof n=="object"&&n!==null&&"type"in n){const a=n;if(a.type==="string"){const i=String(a.value);return e.jsxs("span",{className:"text-green-400",children:['"',i.length>100?i.slice(0,100)+"...":i,'"']})}if(a.type==="nested"){const i=a.value;return s?null:e.jsx("span",{className:"text-blue-400",children:`{ ${i.length} fields }`})}if(a.type==="bytes"){const i=a.value;return e.jsxs("span",{className:"text-text-muted",children:["[",Fo(i),"]"]})}}return e.jsx("span",{className:"text-text-muted",children:"?"})}function Bo({bytes:t}){const s=[];for(let n=0;n<t.length;n+=16){const a=t.slice(n,n+16),i=Array.from(a).map(l=>l.toString(16).padStart(2,"0")).join(" "),o=Array.from(a).map(l=>l>=32&&l<127?String.fromCharCode(l):".").join("");s.push(e.jsxs("div",{className:"flex gap-4 font-mono text-xs",children:[e.jsx("span",{className:"text-text-muted w-12",children:n.toString(16).padStart(8,"0")}),e.jsx("span",{className:"text-green-400 flex-1",children:i.padEnd(47," ")}),e.jsx("span",{className:"text-yellow-400",children:o})]},n))}return e.jsx("div",{className:"space-y-0.5",children:s})}function $o({event:t,deviceId:s,onShowRelatedLogs:r,onFavoriteChange:n,mockRules:a=[],onEditMockRule:i,onCreateMockFromRequest:o}){var E,m,N,w,M,k;const[l,c]=u.useState("headers"),[d,x]=u.useState(null),[h,j]=u.useState(!1),[y,p]=u.useState(!1),[g,v]=u.useState(null),{isFavorite:f,toggleFavorite:D}=ht(),T=t?f(s,t.url):!1;if(!t)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted",children:[e.jsx("span",{className:"text-4xl mb-3 opacity-50",children:"👈"}),e.jsx("p",{className:"text-sm",children:"选择一个请求查看详情"})]});const W=t.requestBody?js(t.requestBody):null,H=t.responseBody?js(t.responseBody):null,z=((E=t.responseHeaders)==null?void 0:E["Content-Type"])||((m=t.responseHeaders)==null?void 0:m["content-type"]),P=Io(z),F=ks(z),G=((N=t.requestHeaders)==null?void 0:N["Content-Type"])||((w=t.requestHeaders)==null?void 0:w["content-type"]),C=ks(G),_=async()=>{if(d){await navigator.clipboard.writeText(d),p(!0),setTimeout(()=>p(!1),2e3);return}j(!0);try{const O=await tn(s,t.id);x(O.curl),await navigator.clipboard.writeText(O.curl),p(!0),setTimeout(()=>p(!1),2e3)}catch(O){console.error("Failed to generate cURL:",O)}finally{j(!1)}},U=async()=>{v("sending...");try{const O=await sn(s,t.id);v(`✓ ${O.status}`),setTimeout(()=>v(null),3e3)}catch{v("✗ failed"),setTimeout(()=>v(null),3e3)}},L=()=>{if(!t)return;const O=D(s,t.url);n==null||n(t.id,O)};return e.jsxs("div",{className:"h-full overflow-auto",children:[e.jsxs("div",{className:"p-4 bg-bg-dark border-b border-border",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"text-sm font-medium break-all flex-1",children:t.url}),e.jsx("button",{onClick:L,className:b("ml-2 p-1.5 rounded transition-colors",T?"text-yellow-400 hover:text-yellow-300":"text-text-muted hover:text-yellow-400"),title:T?"取消收藏（URL 级别）":"收藏（URL 级别）",children:T?e.jsx(Ho,{className:"w-5 h-5"}):e.jsx(Wo,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs mb-3",children:[e.jsx("span",{className:b("px-1.5 py-0.5 rounded font-mono",Zt(t.method)),children:t.method}),e.jsx("span",{className:b("px-1.5 py-0.5 rounded font-mono",Xt(t.statusCode)),children:t.statusCode??"ERR"}),e.jsx("span",{className:"text-text-muted",children:Qe(t.duration)}),t.isMocked&&e.jsx(Nr,{url:t.url,mockRuleId:t.mockRuleId,rules:a,onEditRule:i,children:e.jsxs("span",{className:"px-1.5 py-0.5 rounded bg-yellow-500/20 text-yellow-400 flex items-center cursor-pointer hover:bg-yellow-500/30 transition-colors",children:[e.jsx(ce,{size:12,className:"mr-1"})," Mocked"]})}),((M=t.timing)==null?void 0:M.protocolName)&&e.jsx("span",{className:"px-1.5 py-0.5 rounded bg-primary/20 text-primary",children:t.timing.protocolName}),((k=t.timing)==null?void 0:k.connectionReused)&&e.jsx("span",{className:"px-1.5 py-0.5 rounded bg-green-500/20 text-green-400",children:"复用连接"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:_,disabled:h,className:"px-3 py-1.5 bg-bg-light border border-border-subtle rounded text-xs hover:bg-bg-lighter transition-colors disabled:opacity-50 flex items-center",children:h?"生成中...":y?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{size:12,className:"mr-1"})," 已复制"]}):e.jsxs(e.Fragment,{children:[e.jsx(sr,{size:12,className:"mr-1"})," 复制 cURL"]})}),e.jsx("button",{onClick:U,disabled:g!==null,className:"px-3 py-1.5 bg-bg-light border border-border-subtle rounded text-xs hover:bg-bg-lighter transition-colors disabled:opacity-50 flex items-center",children:g||e.jsxs(e.Fragment,{children:[e.jsx(rr,{size:12,className:"mr-1"})," 重放请求"]})}),o&&e.jsxs("button",{onClick:()=>o(t.url,t.method,t.responseBody??void 0,t.responseHeaders??void 0),className:"px-3 py-1.5 bg-purple-500/20 border border-purple-500/30 text-purple-400 rounded text-xs hover:bg-purple-500/30 transition-colors flex items-center",children:[e.jsx(ce,{size:12,className:"mr-1"})," 创建 Mock 规则"]})]}),t.traceId&&e.jsxs("div",{className:"mt-2 text-xs text-text-muted",children:["TraceId: ",e.jsx("span",{className:"font-mono text-text-primary",children:t.traceId})]})]}),e.jsxs("div",{className:"flex border-b border-border bg-bg-dark",children:[e.jsx(nt,{active:l==="headers",onClick:()=>c("headers"),children:"Headers"}),e.jsx(nt,{active:l==="params",onClick:()=>c("params"),children:"Params"}),e.jsx(nt,{active:l==="body",onClick:()=>c("body"),children:"Body"}),t.timing&&e.jsx(nt,{active:l==="timing",onClick:()=>c("timing"),children:"Timing"})]}),e.jsxs("div",{className:"p-4",children:[l==="headers"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(be,{title:"请求头",children:e.jsx(at,{headers:t.requestHeaders})}),t.responseHeaders&&e.jsx(be,{title:"响应头",children:e.jsx(at,{headers:t.responseHeaders})})]}),l==="params"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(be,{title:"Query Params",children:e.jsx(at,{headers:t.queryItems||{}})}),e.jsxs(be,{title:"Body Params",children:[e.jsx(at,{headers:t.bodyParams||{}}),!t.bodyParams&&e.jsx("div",{className:"text-text-muted text-sm",children:"无解析后的 Body 参数"})]})]}),l==="body"&&e.jsxs("div",{className:"space-y-6",children:[t.requestBody&&e.jsx(be,{title:"请求体",children:C?e.jsx(zt,{base64Data:t.requestBody,contentType:G}):e.jsx(Ns,{content:W??""})}),t.responseBody&&e.jsx(be,{title:"响应体",children:P?e.jsx(So,{base64Data:t.responseBody,contentType:z??null}):F?e.jsx(zt,{base64Data:t.responseBody,contentType:z}):e.jsx(Ns,{content:H??""})}),!t.requestBody&&!t.responseBody&&e.jsx("div",{className:"text-text-muted text-sm",children:"无请求体或响应体"}),t.errorDescription&&e.jsx(be,{title:"错误信息",children:e.jsx("pre",{className:"text-xs font-mono bg-bg-dark p-3 rounded text-red-400",children:t.errorDescription})})]}),l==="timing"&&t.timing&&e.jsx(be,{title:"性能时间线",children:e.jsx(To,{timing:t.timing,totalDuration:t.duration})})]}),t.traceId&&r&&e.jsx("div",{className:"p-4 border-t border-border",children:e.jsx("button",{onClick:()=>r(t.traceId),className:"px-3 py-1.5 bg-bg-light border border-border rounded text-sm hover:bg-bg-lighter transition-colors",children:"查看 TraceId 关联日志"})})]})}function nt({active:t,onClick:s,children:r}){return e.jsx("button",{onClick:s,className:b("px-4 py-2 text-xs font-medium transition-colors",t?"text-primary border-b-2 border-primary":"text-text-muted hover:text-text-primary"),children:r})}function be({title:t,children:s}){return e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs uppercase text-text-muted mb-2",children:t}),s]})}function at({headers:t}){const s=Object.entries(t);return s.length===0?e.jsx("span",{className:"text-text-muted text-sm",children:"无"}):e.jsx("table",{className:"w-full text-xs font-mono",children:e.jsx("tbody",{children:s.map(([r,n])=>e.jsxs("tr",{className:"border-b border-border/50 last:border-0",children:[e.jsx("td",{className:"py-1.5 pr-4 text-primary align-top whitespace-nowrap",children:r}),e.jsx("td",{className:"py-1.5 break-all",children:n})]},r))})})}function Ho({className:t=""}){return e.jsx("svg",{className:t,fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})})}function Wo({className:t=""}){return e.jsx("svg",{className:t,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})})}const Uo={verbose:"VERBOSE",debug:"DEBUG",info:"INFO",warning:"WARN",error:"ERROR"};function Vo({events:t,autoScroll:s,isSelectMode:r=!1,selectedIds:n=new Set,onToggleSelect:a}){const i=u.useRef(null);return u.useEffect(()=>{s&&i.current&&t.length>0&&(i.current.scrollTop=0)},[t.length,s]),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"flex-shrink-0 bg-bg-medium border-b border-border",children:e.jsxs("div",{className:"flex items-center text-xs font-semibold text-text-secondary uppercase tracking-wider",children:[r&&e.jsx("div",{className:"w-10 px-3 py-2.5 flex-shrink-0",children:e.jsx("span",{className:"sr-only",children:"选择"})}),e.jsx("div",{className:"w-32 px-4 py-2.5",children:"时间"}),e.jsx("div",{className:"w-24 px-4 py-2.5",children:"级别"}),e.jsx("div",{className:"w-36 px-4 py-2.5",children:"分类"}),e.jsx("div",{className:"flex-1 px-4 py-2.5",children:"消息内容"})]})}),e.jsxs("div",{ref:i,className:"flex-1 overflow-auto font-mono text-sm",children:[t.map((o,l)=>{const c=ho(o.level),d=n.has(o.id);return e.jsxs("div",{onClick:()=>r&&(a==null?void 0:a(o.id)),className:b("flex items-start border-l-2 transition-all duration-150",c.border,l%2===0?"bg-bg-dark/20":"bg-transparent",r?"cursor-pointer":"",r&&d?"bg-primary/10":"hover:bg-bg-light/60"),style:{animationDelay:`${Math.min(l*10,300)}ms`},children:[r&&e.jsx("div",{className:"w-10 px-3 py-3 flex-shrink-0 flex items-center justify-center",children:e.jsx("input",{type:"checkbox",checked:d,onChange:()=>a==null?void 0:a(o.id),onClick:x=>x.stopPropagation(),className:"w-4 h-4 accent-primary cursor-pointer"})}),e.jsx("div",{className:"w-32 px-4 py-3 text-text-muted whitespace-nowrap flex-shrink-0 text-xs",children:ue(o.timestamp)}),e.jsx("div",{className:"w-24 px-4 py-2.5 flex-shrink-0",children:e.jsx("span",{className:b("inline-flex items-center justify-center px-2.5 py-1 rounded-lg text-2xs font-bold shadow-sm",c.bg,c.color),children:Uo[o.level]})}),e.jsx("div",{className:"w-36 px-4 py-3 text-primary truncate flex-shrink-0 text-xs font-medium",title:o.category||o.subsystem||"-",children:o.category||o.subsystem||"-"}),e.jsx("div",{className:"flex-1 px-4 py-3 text-text-primary break-all whitespace-pre-wrap leading-relaxed text-xs",children:o.message})]},o.id)}),t.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted py-20",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-bg-light/50 flex items-center justify-center mb-4",children:e.jsx(je,{size:32,className:"opacity-60"})}),e.jsx("p",{className:"text-sm font-medium text-text-secondary mb-1",children:"暂无日志"}),e.jsx("p",{className:"text-xs text-text-muted",children:"等待日志事件到达..."})]})]})]})}const qo=[{level:"error",label:"Error",icon:e.jsx(ma,{size:14}),bgClass:"bg-level-error",textClass:"text-white"},{level:"warning",label:"Warning",icon:e.jsx(Re,{size:14}),bgClass:"bg-level-warning",textClass:"text-white"},{level:"info",label:"Info",icon:e.jsx(Zs,{size:14}),bgClass:"bg-level-info",textClass:"text-white"},{level:"debug",label:"Debug",icon:e.jsx(ea,{size:14}),bgClass:"bg-level-debug",textClass:"text-white"},{level:"verbose",label:"Verbose",icon:e.jsx(er,{size:14}),bgClass:"bg-level-verbose",textClass:"text-white"}];function Yo({minLevel:t,subsystems:s,categories:r,selectedSubsystem:n,selectedCategory:a,searchText:i,searchQuery:o,onMinLevelChange:l,onSubsystemChange:c,onCategoryChange:d,onSearchChange:x,onSearchQueryChange:h}){const[j,y]=u.useState(!1),[p,g]=u.useState(!1),v=u.useRef(null);return u.useEffect(()=>{function f(D){v.current&&!v.current.contains(D.target)&&g(!1)}return document.addEventListener("mousedown",f),()=>document.removeEventListener("mousedown",f)},[]),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx("div",{className:"flex gap-1",children:qo.map(({level:f,label:D,icon:T,bgClass:W,textClass:H})=>{const z=f===t;return e.jsxs("button",{onClick:()=>l(f),title:`显示 ${D} 及更高级别日志`,className:b("flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg text-xs font-medium whitespace-nowrap",z?`${W} ${H} shadow-sm`:"text-text-secondary hover:text-text-primary hover:bg-bg-light"),children:[e.jsx("span",{children:T}),e.jsx("span",{children:D})]},f)})}),e.jsx("div",{className:"w-px h-6 bg-border"}),e.jsxs("select",{value:n,onChange:f=>c(f.target.value),className:"select text-sm",children:[e.jsx("option",{value:"",children:"所有 Subsystem"}),s.map(f=>e.jsx("option",{value:f,children:f},f))]}),e.jsxs("select",{value:a,onChange:f=>d(f.target.value),className:"select text-sm",children:[e.jsx("option",{value:"",children:"所有 Category"}),r.map(f=>e.jsx("option",{value:f,children:f},f))]}),e.jsxs("div",{className:"flex-1 flex items-center gap-2 min-w-[200px] max-w-[600px]",children:[e.jsx("button",{onClick:()=>y(!j),className:b("px-2 py-1.5 rounded-lg text-xs font-medium transition-colors whitespace-nowrap",j?"bg-primary text-white":"bg-bg-light text-text-muted hover:text-text-secondary"),title:"切换高级搜索",children:j?"高级":"简单"}),j?e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:o,onChange:f=>h(f.target.value),placeholder:"level:error subsystem:Network message:timeout...",className:"input w-full font-mono text-sm"}),e.jsx("button",{onClick:()=>g(!p),className:"absolute right-2 top-1/2 -translate-y-1/2 text-text-muted hover:text-text-secondary",title:"搜索语法帮助",children:"?"}),p&&e.jsxs("div",{ref:v,className:"absolute top-full right-0 mt-2 w-80 p-3 bg-bg-dark border border-border rounded-lg shadow-xl z-50",children:[e.jsx("h4",{className:"text-sm font-semibold text-text-primary mb-2",children:"搜索语法"}),e.jsx("pre",{className:"text-xs text-text-secondary whitespace-pre-wrap font-mono",children:Dn})]})]}):e.jsx("input",{type:"text",value:i,onChange:f=>x(f.target.value),placeholder:"搜索日志内容...",className:"input flex-1"})]})]})}const Go=[{category:"导航",items:[{keys:["↑","↓"],description:"上/下选择请求"},{keys:["Enter"],description:"查看详情"},{keys:["Esc"],description:"取消选择/关闭面板"}]},{category:"操作",items:[{keys:["⌘/Ctrl","K"],description:"搜索"},{keys:["⌘/Ctrl","R"],description:"刷新列表"},{keys:["⌘/Ctrl","L"],description:"清屏"},{keys:["⌘/Ctrl","E"],description:"导出数据"},{keys:["⌘/Ctrl","A"],description:"全选"}]},{category:"收藏与删除",items:[{keys:["F"],description:"收藏/取消收藏选中项"},{keys:["Delete","/","Backspace"],description:"删除选中项"}]},{category:"界面",items:[{keys:["⌘/Ctrl","T"],description:"切换主题"},{keys:["⌘/Ctrl","/"],description:"显示快捷键帮助"}]}];function Jo({isOpen:t,onClose:s}){return u.useEffect(()=>{const r=n=>{n.key==="Escape"&&s()};if(t)return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[t,s]),t?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:s}),e.jsxs("div",{className:"relative bg-bg-dark border border-border rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-border",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"键盘快捷键"}),e.jsx("button",{onClick:s,className:"p-1 rounded hover:bg-bg-light transition-colors text-text-muted hover:text-text-primary",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"p-6 overflow-auto max-h-[60vh]",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:Go.map(r=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-text-muted mb-3",children:r.category}),e.jsx("div",{className:"space-y-2",children:r.items.map((n,a)=>e.jsxs("div",{className:"flex items-center justify-between py-1.5",children:[e.jsx("span",{className:"text-sm text-text-secondary",children:n.description}),e.jsx("div",{className:"flex items-center gap-1",children:n.keys.map((i,o)=>e.jsxs("span",{className:"flex items-center",children:[e.jsx("kbd",{className:"kbd",children:i}),o<n.keys.length-1&&e.jsx("span",{className:"mx-1 text-text-muted text-xs",children:"+"})]},o))})]},a))})]},r.category))})}),e.jsx("div",{className:"px-6 py-3 border-t border-border bg-bg-medium/50 text-center",children:e.jsxs("span",{className:"text-xs text-text-muted",children:["按 ",e.jsx("kbd",{className:"kbd",children:"Esc"})," 关闭"]})})]})]}):null}function Qo({sessions:t,selectedId:s,onSelect:r,loading:n,autoScroll:a,isSelectMode:i=!1,selectedIds:o=new Set,onToggleSelect:l}){const c=u.useRef(null),d=u.useRef(null);return u.useEffect(()=>{var h;if(!a||t.length===0)return;const x=(h=t[0])==null?void 0:h.id;x&&x!==d.current&&c.current&&(c.current.scrollTop=0),d.current=x},[t,a]),t.length===0&&!n?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted py-12",children:[e.jsx(ke,{size:36,className:"mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:"暂无 WebSocket 会话"}),e.jsx("p",{className:"text-xs mt-1 text-text-muted",children:"当设备建立 WebSocket 连接时会显示在这里"})]}):e.jsxs("div",{ref:c,className:"overflow-auto h-full",children:[e.jsx("div",{className:"divide-y divide-border/50",children:t.map(x=>e.jsx(Ko,{session:x,isSelected:s===x.id,isChecked:o.has(x.id),isSelectMode:i,onSelect:r,onToggleSelect:l},x.id))}),n&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-primary border-t-transparent rounded-full"})})]})}const Ko=u.memo(function({session:s,isSelected:r,isChecked:n,isSelectMode:a,onSelect:i,onToggleSelect:o}){const l=s.disconnectTime?Qe(new Date(s.connectTime),new Date(s.disconnectTime)):null,c=()=>{a&&o?o(s.id):i(s.id)};return e.jsxs("div",{onClick:c,className:b("px-4 py-3 cursor-pointer transition-all","hover:bg-bg-light/50",r&&!a?"bg-accent-blue/15 border-l-2 border-l-accent-blue":"",!r&&"border-l-2 border-l-transparent",a&&n&&"bg-primary/15"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a?e.jsx("input",{type:"checkbox",checked:n,onChange:()=>o==null?void 0:o(s.id),onClick:d=>d.stopPropagation(),className:"w-4 h-4 rounded border-border bg-bg-light text-primary focus:ring-primary/50 cursor-pointer"}):e.jsx(Xo,{isOpen:s.isOpen,isSelectedRow:r&&!a}),e.jsx("span",{className:b("font-mono text-sm truncate flex-1",r&&!a?"text-accent-blue font-medium":"text-text-primary"),children:Kt(s.url)}),e.jsx("span",{className:b("text-xs",r&&!a?"text-accent-blue/70":"text-text-muted"),children:ue(s.connectTime)})]}),e.jsx("div",{className:b("text-xs truncate font-mono ml-5",r&&!a?"text-accent-blue/70":"text-text-muted"),children:s.url}),e.jsx("div",{className:"flex items-center gap-3 mt-1.5 ml-5",children:s.isOpen?e.jsxs("span",{className:b("inline-flex items-center gap-1 text-xs",r&&!a?"text-green-500":"text-green-400"),children:[e.jsx("span",{className:b("w-1.5 h-1.5 rounded-full animate-pulse",r&&!a?"bg-green-500":"bg-green-400")}),"连接中"]}):e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:b("text-xs",r&&!a?"text-accent-blue/70":"text-text-muted"),children:["已关闭",s.closeCode?` (${s.closeCode})`:""]}),l&&e.jsxs("span",{className:b("text-xs",r&&!a?"text-accent-blue/70":"text-text-muted"),children:["持续 ",l]})]})})]})});function Xo({isOpen:t,isSelectedRow:s}){return e.jsx("span",{className:b("w-3 h-3 rounded-full flex-shrink-0",t?"bg-green-500 shadow-green-500/50 shadow-sm":s?"bg-gray-400":"bg-gray-500")})}function Zo({deviceId:t,session:s,frames:r,loading:n,onLoadMore:a,hasMore:i,frameDirection:o,onFrameDirectionChange:l}){const[c,d]=u.useState("frames"),[x,h]=u.useState(null);return s?e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"px-4 py-3 border-b border-border bg-bg-dark/50",children:e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-2xl",children:"🔌"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-mono text-sm text-text-primary truncate",children:s.url}),e.jsxs("p",{className:"text-xs text-text-muted",children:[s.frameCount," 帧 • 连接于 ",ue(s.connectTime)]})]}),e.jsx(el,{isOpen:!s.disconnectTime,closeCode:s.closeCode})]})}),e.jsxs("div",{className:"px-4 py-2 border-b border-border bg-bg-dark flex gap-2",children:[e.jsxs("button",{onClick:()=>d("frames"),className:b("px-3 py-1.5 text-xs font-medium rounded-lg transition-all",c==="frames"?"bg-primary/20 text-primary":"text-text-secondary hover:text-text-primary hover:bg-bg-light"),children:["📨 消息帧 (",s.frameCount,")"]}),e.jsx("button",{onClick:()=>d("info"),className:b("px-3 py-1.5 text-xs font-medium rounded-lg transition-all",c==="info"?"bg-primary/20 text-primary":"text-text-secondary hover:text-text-primary hover:bg-bg-light"),children:"ℹ️ 连接信息"})]}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[c==="frames"&&e.jsx(tl,{deviceId:t,sessionId:s.id,frames:r,loading:n,onLoadMore:a,hasMore:i,expandedFrameId:x,onToggleExpand:h,direction:o,onDirectionChange:l}),c==="info"&&e.jsx(nl,{session:s})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted",children:[e.jsx("span",{className:"text-4xl mb-3 opacity-50",children:"👈"}),e.jsx("p",{className:"text-sm",children:"选择一个 WebSocket 会话查看详情"})]})}function el({isOpen:t,closeCode:s}){return t?e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium rounded-full bg-green-500/10 text-green-400 border border-green-500/20",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-400 animate-pulse"}),"连接中"]}):e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2 py-1 text-xs font-medium rounded-full bg-text-muted/10 text-text-muted border border-border",children:["已关闭",s?` (${s})`:""]})}function tl({deviceId:t,sessionId:s,frames:r,loading:n,onLoadMore:a,hasMore:i,expandedFrameId:o,onToggleExpand:l,direction:c,onDirectionChange:d}){const x=u.useRef(null),[h,j]=u.useState(!0),y=u.useRef(r.length);u.useEffect(()=>{!h||!x.current||(r.length>y.current&&(x.current.scrollTop=x.current.scrollHeight),y.current=r.length)},[r.length,h]);const p=r.filter(f=>f.direction==="send").length,g=r.filter(f=>f.direction==="receive").length,v=r.reduce((f,D)=>f+(D.payloadSize||0),0);return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"px-4 py-2 border-b border-border/50 flex items-center justify-between gap-3 bg-bg-dark/30",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-bg-light/50 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>d(""),className:b("px-2 py-1 text-xs rounded transition-colors",c?"text-text-muted hover:text-text-primary":"bg-bg-dark text-text-primary"),children:"全部"}),e.jsxs("button",{onClick:()=>d("send"),className:b("px-2 py-1 text-xs rounded transition-colors flex items-center gap-1",c==="send"?"bg-blue-500/20 text-blue-400":"text-text-muted hover:text-blue-400"),children:[e.jsx("span",{children:"↑"})," 发送"]}),e.jsxs("button",{onClick:()=>d("receive"),className:b("px-2 py-1 text-xs rounded transition-colors flex items-center gap-1",c==="receive"?"bg-green-500/20 text-green-400":"text-text-muted hover:text-green-400"),children:[e.jsx("span",{children:"↓"})," 接收"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-muted",children:[e.jsxs("span",{className:"text-blue-400",children:["↑",p]}),e.jsxs("span",{className:"text-green-400",children:["↓",g]}),e.jsxs("span",{children:["• ",ut(v)]})]})]}),e.jsxs("label",{className:"flex items-center gap-1.5 text-xs text-text-muted cursor-pointer hover:text-text-primary transition-colors",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:f=>j(f.target.checked),className:"accent-primary w-3 h-3"}),"自动滚动"]})]}),e.jsxs("div",{ref:x,className:"flex-1 overflow-auto",children:[r.length===0&&!n?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted py-8",children:[e.jsx("span",{className:"text-3xl mb-2 opacity-50",children:"📭"}),e.jsx("p",{className:"text-sm",children:"暂无消息帧"})]}):e.jsx("div",{className:"divide-y divide-border/30",children:r.map(f=>e.jsx(sl,{deviceId:t,sessionId:s,frame:f,isExpanded:o===f.id,onToggle:()=>l(o===f.id?null:f.id)},f.id))}),i&&e.jsx("div",{className:"px-4 py-3 text-center",children:e.jsx("button",{onClick:a,disabled:n,className:"btn btn-secondary text-xs",children:n?"加载中...":"加载更多"})})]})]})}const sl=u.memo(function({deviceId:s,sessionId:r,frame:n,isExpanded:a,onToggle:i}){const o=n.direction==="send",l=n.opcode==="text",[c,d]=u.useState(null),[x,h]=u.useState(!1),[j,y]=u.useState(null),[p,g]=u.useState("auto"),v=u.useCallback(async()=>{if(!(c||x)){h(!0),y(null);try{const T=await xn(s,r,n.id);d(T)}catch(T){y(T instanceof Error?T.message:"加载失败")}finally{h(!1)}}},[s,r,n.id,c,x]),f=()=>{a||v(),i()},D=()=>{if(x)return e.jsx("div",{className:"bg-bg-dark rounded-lg p-4 text-center text-text-muted text-sm",children:e.jsx("span",{className:"animate-pulse",children:"加载中..."})});if(j)return e.jsx("div",{className:"bg-red-500/10 border border-red-500/20 rounded-lg p-4 text-center text-red-400 text-sm",children:j});if(!c)return e.jsx("div",{className:"bg-bg-dark rounded-lg p-3 text-xs font-mono text-text-secondary",children:n.payloadPreview||"(无法预览)"});const{payloadText:T,payloadBase64:W}=c;switch(p==="auto"?rl(T,W):p){case"json":try{const z=JSON.parse(T||"");return e.jsx("div",{className:"bg-bg-dark rounded-lg p-3 max-h-80 overflow-auto",children:e.jsx(kr,{data:z})})}catch{return e.jsx("pre",{className:"bg-bg-dark rounded-lg p-3 text-xs font-mono text-text-secondary overflow-auto max-h-60 whitespace-pre-wrap break-all",children:T||W})}case"text":return e.jsx("pre",{className:"bg-bg-dark rounded-lg p-3 text-xs font-mono text-text-secondary overflow-auto max-h-60 whitespace-pre-wrap break-all",children:T||"(binary - cannot display as text)"});case"hex":return e.jsx("pre",{className:"bg-bg-dark rounded-lg p-3 text-xs font-mono text-text-secondary overflow-auto max-h-60 whitespace-pre-wrap break-all",children:Es(W)});case"base64":return e.jsx("pre",{className:"bg-bg-dark rounded-lg p-3 text-xs font-mono text-text-secondary overflow-auto max-h-60 whitespace-pre-wrap break-all",children:W});case"protobuf":return e.jsx("div",{className:"bg-bg-dark rounded-lg max-h-80 overflow-auto",children:e.jsx(zt,{base64Data:W})});default:return e.jsx("pre",{className:"bg-bg-dark rounded-lg p-3 text-xs font-mono text-text-secondary overflow-auto max-h-60 whitespace-pre-wrap break-all",children:T||Es(W)})}};return e.jsxs("div",{className:b("px-4 py-2 cursor-pointer transition-all","hover:bg-bg-light/30",a&&"bg-bg-light/50",o?"border-l-2 border-l-blue-500/50":"border-l-2 border-l-green-500/50"),onClick:f,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:b("w-7 h-7 rounded-lg flex items-center justify-center text-sm font-medium",o?"bg-blue-500/20 text-blue-400":"bg-green-500/20 text-green-400"),children:o?"↑":"↓"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:b("text-xs font-mono uppercase px-1.5 py-0.5 rounded",n.opcode==="text"?"bg-blue-500/10 text-blue-400":"bg-purple-500/10 text-purple-400"),children:n.opcode}),e.jsx("span",{className:"text-xs text-text-muted",children:ut(n.payloadSize)}),n.isMocked&&e.jsx("span",{className:"text-2xs px-1.5 py-0.5 bg-purple-500/20 text-purple-400 rounded",children:"MOCK"})]}),!a&&e.jsx("p",{className:"text-xs text-text-secondary truncate font-mono mt-0.5",children:n.payloadPreview||(l?"(empty)":"(binary data)")})]}),e.jsx("span",{className:"text-xs text-text-muted whitespace-nowrap",children:ue(n.timestamp)}),e.jsx("span",{className:b("text-xs text-text-muted transition-transform",a&&"rotate-90"),children:"▶"})]}),a&&e.jsxs("div",{className:"mt-3 ml-10",onClick:T=>T.stopPropagation(),children:[c&&e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xs text-text-muted",children:"格式:"}),["auto","text","json","protobuf","hex","base64"].map(T=>e.jsx("button",{onClick:()=>g(T),className:b("px-2 py-0.5 text-xs rounded transition-colors",p===T?"bg-primary/20 text-primary":"text-text-muted hover:text-text-primary hover:bg-bg-light"),children:T.toUpperCase()},T))]}),D()]})]})});function rl(t,s){if(!t){if(s)try{const r=atob(s),n=new Uint8Array(r.length);for(let a=0;a<r.length;a++)n[a]=r.charCodeAt(a);if(n.length>0&&(n[0]&7)<=5)return"protobuf"}catch{}return"hex"}try{return JSON.parse(t),"json"}catch{return"text"}}function Es(t){try{const s=atob(t),r=new Uint8Array(s.length);for(let a=0;a<s.length;a++)r[a]=s.charCodeAt(a);const n=[];for(let a=0;a<r.length;a+=16){const i=r.slice(a,a+16),o=Array.from(i).map(d=>d.toString(16).padStart(2,"0")).join(" "),l=Array.from(i).map(d=>d>=32&&d<=126?String.fromCharCode(d):".").join(""),c=a.toString(16).padStart(8,"0");n.push(`${c}  ${o.padEnd(48)}  ${l}`)}return n.join(`
`)}catch{return t}}function nl({session:t}){return e.jsxs("div",{className:"p-4 space-y-4 overflow-auto h-full",children:[e.jsxs("div",{className:"glass-card p-4",children:[e.jsx("h4",{className:"text-xs font-medium text-text-muted uppercase tracking-wider mb-3",children:"连接信息"}),e.jsxs("dl",{className:"space-y-2 text-sm",children:[e.jsx(Le,{label:"URL",value:t.url,mono:!0}),e.jsx(Le,{label:"连接时间",value:ue(t.connectTime)}),t.disconnectTime&&e.jsx(Le,{label:"断开时间",value:ue(t.disconnectTime)}),t.closeCode&&e.jsx(Le,{label:"关闭码",value:String(t.closeCode)}),t.closeReason&&e.jsx(Le,{label:"关闭原因",value:t.closeReason}),t.subprotocols.length>0&&e.jsx(Le,{label:"子协议",value:t.subprotocols.join(", ")})]})]}),Object.keys(t.requestHeaders).length>0&&e.jsxs("div",{className:"glass-card p-4",children:[e.jsx("h4",{className:"text-xs font-medium text-text-muted uppercase tracking-wider mb-3",children:"请求头"}),e.jsx("dl",{className:"space-y-1.5",children:Object.entries(t.requestHeaders).map(([s,r])=>e.jsxs("div",{className:"flex gap-2 text-xs",children:[e.jsxs("span",{className:"text-primary font-medium",children:[s,":"]}),e.jsx("span",{className:"text-text-secondary font-mono break-all",children:r})]},s))})]})]})}function Le({label:t,value:s,mono:r}){return e.jsxs("div",{className:"flex gap-3",children:[e.jsx("dt",{className:"text-text-muted w-20 flex-shrink-0",children:t}),e.jsx("dd",{className:b("text-text-primary break-all",r&&"font-mono text-xs"),children:s})]})}const al={httpRequest:{label:"HTTP 请求",icon:e.jsx(Ot,{size:12}),color:"text-blue-400 bg-blue-500/10 border-blue-500/20"},httpResponse:{label:"HTTP 响应",icon:e.jsx(Pt,{size:12}),color:"text-green-400 bg-green-500/10 border-green-500/20"},wsOutgoing:{label:"WS 发送",icon:e.jsx(Ye,{size:12}),color:"text-purple-400 bg-purple-500/10 border-purple-500/20"},wsIncoming:{label:"WS 接收",icon:e.jsx(Ge,{size:12}),color:"text-orange-400 bg-orange-500/10 border-orange-500/20"}};function il({rules:t,loading:s,onEdit:r,onDelete:n,onToggleEnabled:a,onCreateNew:i}){return t.length===0&&!s?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted py-12",children:[e.jsx(ce,{size:48,className:"mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"暂无 Mock 规则"}),e.jsx("p",{className:"text-sm mb-6",children:"创建规则来模拟 API 响应或修改请求"}),e.jsxs("button",{onClick:i,className:"btn bg-primary text-white hover:bg-primary-dark flex items-center gap-2",children:[e.jsx(ta,{size:16})," 创建第一条规则"]})]}):e.jsxs("div",{className:"divide-y divide-border/50",children:[t.map(o=>e.jsx(ol,{rule:o,onEdit:()=>r(o),onDelete:()=>n(o.id),onToggleEnabled:()=>a(o.id)},o.id)),s&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-primary border-t-transparent rounded-full"})})]})}function ol({rule:t,onEdit:s,onDelete:r,onToggleEnabled:n}){const a=al[t.targetType],i=ll(t),o=cl(t);return e.jsx("div",{className:b("px-4 py-4 transition-all group",t.enabled?"bg-transparent":"bg-bg-medium/30 opacity-60"),children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("button",{onClick:n,className:b("w-10 h-6 rounded-full relative transition-all flex-shrink-0 mt-1",t.enabled?"bg-primary":"bg-bg-light border border-border"),children:e.jsx("span",{className:b("absolute top-1 w-4 h-4 rounded-full bg-white shadow transition-all",t.enabled?"left-5":"left-1")})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-medium text-text-primary",children:t.name}),e.jsxs("span",{className:b("inline-flex items-center gap-1 px-2 py-0.5 text-xs rounded-full border",a.color),children:[e.jsx("span",{children:a.icon}),e.jsx("span",{children:a.label})]}),!t.deviceId&&e.jsx("span",{className:"text-2xs px-1.5 py-0.5 bg-yellow-500/10 text-yellow-400 border border-yellow-500/20 rounded",children:"全局"})]}),e.jsx("div",{className:"text-xs text-text-muted mb-1.5 space-y-0.5",children:i.map((l,c)=>e.jsxs("p",{children:[e.jsxs("span",{className:"text-text-secondary",children:[l.label,":"]})," ",e.jsx("span",{className:"font-mono",children:l.value})]},c))}),e.jsxs("div",{className:"text-xs text-text-muted flex items-center gap-1",children:[e.jsx("span",{className:"text-primary",children:e.jsx(sa,{size:12})})," ",o]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2 text-2xs text-text-muted",children:[e.jsxs("span",{children:["优先级: ",t.priority]}),t.updatedAt&&e.jsxs("span",{children:["更新于 ",ue(t.updatedAt)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:s,className:"p-2 rounded-lg hover:bg-bg-light text-text-muted hover:text-text-primary transition-all",title:"编辑",children:e.jsx(tr,{size:16})}),e.jsx("button",{onClick:()=>{confirm("确定要删除这条规则吗？")&&r()},className:"p-2 rounded-lg hover:bg-red-500/10 text-text-muted hover:text-red-400 transition-all",title:"删除",children:e.jsx(Ce,{size:16})})]})]})})}function ll(t){const s=[],r=t.condition;return r.urlPattern&&s.push({label:"URL",value:r.urlPattern}),r.method&&s.push({label:"方法",value:r.method}),r.statusCode&&s.push({label:"状态码",value:String(r.statusCode)}),r.bodyContains&&s.push({label:"包含",value:r.bodyContains}),r.wsPayloadContains&&s.push({label:"WS包含",value:r.wsPayloadContains}),s.length===0&&s.push({label:"匹配",value:"所有请求"}),s}function cl(t){const s=t.action,r=[];return s.mockResponseStatusCode&&r.push(`返回 ${s.mockResponseStatusCode}`),s.modifyRequestHeaders&&Object.keys(s.modifyRequestHeaders).length>0&&r.push("修改请求头"),s.modifyRequestBody&&r.push("修改请求体"),s.mockResponseBody&&r.push("自定义响应体"),s.mockWebSocketPayload&&r.push("替换 WS 消息"),s.delayMilliseconds&&r.push(`延迟 ${s.delayMilliseconds}ms`),r.length>0?r.join(", "):"无动作"}const dl=[{value:"httpRequest",label:"HTTP 请求",description:"修改发出的请求"},{value:"httpResponse",label:"HTTP 响应",description:"模拟或修改响应"},{value:"wsOutgoing",label:"WebSocket 发送",description:"修改发送的 WS 消息"},{value:"wsIncoming",label:"WebSocket 接收",description:"修改接收的 WS 消息"}],ul=[{value:"httpRequest",label:"HTTP 请求",description:"修改发出的请求"},{value:"httpResponse",label:"HTTP 响应",description:"模拟或修改响应"}];function Sr({rule:t,isOpen:s,onClose:r,onSave:n,loading:a,httpOnly:i=!1}){var V,B,ee;const o=i?ul:dl,l=!!t,c=t||ls(),[d,x]=u.useState(c.name),[h,j]=u.useState(c.targetType),[y,p]=u.useState(c.priority),[g,v]=u.useState(c.enabled),[f,D]=u.useState(c.condition.urlPattern||""),[T,W]=u.useState(c.condition.method||""),[H,z]=u.useState(((V=c.condition.statusCode)==null?void 0:V.toString())||""),[P,F]=u.useState(c.condition.bodyContains||""),[G,C]=u.useState(c.condition.wsPayloadContains||""),[_,U]=u.useState(((B=c.action.mockResponseStatusCode)==null?void 0:B.toString())||"200"),[L,E]=u.useState(c.action.mockResponseBody?atob(c.action.mockResponseBody):""),[m,N]=u.useState(JSON.stringify(c.action.mockResponseHeaders||{},null,2)),[w,M]=u.useState(c.action.mockWebSocketPayload?atob(c.action.mockWebSocketPayload):""),[k,O]=u.useState(((ee=c.action.delayMilliseconds)==null?void 0:ee.toString())||"");u.useEffect(()=>{var $,oe,le;if(s){const te=t||ls();x(te.name),j(te.targetType),p(te.priority),v(te.enabled),D(te.condition.urlPattern||""),W(te.condition.method||""),z((($=te.condition.statusCode)==null?void 0:$.toString())||""),F(te.condition.bodyContains||""),C(te.condition.wsPayloadContains||""),U(((oe=te.action.mockResponseStatusCode)==null?void 0:oe.toString())||"200"),E(te.action.mockResponseBody?atob(te.action.mockResponseBody):""),N(JSON.stringify(te.action.mockResponseHeaders||{},null,2)),M(te.action.mockWebSocketPayload?atob(te.action.mockWebSocketPayload):""),O(((le=te.action.delayMilliseconds)==null?void 0:le.toString())||"")}},[s,t]);const Q=()=>{const $={urlPattern:f||null,method:T||null,statusCode:H?parseInt(H):null,headerContains:null,bodyContains:P||null,wsPayloadContains:G||null,enabled:!0};let oe=null;try{oe=m?JSON.parse(m):null}catch{}const le={modifyRequestHeaders:null,modifyRequestBody:null,mockResponseStatusCode:_?parseInt(_):null,mockResponseHeaders:oe,mockResponseBody:L?btoa(L):null,mockWebSocketPayload:w?btoa(w):null,delayMilliseconds:k?parseInt(k):null};n({name:d,targetType:h,condition:$,action:le,priority:y,enabled:g})};if(!s)return null;const Y=h==="httpRequest"||h==="httpResponse",X=h==="wsOutgoing"||h==="wsIncoming",I=h==="httpResponse";return e.jsxs("div",{className:"fixed inset-0 z-[200] flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:r}),e.jsxs("div",{className:"relative w-full max-w-2xl max-h-[90vh] bg-bg-dark border border-border rounded-2xl shadow-2xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-border flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:l?"编辑规则":"创建 Mock 规则"}),e.jsx("button",{onClick:r,className:"p-2 rounded-lg hover:bg-bg-light text-text-muted hover:text-text-primary transition-all",children:"✕"})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-text-muted uppercase tracking-wider",children:"基本信息"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1.5",children:"规则名称 *"}),e.jsx("input",{type:"text",value:d,onChange:$=>x($.target.value),placeholder:"例如：Mock 用户信息接口",className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1.5",children:"目标类型 *"}),e.jsx("select",{value:h,onChange:$=>j($.target.value),className:"select w-full",children:o.map($=>e.jsx("option",{value:$.value,children:$.label},$.value))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1.5",children:"优先级"}),e.jsx("input",{type:"number",value:y,onChange:$=>p(parseInt($.target.value)||0),className:"input w-full"})]}),e.jsx("div",{className:"flex items-center gap-3 pt-5",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:g,onChange:$=>v($.target.checked),className:"accent-primary w-4 h-4"}),e.jsx("span",{className:"text-sm text-text-secondary",children:"启用规则"})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-text-muted uppercase tracking-wider",children:"匹配条件"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1.5",children:"URL 模式（支持 * 通配符和正则）"}),e.jsx("input",{type:"text",value:f,onChange:$=>D($.target.value),placeholder:"例如：*/api/user/* 或 ^https://api\\\\.example\\\\.com",className:"input w-full font-mono text-sm"})]}),Y&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1.5",children:"HTTP 方法"}),e.jsxs("select",{value:T,onChange:$=>W($.target.value),className:"select w-full",children:[e.jsx("option",{value:"",children:"任意方法"}),e.jsx("option",{value:"GET",children:"GET"}),e.jsx("option",{value:"POST",children:"POST"}),e.jsx("option",{value:"PUT",children:"PUT"}),e.jsx("option",{value:"DELETE",children:"DELETE"}),e.jsx("option",{value:"PATCH",children:"PATCH"})]})]}),I&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1.5",children:"原始状态码"}),e.jsx("input",{type:"number",value:H,onChange:$=>z($.target.value),placeholder:"仅匹配指定状态码的响应",className:"input w-full"})]})]}),Y&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1.5",children:"请求体包含"}),e.jsx("input",{type:"text",value:P,onChange:$=>F($.target.value),placeholder:"匹配请求体中包含的内容",className:"input w-full font-mono text-sm"})]}),X&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1.5",children:"消息包含"}),e.jsx("input",{type:"text",value:G,onChange:$=>C($.target.value),placeholder:"匹配 WebSocket 消息中包含的内容",className:"input w-full font-mono text-sm"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-text-muted uppercase tracking-wider",children:"响应配置"}),Y&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1.5",children:"Mock 状态码"}),e.jsx("input",{type:"number",value:_,onChange:$=>U($.target.value),placeholder:"200",className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1.5",children:"延迟 (ms)"}),e.jsx("input",{type:"number",value:k,onChange:$=>O($.target.value),placeholder:"0",className:"input w-full"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1.5",children:"响应头 (JSON)"}),e.jsx("textarea",{value:m,onChange:$=>N($.target.value),placeholder:'{"Content-Type": "application/json"}',rows:3,className:"input w-full font-mono text-sm resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1.5",children:"响应体"}),e.jsx("textarea",{value:L,onChange:$=>E($.target.value),placeholder:'{"success": true, "data": {...}}',rows:6,className:"input w-full font-mono text-sm resize-none"})]})]}),X&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1.5",children:"延迟 (ms)"}),e.jsx("input",{type:"number",value:k,onChange:$=>O($.target.value),placeholder:"0",className:"input w-32"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-text-muted mb-1.5",children:"替换消息内容"}),e.jsx("textarea",{value:w,onChange:$=>M($.target.value),placeholder:'{"type": "mock", "data": {...}}',rows:6,className:"input w-full font-mono text-sm resize-none"})]})]})]})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-border flex items-center justify-end gap-3",children:[e.jsx("button",{onClick:r,className:"btn btn-secondary",children:"取消"}),e.jsx("button",{onClick:Q,disabled:a||!d.trim(),className:"btn bg-primary text-white hover:bg-primary-dark disabled:opacity-50",children:a?"保存中...":l?"保存修改":"创建规则"})]})]})]})}function jt({isOpen:t,onClose:s,onConfirm:r,title:n,message:a,confirmText:i="确认",cancelText:o="取消",type:l="danger",loading:c=!1}){if(!t)return null;const x={danger:{icon:e.jsx(Re,{size:20}),iconBg:"bg-red-500/20",headerBg:"bg-red-500/5",titleColor:"text-red-400",confirmBg:"bg-red-500 hover:bg-red-600"},warning:{icon:e.jsx(Xs,{size:20}),iconBg:"bg-yellow-500/20",headerBg:"bg-yellow-500/5",titleColor:"text-yellow-400",confirmBg:"bg-yellow-500 hover:bg-yellow-600"},info:{icon:e.jsx(Zs,{size:20}),iconBg:"bg-blue-500/20",headerBg:"bg-blue-500/5",titleColor:"text-blue-400",confirmBg:"bg-blue-500 hover:bg-blue-600"}}[l];return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-bg-dark border border-border rounded-2xl shadow-2xl w-[400px] overflow-hidden animate-in fade-in zoom-in-95 duration-200",children:[e.jsx("div",{className:b("px-6 py-4 border-b border-border",x.headerBg),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:b("w-10 h-10 rounded-xl flex items-center justify-center",x.iconBg),children:e.jsx("span",{className:"text-xl",children:x.icon})}),e.jsx("h3",{className:b("text-lg font-bold",x.titleColor),children:n})]})}),e.jsx("div",{className:"px-6 py-5",children:e.jsx("p",{className:"text-text-secondary whitespace-pre-line",children:a})}),e.jsxs("div",{className:"px-6 py-4 border-t border-border bg-bg-medium/30 flex justify-end gap-3",children:[e.jsx("button",{onClick:s,disabled:c,className:"px-4 py-2 rounded-lg text-sm font-medium text-text-secondary hover:text-text-primary hover:bg-bg-light transition-all disabled:opacity-50",children:o}),e.jsx("button",{onClick:r,disabled:c,className:b("px-4 py-2 rounded-lg text-sm font-medium text-white transition-all disabled:opacity-50",x.confirmBg),children:c?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"处理中..."]}):i})]})]})})}function xl({deviceId:t,alwaysShow:s=!1,isExpanded:r=!1,onToggleExpand:n}){const{activities:a}=ir(),[i,o]=u.useState(!1),l=u.useMemo(()=>a.filter(x=>x.deviceId===t),[a,t]),c=l[0],d=(c==null?void 0:c.type)==="connected";return s?e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>o(!i),className:b("flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-medium transition-all",l.length===0?"bg-gray-500/10 text-gray-400 border border-gray-500/20 hover:bg-gray-500/15":d?"bg-green-500/10 text-green-400 border border-green-500/20 hover:bg-green-500/15":"bg-orange-500/10 text-orange-400 border border-orange-500/20 hover:bg-orange-500/15"),children:[e.jsx("span",{className:b("w-2 h-2 rounded-full",l.length===0?"bg-gray-500":d?"bg-green-500":"bg-orange-500")}),e.jsx("span",{children:"连接活动"}),l.length>0&&e.jsxs("span",{className:"text-2xs opacity-60",children:["(",l.length,")"]}),e.jsx("span",{className:"ml-1",children:i?e.jsx(Ye,{size:10}):e.jsx(Ge,{size:10})})]}),i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>o(!1)}),e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-72 bg-bg-dark border border-border rounded-lg shadow-lg z-50 overflow-hidden animate-fadeIn",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-border flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-text-primary",children:"连接活动"}),l.length>0&&e.jsxs("span",{className:"text-2xs text-text-muted",children:[l.length," 条记录"]})]}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:l.length===0?e.jsx("div",{className:"px-3 py-6 text-center text-xs text-text-muted",children:"暂无连接活动记录"}):l.slice(0,20).map((x,h)=>e.jsx(Ts,{activity:x,isFirst:h===0},x.id))})]})]})]}):l.length===0?null:e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:n,className:b("flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-medium transition-all",d?"bg-green-500/10 text-green-400 border border-green-500/20 hover:bg-green-500/15":"bg-orange-500/10 text-orange-400 border border-orange-500/20 hover:bg-orange-500/15"),children:[e.jsx("span",{className:b("w-2 h-2 rounded-full",d?"bg-green-500":"bg-orange-500")}),e.jsx("span",{children:d?"已连接":"重连中..."}),l.length>1&&e.jsxs("span",{className:"text-2xs opacity-60",children:["(",l.length,")"]}),e.jsx("span",{className:"ml-1",children:r?e.jsx(Ye,{size:10}):e.jsx(Ge,{size:10})})]}),r&&e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-80 bg-bg-dark border border-border rounded-lg shadow-lg z-50 overflow-hidden animate-fadeIn",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-border flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-text-primary",children:"连接活动"}),e.jsxs("span",{className:"text-2xs text-text-muted",children:[l.length," 条记录"]})]}),e.jsx("div",{className:"max-h-64 overflow-y-auto",children:l.slice(0,20).map((x,h)=>e.jsx(Ts,{activity:x,isFirst:h===0},x.id))})]})]})}function Ts({activity:t,isFirst:s,compact:r=!1}){const n=t.type==="connected";return r?e.jsxs("div",{className:b("flex items-center gap-2 px-3 py-1.5 border-b border-border-light transition-colors",s&&"bg-bg-light/30"),children:[e.jsx("span",{className:b("w-1.5 h-1.5 rounded-full flex-shrink-0",n?"bg-green-500":"bg-red-500")}),e.jsx("span",{className:b("text-2xs",n?"text-green-400":"text-red-400"),children:n?"已连接":"已断开"}),e.jsx("span",{className:"text-2xs text-text-muted flex-1 text-right",children:ue(t.timestamp)})]}):e.jsxs("div",{className:b("flex items-center gap-3 px-4 py-2.5 border-b border-border-light transition-colors",s&&"bg-bg-light/30"),children:[e.jsx("div",{className:b("w-8 h-8 rounded flex items-center justify-center flex-shrink-0",n?"bg-green-500/15":"bg-red-500/15"),children:n?e.jsx(de,{size:14}):e.jsx(Xn,{size:14})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:b("text-xs font-medium",n?"text-green-400":"text-red-400"),children:n?"设备已连接":"设备已断开"}),e.jsxs("div",{className:"text-2xs text-text-muted font-mono truncate",children:[ue(t.timestamp),t.sessionId&&e.jsxs("span",{className:"ml-2 opacity-60",children:["#",t.sessionId.slice(0,6)]})]})]})]})}function ml({hits:t,onResume:s,loading:r}){const[n,a]=u.useState(null),i=u.useMemo(()=>t.find(o=>o.requestId===n)||t[0]||null,[t,n]);return t.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-text-muted",children:[e.jsx(Ke,{size:36,className:"mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:"暂无等待处理的断点"}),e.jsx("p",{className:"text-xs mt-1",children:"当请求命中断点规则时会在这里显示"})]}):e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-border bg-orange-500/10 flex items-center gap-3",children:[e.jsx(Ft,{size:24,className:"text-orange-400 animate-pulse"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-medium text-orange-400",children:[t.length," 个断点等待处理"]}),e.jsx("p",{className:"text-xs text-text-muted",children:"请求已被拦截，等待您的操作"})]})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{className:"w-1/3 border-r border-border overflow-auto",children:t.map(o=>e.jsxs("div",{onClick:()=>a(o.requestId),className:b("p-3 border-b border-border cursor-pointer transition-colors",(i==null?void 0:i.requestId)===o.requestId?"bg-primary/10 border-l-2 border-l-primary":"hover:bg-bg-light"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:b("px-1.5 py-0.5 text-xs rounded font-medium",o.phase==="request"?"bg-blue-500/20 text-blue-400":"bg-green-500/20 text-green-400"),children:o.phase==="request"?"请求":"响应"}),e.jsx("span",{className:"text-xs font-mono text-text-secondary",children:o.request.method})]}),e.jsx("div",{className:"text-xs text-text-muted truncate font-mono",children:new URL(o.request.url).pathname})]},o.requestId))}),e.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:i&&e.jsx(hl,{hit:i,onResume:s,loading:r})})]})]})}function hl({hit:t,onResume:s,loading:r}){const[n,a]=u.useState(!1),[i,o]=u.useState(t.request),[l,c]=u.useState(t.response),[d,x]=u.useState("request");u.useState(()=>{o(t.request),c(t.response),a(!1)});const h=()=>{s(t.requestId,{type:"resume"})},j=()=>{s(t.requestId,{type:"abort"})},y=()=>{const v={type:"modify",modification:{request:t.phase==="request"?i:void 0,response:t.phase==="response"?l??void 0:void 0}};s(t.requestId,v)},p=()=>{l&&s(t.requestId,{type:"mockResponse",mockResponse:l})},g=v=>{try{return btoa(v)}catch{return v}};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b border-border bg-bg-dark/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:b("px-2 py-1 text-xs rounded font-bold",{"bg-green-500/20 text-green-400":t.request.method==="GET","bg-blue-500/20 text-blue-400":t.request.method==="POST","bg-yellow-500/20 text-yellow-400":t.request.method==="PUT","bg-red-500/20 text-red-400":t.request.method==="DELETE","bg-purple-500/20 text-purple-400":t.request.method==="PATCH"}),children:t.request.method}),e.jsx("span",{className:b("px-2 py-0.5 text-xs rounded",t.phase==="request"?"bg-blue-500/20 text-blue-400":"bg-green-500/20 text-green-400"),children:t.phase==="request"?"请求阶段":"响应阶段"})]}),e.jsx("code",{className:"text-sm text-text-primary break-all",children:t.request.url})]}),e.jsxs("div",{className:"flex border-b border-border",children:[e.jsx("button",{onClick:()=>x("request"),className:b("px-4 py-2 text-sm font-medium transition-colors",d==="request"?"text-primary border-b-2 border-primary":"text-text-muted hover:text-text-primary"),children:"请求"}),(t.phase==="response"||n)&&e.jsx("button",{onClick:()=>x("response"),className:b("px-4 py-2 text-sm font-medium transition-colors",d==="response"?"text-primary border-b-2 border-primary":"text-text-muted hover:text-text-primary"),children:"响应"}),e.jsx("div",{className:"flex-1"}),e.jsxs("button",{onClick:()=>a(!n),className:b("px-4 py-2 text-sm transition-colors flex items-center gap-1.5",n?"text-primary":"text-text-muted hover:text-text-primary"),children:[e.jsx(Me,{size:14}),n?"编辑中":"编辑"]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:d==="request"?e.jsx(pl,{request:i,onChange:o,editable:n&&t.phase==="request"}):e.jsx(fl,{response:l,onChange:c,editable:n,showCreateButton:!l&&n,onCreateResponse:()=>c({statusCode:200,headers:{"Content-Type":"application/json"},body:g("{}")})})}),e.jsxs("div",{className:"p-4 border-t border-border bg-bg-dark/50 flex items-center gap-3",children:[e.jsxs("button",{onClick:h,disabled:r,className:"btn btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(na,{size:16})," 继续"]}),n&&e.jsxs("button",{onClick:y,disabled:r,className:"btn bg-blue-500/20 text-blue-400 border border-blue-500/30 hover:bg-blue-500/30 flex-1 flex items-center justify-center gap-2",children:[e.jsx(Me,{size:16})," 修改后继续"]}),t.phase==="request"&&n&&l&&e.jsxs("button",{onClick:p,disabled:r,className:"btn bg-purple-500/20 text-purple-400 border border-purple-500/30 hover:bg-purple-500/30 flex-1 flex items-center justify-center gap-2",children:[e.jsx(ce,{size:16})," 返回 Mock 响应"]}),e.jsxs("button",{onClick:j,disabled:r,className:"btn btn-danger flex items-center justify-center gap-2",children:[e.jsx(aa,{size:16})," 中止"]})]})]})}function pl({request:t,onChange:s,editable:r}){const n=u.useMemo(()=>{if(!t.body)return"";try{return atob(t.body)}catch{return t.body}},[t.body]),a=i=>{try{return JSON.stringify(JSON.parse(i),null,2)}catch{return i}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-text-secondary mb-2",children:"Headers"}),e.jsx("div",{className:"bg-bg-dark rounded-lg border border-border overflow-hidden",children:Object.entries(t.headers).map(([i,o])=>e.jsxs("div",{className:"flex border-b border-border last:border-b-0",children:[e.jsx("div",{className:"w-1/3 px-3 py-2 text-xs font-mono text-text-muted bg-bg-medium/50 border-r border-border",children:i}),e.jsx("div",{className:"flex-1 px-3 py-2 text-xs font-mono text-text-primary break-all",children:r?e.jsx("input",{type:"text",value:o,onChange:l=>s({...t,headers:{...t.headers,[i]:l.target.value}}),className:"w-full bg-transparent border-none outline-none"}):o})]},i))})]}),t.body&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-text-secondary mb-2",children:"Body"}),r?e.jsx("textarea",{value:n,onChange:i=>s({...t,body:btoa(i.target.value)}),className:"w-full h-64 bg-bg-dark border border-border rounded-lg p-3 font-mono text-xs text-text-primary resize-none",spellCheck:!1}):e.jsx("pre",{className:"bg-bg-dark border border-border rounded-lg p-3 font-mono text-xs text-text-primary overflow-auto max-h-64",children:a(n)})]})]})}function fl({response:t,onChange:s,editable:r,showCreateButton:n,onCreateResponse:a}){if(!t)return n&&a?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted",children:[e.jsx("p",{className:"text-sm mb-3",children:"尚无响应数据"}),e.jsx("button",{onClick:a,className:"btn btn-primary",children:"创建 Mock 响应"})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-text-muted",children:e.jsx("p",{className:"text-sm",children:"请求阶段断点，暂无响应数据"})});const i=u.useMemo(()=>{if(!t.body)return"";try{return atob(t.body)}catch{return t.body}},[t.body]),o=l=>{try{return JSON.stringify(JSON.parse(l),null,2)}catch{return l}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-text-secondary mb-2",children:"Status Code"}),r?e.jsx("input",{type:"number",value:t.statusCode,onChange:l=>s({...t,statusCode:parseInt(l.target.value)||200}),className:"input w-32"}):e.jsx("span",{className:b("px-2 py-1 rounded text-sm font-medium",t.statusCode>=200&&t.statusCode<300?"bg-green-500/20 text-green-400":t.statusCode>=400?"bg-red-500/20 text-red-400":"bg-yellow-500/20 text-yellow-400"),children:t.statusCode})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-text-secondary mb-2",children:"Headers"}),e.jsx("div",{className:"bg-bg-dark rounded-lg border border-border overflow-hidden",children:Object.entries(t.headers).map(([l,c])=>e.jsxs("div",{className:"flex border-b border-border last:border-b-0",children:[e.jsx("div",{className:"w-1/3 px-3 py-2 text-xs font-mono text-text-muted bg-bg-medium/50 border-r border-border",children:l}),e.jsx("div",{className:"flex-1 px-3 py-2 text-xs font-mono text-text-primary break-all",children:r?e.jsx("input",{type:"text",value:c,onChange:d=>s({...t,headers:{...t.headers,[l]:d.target.value}}),className:"w-full bg-transparent border-none outline-none"}):c})]},l))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-text-secondary mb-2",children:"Body"}),r?e.jsx("textarea",{value:i,onChange:l=>s({...t,body:btoa(l.target.value)}),className:"w-full h-64 bg-bg-dark border border-border rounded-lg p-3 font-mono text-xs text-text-primary resize-none",spellCheck:!1}):e.jsx("pre",{className:"bg-bg-dark border border-border rounded-lg p-3 font-mono text-xs text-text-primary overflow-auto max-h-64",children:o(i)||"(empty)"})]})]})}function gl({deviceId:t,pendingHits:s,onResumeBreakpoint:r}){const[n,a]=u.useState([]),[i,o]=u.useState(!1),[l,c]=u.useState(null),[d,x]=u.useState(!1),[h,j]=u.useState("rules"),[y,p]=u.useState([]),[g,v]=u.useState(!1),f=s??y,D=u.useCallback(async()=>{o(!0);try{const C=await As(t);a(C)}catch(C){console.error("Failed to fetch breakpoint rules:",C)}finally{o(!1)}},[t]),T=u.useCallback(async()=>{if(s===void 0)try{const C=await $s(t);p(C)}catch(C){console.error("Failed to fetch pending breakpoints:",C)}},[t,s]);u.useEffect(()=>{D(),T();const C=setInterval(T,2e3);return()=>clearInterval(C)},[D,T]),u.useEffect(()=>{f.length>0&&j("pending")},[f.length]);const W=()=>{c({name:"",urlPattern:"",method:"",phase:"request",enabled:!0,priority:0}),x(!0)},H=C=>{c({...C}),x(!0)},z=async()=>{if(l)try{l.id?await as(t,l.id,l):await bn(t,l),x(!1),c(null),D()}catch(C){console.error("Failed to save breakpoint rule:",C)}},P=async C=>{if(confirm("确定要删除这条断点规则吗？"))try{await Bs(t,C),D()}catch(_){console.error("Failed to delete breakpoint rule:",_)}},F=async C=>{try{await as(t,C.id,{enabled:!C.enabled}),D()}catch(_){console.error("Failed to toggle breakpoint rule:",_)}},G=async(C,_)=>{v(!0);try{r?r(C,_):(await Hs(t,C,_),p(U=>U.filter(L=>L.requestId!==C)))}catch(U){console.error("Failed to resume breakpoint:",U)}finally{v(!1)}};return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-border bg-bg-dark/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ft,{size:24,className:"text-text-primary"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-text-primary",children:"断点管理"}),e.jsx("p",{className:"text-xs text-text-muted",children:"拦截请求/响应并等待手动操作"})]})]}),h==="rules"&&e.jsx("button",{onClick:W,className:"btn btn-primary text-sm",children:"+ 新建规则"})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("button",{onClick:()=>j("rules"),className:b("px-4 py-2 rounded-lg text-sm font-medium transition-colors",h==="rules"?"bg-bg-light text-text-primary":"text-text-muted hover:text-text-secondary hover:bg-bg-light/50"),children:["规则列表 (",n.length,")"]}),e.jsxs("button",{onClick:()=>j("pending"),className:b("px-4 py-2 rounded-lg text-sm font-medium transition-colors relative",h==="pending"?"bg-bg-light text-text-primary":"text-text-muted hover:text-text-secondary hover:bg-bg-light/50"),children:["等待处理",f.length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-orange-500 text-white text-xs rounded-full flex items-center justify-center animate-pulse",children:f.length})]})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:h==="rules"?e.jsx("div",{className:"h-full overflow-auto p-4",children:i?e.jsx("div",{className:"flex items-center justify-center h-full text-text-muted",children:"加载中..."}):n.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted",children:[e.jsx(Ft,{size:48,className:"mb-3 opacity-50"}),e.jsx("p",{className:"text-sm mb-3",children:"暂无断点规则"}),e.jsx("button",{onClick:W,className:"btn btn-primary text-sm",children:"+ 新建规则"})]}):e.jsx("div",{className:"space-y-3",children:n.map(C=>e.jsx(bl,{rule:C,onEdit:()=>H(C),onDelete:()=>P(C.id),onToggle:()=>F(C)},C.id))})}):e.jsx(ml,{hits:f,onResume:G,loading:g})}),d&&l&&e.jsx(yl,{rule:l,onChange:c,onSave:z,onCancel:()=>{x(!1),c(null)}})]})}function bl({rule:t,onEdit:s,onDelete:r,onToggle:n}){const a={request:"请求阶段",response:"响应阶段",both:"双向拦截"};return e.jsx("div",{className:b("p-4 bg-bg-dark border border-border rounded-xl transition-all",!t.enabled&&"opacity-50"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:n,className:b("w-10 h-6 rounded-full transition-colors relative",t.enabled?"bg-primary":"bg-bg-light"),children:e.jsx("span",{className:b("absolute top-1 w-4 h-4 bg-white rounded-full transition-transform",t.enabled?"left-5":"left-1")})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-text-primary",children:t.name||"未命名规则"}),e.jsxs("div",{className:"text-xs text-text-muted flex items-center gap-2",children:[e.jsx("span",{className:"px-1.5 py-0.5 bg-orange-500/20 text-orange-400 rounded text-2xs",children:a[t.phase]}),t.method&&e.jsx("span",{className:"px-1.5 py-0.5 bg-blue-500/20 text-blue-400 rounded text-2xs",children:t.method}),t.urlPattern&&e.jsx("code",{className:"text-text-secondary truncate max-w-[200px]",children:t.urlPattern})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:s,className:"p-2 text-text-muted hover:text-text-primary hover:bg-bg-light rounded-lg transition-colors",children:e.jsx(Me,{size:16})}),e.jsx("button",{onClick:r,className:"p-2 text-text-muted hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-colors",children:e.jsx(Ce,{size:16})})]})]})})}function yl({rule:t,onChange:s,onSave:r,onCancel:n}){return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-bg-dark border border-border rounded-2xl w-full max-w-lg p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-text-primary mb-4",children:t.id?"编辑断点规则":"新建断点规则"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-muted mb-1",children:"规则名称"}),e.jsx("input",{type:"text",value:t.name||"",onChange:a=>s({...t,name:a.target.value}),placeholder:"例如：拦截登录接口",className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-muted mb-1",children:"URL 匹配模式"}),e.jsx("input",{type:"text",value:t.urlPattern||"",onChange:a=>s({...t,urlPattern:a.target.value}),placeholder:"例如：*/api/login* 或留空匹配所有",className:"input w-full font-mono"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-muted mb-1",children:"HTTP 方法"}),e.jsxs("select",{value:t.method||"",onChange:a=>s({...t,method:a.target.value||null}),className:"select w-full",children:[e.jsx("option",{value:"",children:"全部方法"}),e.jsx("option",{value:"GET",children:"GET"}),e.jsx("option",{value:"POST",children:"POST"}),e.jsx("option",{value:"PUT",children:"PUT"}),e.jsx("option",{value:"DELETE",children:"DELETE"}),e.jsx("option",{value:"PATCH",children:"PATCH"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-muted mb-1",children:"拦截阶段"}),e.jsxs("select",{value:t.phase||"request",onChange:a=>s({...t,phase:a.target.value}),className:"select w-full",children:[e.jsx("option",{value:"request",children:"请求阶段"}),e.jsx("option",{value:"response",children:"响应阶段"}),e.jsx("option",{value:"both",children:"双向拦截"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-muted mb-1",children:"优先级"}),e.jsx("input",{type:"number",value:t.priority||0,onChange:a=>s({...t,priority:parseInt(a.target.value)||0}),className:"input w-full"}),e.jsx("p",{className:"text-xs text-text-muted mt-1",children:"数值越大优先级越高"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:n,className:"btn btn-secondary",children:"取消"}),e.jsx("button",{onClick:r,className:"btn btn-primary",children:"保存"})]})]})})}function jl({deviceId:t}){const[s,r]=u.useState([]),[n,a]=u.useState(!1),[i,o]=u.useState(null),[l,c]=u.useState(!1),d=u.useCallback(async()=>{a(!0);try{const g=await Ws(t);r(g)}catch(g){console.error("Failed to fetch chaos rules:",g)}finally{a(!1)}},[t]);u.useEffect(()=>{d()},[d]);const x=()=>{o({name:"",urlPattern:"",chaos:{type:"latency",minLatency:500,maxLatency:2e3},enabled:!0,priority:0,probability:1}),c(!0)},h=g=>{o({...g}),c(!0)},j=async()=>{if(i)try{i.id?await is(t,i.id,i):await jn(t,i),c(!1),o(null),d()}catch(g){console.error("Failed to save chaos rule:",g)}},y=async g=>{if(confirm("确定要删除这条故障注入规则吗？"))try{await Us(t,g),d()}catch(v){console.error("Failed to delete chaos rule:",v)}},p=async g=>{try{await is(t,g.id,{enabled:!g.enabled}),d()}catch(v){console.error("Failed to toggle chaos rule:",v)}};return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-border bg-bg-dark/50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ve,{size:24,className:"text-text-primary"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-text-primary",children:"故障注入规则"}),e.jsx("p",{className:"text-xs text-text-muted",children:"注入网络故障来测试应用的健壮性"})]})]}),e.jsx("button",{onClick:x,className:"btn btn-primary text-sm",children:"+ 新建规则"})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:n?e.jsx("div",{className:"flex items-center justify-center h-full text-text-muted",children:"加载中..."}):s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted",children:[e.jsx(Ve,{size:48,className:"mb-3 opacity-50"}),e.jsx("p",{className:"text-sm mb-3",children:"暂无故障注入规则"}),e.jsx("button",{onClick:x,className:"btn btn-primary text-sm",children:"+ 新建规则"})]}):e.jsx("div",{className:"space-y-3",children:s.map(g=>e.jsx(vl,{rule:g,onEdit:()=>h(g),onDelete:()=>y(g.id),onToggle:()=>p(g)},g.id))})}),l&&i&&e.jsx(wl,{rule:i,onChange:o,onSave:j,onCancel:()=>{c(!1),o(null)}})]})}const Ir={latency:{label:"延迟",color:"bg-yellow-500/20 text-yellow-400",icon:e.jsx(ca,{size:16}),description:"增加网络延迟"},timeout:{label:"超时",color:"bg-orange-500/20 text-orange-400",icon:e.jsx(ot,{size:16}),description:"请求超时"},connectionReset:{label:"连接重置",color:"bg-red-500/20 text-red-400",icon:e.jsx(da,{size:16}),description:"模拟连接重置"},randomError:{label:"随机错误",color:"bg-pink-500/20 text-pink-400",icon:e.jsx(la,{size:16}),description:"返回随机错误码"},corruptResponse:{label:"数据损坏",color:"bg-purple-500/20 text-purple-400",icon:e.jsx(ua,{size:16}),description:"损坏响应数据"},slowNetwork:{label:"慢速网络",color:"bg-blue-500/20 text-blue-400",icon:e.jsx(xa,{size:16}),description:"限制网络带宽"},dropRequest:{label:"丢弃请求",color:"bg-gray-500/20 text-gray-400",icon:e.jsx(Ce,{size:16}),description:"直接丢弃请求"}};function vl({rule:t,onEdit:s,onDelete:r,onToggle:n}){const a=Ir[t.chaos.type],o=(()=>{const l=t.chaos;switch(l.type){case"latency":return`延迟: ${l.minLatency}-${l.maxLatency}ms`;case"slowNetwork":return`带宽: ${l.bytesPerSecond} B/s`;case"randomError":return`错误码: ${l.errorCodes.join(", ")}`;default:return null}})();return e.jsxs("div",{className:b("p-4 bg-bg-dark border border-border rounded-xl transition-all",!t.enabled&&"opacity-50"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:n,className:b("w-10 h-6 rounded-full transition-colors relative",t.enabled?"bg-primary":"bg-bg-light"),children:e.jsx("span",{className:b("absolute top-1 w-4 h-4 bg-white rounded-full transition-transform",t.enabled?"left-5":"left-1")})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-text-primary flex items-center gap-2",children:[e.jsx("span",{children:a.icon}),t.name||"未命名规则"]}),e.jsxs("div",{className:"text-xs text-text-muted flex items-center gap-2 mt-1",children:[e.jsx("span",{className:b("px-1.5 py-0.5 rounded text-2xs",a.color),children:a.label}),t.probability<1&&e.jsxs("span",{className:"px-1.5 py-0.5 bg-purple-500/20 text-purple-400 rounded text-2xs",children:[Math.round(t.probability*100),"% 概率"]}),t.urlPattern&&e.jsx("code",{className:"text-text-secondary truncate max-w-[200px]",children:t.urlPattern})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:s,className:"p-2 text-text-muted hover:text-text-primary hover:bg-bg-light rounded-lg transition-colors",children:e.jsx(Me,{size:16})}),e.jsx("button",{onClick:r,className:"p-2 text-text-muted hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-colors",children:e.jsx(Ce,{size:16})})]})]}),o&&e.jsx("div",{className:"mt-2 text-xs text-text-muted",children:o})]})}function wl({rule:t,onChange:s,onSave:r,onCancel:n}){var l,c,d,x;const a=((l=t.chaos)==null?void 0:l.type)||"latency",i=h=>{let j;switch(h){case"latency":j={type:"latency",minLatency:500,maxLatency:2e3};break;case"timeout":j={type:"timeout"};break;case"connectionReset":j={type:"connectionReset"};break;case"randomError":j={type:"randomError",errorCodes:[500,502,503]};break;case"corruptResponse":j={type:"corruptResponse"};break;case"slowNetwork":j={type:"slowNetwork",bytesPerSecond:1024};break;case"dropRequest":j={type:"dropRequest"};break;default:j={type:"latency",minLatency:500,maxLatency:2e3}}s({...t,chaos:j})},o=h=>{t.chaos&&s({...t,chaos:{...t.chaos,...h}})};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-bg-dark border border-border rounded-2xl w-full max-w-lg p-6 max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-lg font-medium text-text-primary mb-4",children:t.id?"编辑故障注入规则":"新建故障注入规则"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-muted mb-1",children:"规则名称"}),e.jsx("input",{type:"text",value:t.name||"",onChange:h=>s({...t,name:h.target.value}),placeholder:"例如：登录接口延迟",className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-muted mb-1",children:"URL 匹配模式"}),e.jsx("input",{type:"text",value:t.urlPattern||"",onChange:h=>s({...t,urlPattern:h.target.value}),placeholder:"例如：*/api/login* 或留空匹配所有",className:"input w-full font-mono"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-muted mb-2",children:"故障注入类型"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(Ir).map(([h,j])=>e.jsxs("button",{onClick:()=>i(h),className:b("p-3 rounded-lg border text-left transition-all",a===h?"border-primary bg-primary/10":"border-border hover:border-border-hover"),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:j.icon}),e.jsx("span",{className:"font-medium text-text-primary",children:j.label})]}),e.jsx("p",{className:"text-xs text-text-muted mt-1",children:j.description})]},h))})]}),((c=t.chaos)==null?void 0:c.type)==="latency"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-muted mb-1",children:"最小延迟 (ms)"}),e.jsx("input",{type:"number",value:t.chaos.minLatency,onChange:h=>o({minLatency:parseInt(h.target.value)||0}),className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-muted mb-1",children:"最大延迟 (ms)"}),e.jsx("input",{type:"number",value:t.chaos.maxLatency,onChange:h=>o({maxLatency:parseInt(h.target.value)||0}),className:"input w-full"})]})]}),((d=t.chaos)==null?void 0:d.type)==="slowNetwork"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-muted mb-1",children:"带宽限制 (B/s)"}),e.jsx("input",{type:"number",value:t.chaos.bytesPerSecond,onChange:h=>o({bytesPerSecond:parseInt(h.target.value)||1024}),className:"input w-full"}),e.jsx("p",{className:"text-xs text-text-muted mt-1",children:"1024 = 1KB/s, 10240 = 10KB/s"})]}),((x=t.chaos)==null?void 0:x.type)==="randomError"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-muted mb-1",children:"错误状态码 (逗号分隔)"}),e.jsx("input",{type:"text",value:t.chaos.errorCodes.join(", "),onChange:h=>{const j=h.target.value.split(",").map(y=>parseInt(y.trim())).filter(y=>!isNaN(y));o({errorCodes:j.length>0?j:[500]})},placeholder:"500, 502, 503",className:"input w-full"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-muted mb-1",children:"触发概率"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"range",min:"0",max:"100",value:(t.probability||1)*100,onChange:h=>s({...t,probability:parseInt(h.target.value)/100}),className:"flex-1"}),e.jsxs("span",{className:"text-text-primary w-12 text-right",children:[Math.round((t.probability||1)*100),"%"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-muted mb-1",children:"优先级"}),e.jsx("input",{type:"number",value:t.priority||0,onChange:h=>s({...t,priority:parseInt(h.target.value)||0}),className:"input w-full"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:n,className:"btn btn-secondary",children:"取消"}),e.jsx("button",{onClick:r,className:"btn btn-primary",children:"保存"})]})]})})}const Ss={databases:[],dbLoading:!1,dbError:null,dbSortOrder:"name",dbSortAscending:!0,selectedDb:null,selectedTable:null,tables:[],tablesLoading:!1,schema:[],showSchema:!1,tableData:null,dataLoading:!1,dataError:null,page:1,pageSize:100,orderBy:null,ascending:!0,queryMode:!1,queryInput:"",queryResult:null,queryLoading:!1,queryError:null},Nl=ae((t,s)=>({...Ss,loadDatabases:async r=>{t({dbLoading:!0,dbError:null});try{const n=await wn(r);t({databases:n.databases,dbLoading:!1})}catch(n){t({dbError:n instanceof Error?n.message:"Failed to load databases",dbLoading:!1})}},loadTables:async(r,n)=>{t({tablesLoading:!0,tables:[]});try{const a=await Nn(r,n);t({tables:a.tables,tablesLoading:!1})}catch(a){console.error("Failed to load tables:",a),t({tablesLoading:!1})}},loadSchema:async(r,n,a)=>{try{const i=await kn(r,n,a);t({schema:i.columns})}catch(i){console.error("Failed to load schema:",i),t({schema:[]})}},loadTableData:async(r,n,a)=>{const{page:i,pageSize:o,orderBy:l,ascending:c,tables:d}=s();t({dataLoading:!0,dataError:null});try{const x=await kt(r,n,a,{page:i,pageSize:o,orderBy:l??void 0,ascending:c}),h=d.map(j=>j.name===a&&x.totalRows!==null?{...j,rowCount:x.totalRows}:j);t({tableData:x,dataLoading:!1,tables:h})}catch(x){const h=x instanceof Error?x.message:"Failed to load table data";console.error("Failed to load table data:",x),t({tableData:null,dataLoading:!1,dataError:h})}},selectDb:r=>{s().selectedDb!==r&&t({selectedDb:r,selectedTable:null,tables:[],schema:[],tableData:null,page:1,orderBy:null})},selectTable:r=>{s().selectedTable!==r&&t({selectedTable:r,schema:[],tableData:null,page:1,orderBy:null})},setShowSchema:r=>{t({showSchema:r})},setPage:r=>{t({page:r})},setSort:r=>{const{orderBy:n,ascending:a}=s();t(n===r?{ascending:!a,page:1}:{orderBy:r,ascending:!0,page:1})},setSortAndReload:async(r,n)=>{const{orderBy:a,ascending:i,selectedDb:o,selectedTable:l}=s(),c=a===n?!i:!0;if(t({orderBy:n,ascending:c,page:1,dataLoading:!0}),o&&l)try{const d=await kt(r,o,l,{page:1,pageSize:s().pageSize,orderBy:n,ascending:c});t({tableData:d,dataLoading:!1})}catch(d){console.error("Failed to load table data:",d),t({dataLoading:!1})}},setPageAndReload:async(r,n)=>{const{selectedDb:a,selectedTable:i,pageSize:o,orderBy:l,ascending:c}=s();if(t({page:n,dataLoading:!0}),a&&i)try{const d=await kt(r,a,i,{page:n,pageSize:o,orderBy:l??void 0,ascending:c});t({tableData:d,dataLoading:!1})}catch(d){console.error("Failed to load table data:",d),t({dataLoading:!1})}},setQueryMode:r=>{t({queryMode:r,queryError:null}),r||t({queryResult:null})},setQueryInput:r=>{t({queryInput:r})},executeQuery:async r=>{const{selectedDb:n,queryInput:a}=s();if(!n||!a.trim()){t({queryError:"请选择数据库并输入 SQL 查询语句"});return}t({queryLoading:!0,queryError:null,queryResult:null});try{const i=await Cn(r,n,a);t({queryResult:i,queryLoading:!1})}catch(i){t({queryError:i instanceof Error?i.message:"Query execution failed",queryLoading:!1})}},clearQueryResult:()=>{t({queryResult:null,queryError:null})},setDbSortOrder:r=>{t({dbSortOrder:r})},toggleDbSortDirection:()=>{t(r=>({dbSortAscending:!r.dbSortAscending}))},getSortedDatabases:()=>{const{databases:r,dbSortOrder:n,dbSortAscending:a}=s();return[...r].sort((o,l)=>{let c=0;switch(n){case"name":c=o.descriptor.name.localeCompare(l.descriptor.name);break;case"size":c=(o.fileSizeBytes??0)-(l.fileSizeBytes??0);break;case"tableCount":c=(o.tableCount??0)-(l.tableCount??0);break}return a?c:-c})},reset:()=>{t(Ss)}}));var Is={exports:{}};const kl={google:{nested:{protobuf:{options:{go_package:"google.golang.org/protobuf/types/descriptorpb",java_package:"com.google.protobuf",java_outer_classname:"DescriptorProtos",csharp_namespace:"Google.Protobuf.Reflection",objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{FileDescriptorSet:{edition:"proto2",fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}},extensions:[[536e6,536e6]]},Edition:{edition:"proto2",values:{EDITION_UNKNOWN:0,EDITION_LEGACY:900,EDITION_PROTO2:998,EDITION_PROTO3:999,EDITION_2023:1e3,EDITION_2024:1001,EDITION_1_TEST_ONLY:1,EDITION_2_TEST_ONLY:2,EDITION_99997_TEST_ONLY:99997,EDITION_99998_TEST_ONLY:99998,EDITION_99999_TEST_ONLY:99999,EDITION_MAX:2147483647}},FileDescriptorProto:{edition:"proto2",fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10},weakDependency:{rule:"repeated",type:"int32",id:11},optionDependency:{rule:"repeated",type:"string",id:15},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12},edition:{type:"Edition",id:14}}},DescriptorProto:{edition:"proto2",fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10},visibility:{type:"SymbolVisibility",id:11}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2},options:{type:"ExtensionRangeOptions",id:3}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},ExtensionRangeOptions:{edition:"proto2",fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999},declaration:{rule:"repeated",type:"Declaration",id:2,options:{retention:"RETENTION_SOURCE"}},features:{type:"FeatureSet",id:50},verification:{type:"VerificationState",id:3,options:{default:"UNVERIFIED",retention:"RETENTION_SOURCE"}}},extensions:[[1e3,536870911]],nested:{Declaration:{fields:{number:{type:"int32",id:1},fullName:{type:"string",id:2},type:{type:"string",id:3},reserved:{type:"bool",id:5},repeated:{type:"bool",id:6}},reserved:[[4,4]]},VerificationState:{values:{DECLARATION:0,UNVERIFIED:1}}}},FieldDescriptorProto:{edition:"proto2",fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8},proto3Optional:{type:"bool",id:17}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REPEATED:3,LABEL_REQUIRED:2}}}},OneofDescriptorProto:{edition:"proto2",fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{edition:"proto2",fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3},reservedRange:{rule:"repeated",type:"EnumReservedRange",id:4},reservedName:{rule:"repeated",type:"string",id:5},visibility:{type:"SymbolVisibility",id:6}},nested:{EnumReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},EnumValueDescriptorProto:{edition:"proto2",fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{edition:"proto2",fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{edition:"proto2",fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{edition:"proto2",fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31,options:{default:!0}},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},swiftPrefix:{type:"string",id:39},phpClassPrefix:{type:"string",id:40},phpNamespace:{type:"string",id:41},phpMetadataNamespace:{type:"string",id:44},rubyPackage:{type:"string",id:45},features:{type:"FeatureSet",id:50},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[42,42],[38,38],"php_generic_services"],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{edition:"proto2",fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},deprecatedLegacyJsonFieldConflicts:{type:"bool",id:11,options:{deprecated:!0}},features:{type:"FeatureSet",id:12},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4],[5,5],[6,6],[8,8],[9,9]]},FieldOptions:{edition:"proto2",fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},unverifiedLazy:{type:"bool",id:15},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10,options:{deprecated:!0}},debugRedact:{type:"bool",id:16},retention:{type:"OptionRetention",id:17},targets:{rule:"repeated",type:"OptionTargetType",id:19},editionDefaults:{rule:"repeated",type:"EditionDefault",id:20},features:{type:"FeatureSet",id:21},featureSupport:{type:"FeatureSupport",id:22},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4],[18,18]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}},OptionRetention:{values:{RETENTION_UNKNOWN:0,RETENTION_RUNTIME:1,RETENTION_SOURCE:2}},OptionTargetType:{values:{TARGET_TYPE_UNKNOWN:0,TARGET_TYPE_FILE:1,TARGET_TYPE_EXTENSION_RANGE:2,TARGET_TYPE_MESSAGE:3,TARGET_TYPE_FIELD:4,TARGET_TYPE_ONEOF:5,TARGET_TYPE_ENUM:6,TARGET_TYPE_ENUM_ENTRY:7,TARGET_TYPE_SERVICE:8,TARGET_TYPE_METHOD:9}},EditionDefault:{fields:{edition:{type:"Edition",id:3},value:{type:"string",id:2}}},FeatureSupport:{fields:{editionIntroduced:{type:"Edition",id:1},editionDeprecated:{type:"Edition",id:2},deprecationWarning:{type:"string",id:3},editionRemoved:{type:"Edition",id:4}}}}},OneofOptions:{edition:"proto2",fields:{features:{type:"FeatureSet",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{edition:"proto2",fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},deprecatedLegacyJsonFieldConflicts:{type:"bool",id:6,options:{deprecated:!0}},features:{type:"FeatureSet",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[5,5]]},EnumValueOptions:{edition:"proto2",fields:{deprecated:{type:"bool",id:1},features:{type:"FeatureSet",id:2},debugRedact:{type:"bool",id:3},featureSupport:{type:"FieldOptions.FeatureSupport",id:4},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{edition:"proto2",fields:{features:{type:"FeatureSet",id:34},deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{edition:"proto2",fields:{deprecated:{type:"bool",id:33},idempotencyLevel:{type:"IdempotencyLevel",id:34,options:{default:"IDEMPOTENCY_UNKNOWN"}},features:{type:"FeatureSet",id:35},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],nested:{IdempotencyLevel:{values:{IDEMPOTENCY_UNKNOWN:0,NO_SIDE_EFFECTS:1,IDEMPOTENT:2}}}},UninterpretedOption:{edition:"proto2",fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},FeatureSet:{edition:"proto2",fields:{fieldPresence:{type:"FieldPresence",id:1,options:{retention:"RETENTION_RUNTIME",targets:"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_2023","edition_defaults.value":"EXPLICIT"}},enumType:{type:"EnumType",id:2,options:{retention:"RETENTION_RUNTIME",targets:"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"OPEN"}},repeatedFieldEncoding:{type:"RepeatedFieldEncoding",id:3,options:{retention:"RETENTION_RUNTIME",targets:"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"PACKED"}},utf8Validation:{type:"Utf8Validation",id:4,options:{retention:"RETENTION_RUNTIME",targets:"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"VERIFY"}},messageEncoding:{type:"MessageEncoding",id:5,options:{retention:"RETENTION_RUNTIME",targets:"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_LEGACY","edition_defaults.value":"LENGTH_PREFIXED"}},jsonFormat:{type:"JsonFormat",id:6,options:{retention:"RETENTION_RUNTIME",targets:"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"ALLOW"}},enforceNamingStyle:{type:"EnforceNamingStyle",id:7,options:{retention:"RETENTION_SOURCE",targets:"TARGET_TYPE_METHOD","feature_support.edition_introduced":"EDITION_2024","edition_defaults.edition":"EDITION_2024","edition_defaults.value":"STYLE2024"}},defaultSymbolVisibility:{type:"VisibilityFeature.DefaultSymbolVisibility",id:8,options:{retention:"RETENTION_SOURCE",targets:"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2024","edition_defaults.edition":"EDITION_2024","edition_defaults.value":"EXPORT_TOP_LEVEL"}}},extensions:[[1e3,9994],[9995,9999],[1e4,1e4]],reserved:[[999,999]],nested:{FieldPresence:{values:{FIELD_PRESENCE_UNKNOWN:0,EXPLICIT:1,IMPLICIT:2,LEGACY_REQUIRED:3}},EnumType:{values:{ENUM_TYPE_UNKNOWN:0,OPEN:1,CLOSED:2}},RepeatedFieldEncoding:{values:{REPEATED_FIELD_ENCODING_UNKNOWN:0,PACKED:1,EXPANDED:2}},Utf8Validation:{values:{UTF8_VALIDATION_UNKNOWN:0,VERIFY:2,NONE:3}},MessageEncoding:{values:{MESSAGE_ENCODING_UNKNOWN:0,LENGTH_PREFIXED:1,DELIMITED:2}},JsonFormat:{values:{JSON_FORMAT_UNKNOWN:0,ALLOW:1,LEGACY_BEST_EFFORT:2}},EnforceNamingStyle:{values:{ENFORCE_NAMING_STYLE_UNKNOWN:0,STYLE2024:1,STYLE_LEGACY:2}},VisibilityFeature:{fields:{},reserved:[[1,536870911]],nested:{DefaultSymbolVisibility:{values:{DEFAULT_SYMBOL_VISIBILITY_UNKNOWN:0,EXPORT_ALL:1,EXPORT_TOP_LEVEL:2,LOCAL_ALL:3,STRICT:4}}}}}},FeatureSetDefaults:{edition:"proto2",fields:{defaults:{rule:"repeated",type:"FeatureSetEditionDefault",id:1},minimumEdition:{type:"Edition",id:4},maximumEdition:{type:"Edition",id:5}},nested:{FeatureSetEditionDefault:{fields:{edition:{type:"Edition",id:3},overridableFeatures:{type:"FeatureSet",id:4},fixedFeatures:{type:"FeatureSet",id:5}},reserved:[[1,1],[2,2],"features"]}}},SourceCodeInfo:{edition:"proto2",fields:{location:{rule:"repeated",type:"Location",id:1}},extensions:[[536e6,536e6]],nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1,options:{packed:!0}},span:{rule:"repeated",type:"int32",id:2,options:{packed:!0}},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{edition:"proto2",fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1,options:{packed:!0}},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4},semantic:{type:"Semantic",id:5}},nested:{Semantic:{values:{NONE:0,SET:1,ALIAS:2}}}}}},SymbolVisibility:{edition:"proto2",values:{VISIBILITY_UNSET:0,VISIBILITY_LOCAL:1,VISIBILITY_EXPORT:2}}}}}}},Cl={nested:kl};(function(t,s){var r=_r;t.exports=s=r.descriptor=r.Root.fromJSON(Cl).lookup(".google.protobuf");var n=r.Namespace,a=r.Root,i=r.Enum,o=r.Type,l=r.Field,c=r.MapField,d=r.OneOf,x=r.Service,h=r.Method;a.fromDescriptor=function(m){typeof m.length=="number"&&(m=s.FileDescriptorSet.decode(m));var N=new a;if(m.file)for(var w,M,k=0,O;k<m.file.length;++k){M=N,(w=m.file[k]).package&&w.package.length&&(M=N.define(w.package));var Q=U(w);if(w.name&&w.name.length&&N.files.push(M.filename=w.name),w.messageType)for(O=0;O<w.messageType.length;++O)M.add(o.fromDescriptor(w.messageType[O],Q));if(w.enumType)for(O=0;O<w.enumType.length;++O)M.add(i.fromDescriptor(w.enumType[O],Q));if(w.extension)for(O=0;O<w.extension.length;++O)M.add(l.fromDescriptor(w.extension[O],Q));if(w.service)for(O=0;O<w.service.length;++O)M.add(x.fromDescriptor(w.service[O],Q));var Y=P(w.options,s.FileOptions);if(Y){var X=Object.keys(Y);for(O=0;O<X.length;++O)M.setOption(X[O],Y[X[O]])}}return N.resolveAll()},a.prototype.toDescriptor=function(m){var N=s.FileDescriptorSet.create();return j(this,N.file,m),N};function j(E,m,N){var w=s.FileDescriptorProto.create({name:E.filename||(E.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});L(N,w),E instanceof a||(w.package=E.fullName.substring(1));for(var M=0,k;M<E.nestedArray.length;++M)(k=E._nestedArray[M])instanceof o?w.messageType.push(k.toDescriptor(N)):k instanceof i?w.enumType.push(k.toDescriptor()):k instanceof l?w.extension.push(k.toDescriptor(N)):k instanceof x?w.service.push(k.toDescriptor()):k instanceof n&&j(k,m,N);w.options=G(E.options,s.FileOptions),w.messageType.length+w.enumType.length+w.extension.length+w.service.length&&m.push(w)}var y=0;o.fromDescriptor=function(m,N,w){typeof m.length=="number"&&(m=s.DescriptorProto.decode(m));var M=new o(m.name.length?m.name:"Type"+y++,P(m.options,s.MessageOptions)),k;if(w||(M._edition=N),m.oneofDecl)for(k=0;k<m.oneofDecl.length;++k)M.add(d.fromDescriptor(m.oneofDecl[k]));if(m.field)for(k=0;k<m.field.length;++k){var O=l.fromDescriptor(m.field[k],N,!0);M.add(O),m.field[k].hasOwnProperty("oneofIndex")&&M.oneofsArray[m.field[k].oneofIndex].add(O)}if(m.extension)for(k=0;k<m.extension.length;++k)M.add(l.fromDescriptor(m.extension[k],N,!0));if(m.nestedType)for(k=0;k<m.nestedType.length;++k)M.add(o.fromDescriptor(m.nestedType[k],N,!0)),m.nestedType[k].options&&m.nestedType[k].options.mapEntry&&M.setOption("map_entry",!0);if(m.enumType)for(k=0;k<m.enumType.length;++k)M.add(i.fromDescriptor(m.enumType[k],N,!0));if(m.extensionRange&&m.extensionRange.length)for(M.extensions=[],k=0;k<m.extensionRange.length;++k)M.extensions.push([m.extensionRange[k].start,m.extensionRange[k].end]);if(m.reservedRange&&m.reservedRange.length||m.reservedName&&m.reservedName.length){if(M.reserved=[],m.reservedRange)for(k=0;k<m.reservedRange.length;++k)M.reserved.push([m.reservedRange[k].start,m.reservedRange[k].end]);if(m.reservedName)for(k=0;k<m.reservedName.length;++k)M.reserved.push(m.reservedName[k])}return M},o.prototype.toDescriptor=function(m){var N=s.DescriptorProto.create({name:this.name}),w;for(w=0;w<this.fieldsArray.length;++w){var M;if(N.field.push(M=this._fieldsArray[w].toDescriptor(m)),this._fieldsArray[w]instanceof c){var k=H(this._fieldsArray[w].keyType,this._fieldsArray[w].resolvedKeyType,!1),O=H(this._fieldsArray[w].type,this._fieldsArray[w].resolvedType,!1),Q=O===11||O===14?this._fieldsArray[w].resolvedType&&C(this.parent,this._fieldsArray[w].resolvedType)||this._fieldsArray[w].type:void 0;N.nestedType.push(s.DescriptorProto.create({name:M.typeName,field:[s.FieldDescriptorProto.create({name:"key",number:1,label:1,type:k}),s.FieldDescriptorProto.create({name:"value",number:2,label:1,type:O,typeName:Q})],options:s.MessageOptions.create({mapEntry:!0})}))}}for(w=0;w<this.oneofsArray.length;++w)N.oneofDecl.push(this._oneofsArray[w].toDescriptor());for(w=0;w<this.nestedArray.length;++w)this._nestedArray[w]instanceof l?N.field.push(this._nestedArray[w].toDescriptor(m)):this._nestedArray[w]instanceof o?N.nestedType.push(this._nestedArray[w].toDescriptor(m)):this._nestedArray[w]instanceof i&&N.enumType.push(this._nestedArray[w].toDescriptor());if(this.extensions)for(w=0;w<this.extensions.length;++w)N.extensionRange.push(s.DescriptorProto.ExtensionRange.create({start:this.extensions[w][0],end:this.extensions[w][1]}));if(this.reserved)for(w=0;w<this.reserved.length;++w)typeof this.reserved[w]=="string"?N.reservedName.push(this.reserved[w]):N.reservedRange.push(s.DescriptorProto.ReservedRange.create({start:this.reserved[w][0],end:this.reserved[w][1]}));return N.options=G(this.options,s.MessageOptions),N};var p=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;l.fromDescriptor=function(m,N,w){if(typeof m.length=="number"&&(m=s.DescriptorProto.decode(m)),typeof m.number!="number")throw Error("missing field id");var M;m.typeName&&m.typeName.length?M=m.typeName:M=T(m.type);var k;switch(m.label){case 1:k=void 0;break;case 2:k="required";break;case 3:k="repeated";break;default:throw Error("illegal label: "+m.label)}var O=m.extendee;m.extendee!==void 0&&(O=O.length?O:void 0);var Q=new l(m.name.length?m.name:"field"+m.number,m.number,M,k,O);if(w||(Q._edition=N),Q.options=P(m.options,s.FieldOptions),m.proto3_optional&&(Q.options.proto3_optional=!0),m.defaultValue&&m.defaultValue.length){var Y=m.defaultValue;switch(Y){case"true":case"TRUE":Y=!0;break;case"false":case"FALSE":Y=!1;break;default:var X=p.exec(Y);X&&(Y=parseInt(Y));break}Q.setOption("default",Y)}return W(m.type)&&(N==="proto3"?m.options&&!m.options.packed&&Q.setOption("packed",!1):(!N||N==="proto2")&&m.options&&m.options.packed&&Q.setOption("packed",!0)),Q},l.prototype.toDescriptor=function(m){var N=s.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)N.type=11,N.typeName=r.util.ucFirst(this.name),N.label=3;else{switch(N.type=H(this.type,this.resolve().resolvedType,this.delimited)){case 10:case 11:case 14:N.typeName=this.resolvedType?C(this.parent,this.resolvedType):this.type;break}this.rule==="repeated"?N.label=3:this.required&&m==="proto2"?N.label=2:N.label=1}if(N.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(N.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(N.options=G(this.options,s.FieldOptions),this.options.default!=null&&(N.defaultValue=String(this.options.default)),this.options.proto3_optional&&(N.proto3_optional=!0)),m==="proto3"?this.packed||((N.options||(N.options=s.FieldOptions.create())).packed=!1):(!m||m==="proto2")&&this.packed&&((N.options||(N.options=s.FieldOptions.create())).packed=!0),N};var g=0;i.fromDescriptor=function(m,N,w){typeof m.length=="number"&&(m=s.EnumDescriptorProto.decode(m));var M={};if(m.value)for(var k=0;k<m.value.length;++k){var O=m.value[k].name,Q=m.value[k].number||0;M[O&&O.length?O:"NAME"+Q]=Q}var Y=new i(m.name&&m.name.length?m.name:"Enum"+g++,M,P(m.options,s.EnumOptions));return w||(Y._edition=N),Y},i.prototype.toDescriptor=function(){for(var m=[],N=0,w=Object.keys(this.values);N<w.length;++N)m.push(s.EnumValueDescriptorProto.create({name:w[N],number:this.values[w[N]]}));return s.EnumDescriptorProto.create({name:this.name,value:m,options:G(this.options,s.EnumOptions)})};var v=0;d.fromDescriptor=function(m){return typeof m.length=="number"&&(m=s.OneofDescriptorProto.decode(m)),new d(m.name&&m.name.length?m.name:"oneof"+v++)},d.prototype.toDescriptor=function(){return s.OneofDescriptorProto.create({name:this.name})};var f=0;x.fromDescriptor=function(m,N,w){typeof m.length=="number"&&(m=s.ServiceDescriptorProto.decode(m));var M=new x(m.name&&m.name.length?m.name:"Service"+f++,P(m.options,s.ServiceOptions));if(w||(M._edition=N),m.method)for(var k=0;k<m.method.length;++k)M.add(h.fromDescriptor(m.method[k]));return M},x.prototype.toDescriptor=function(){for(var m=[],N=0;N<this.methodsArray.length;++N)m.push(this._methodsArray[N].toDescriptor());return s.ServiceDescriptorProto.create({name:this.name,method:m,options:G(this.options,s.ServiceOptions)})};var D=0;h.fromDescriptor=function(m){return typeof m.length=="number"&&(m=s.MethodDescriptorProto.decode(m)),new h(m.name&&m.name.length?m.name:"Method"+D++,"rpc",m.inputType,m.outputType,!!m.clientStreaming,!!m.serverStreaming,P(m.options,s.MethodOptions))},h.prototype.toDescriptor=function(){return s.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:G(this.options,s.MethodOptions)})};function T(E){switch(E){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+E)}function W(E){switch(E){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function H(E,m,N){switch(E){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(m instanceof i)return 14;if(m instanceof o)return N?10:11;throw Error("illegal type: "+E)}function z(E,m){for(var N={},w=0,M,k;w<m.fieldsArray.length;++w)if((k=(M=m._fieldsArray[w]).name)!=="uninterpretedOption"&&Object.prototype.hasOwnProperty.call(E,k)){var O=_(k);M.resolvedType instanceof o?N[O]=z(E[k],M.resolvedType):M.resolvedType instanceof i?N[O]=M.resolvedType.valuesById[E[k]]:N[O]=E[k]}return N}function P(E,m){if(E)return z(m.toObject(E),m)}function F(E,m){for(var N={},w=Object.keys(E),M=0;M<w.length;++M){var k=w[M],O=r.util.camelCase(k);if(Object.prototype.hasOwnProperty.call(m.fields,O)){var Q=m.fields[O];Q.resolvedType instanceof o?N[O]=F(E[k],Q.resolvedType):N[O]=E[k],Q.repeated&&!Array.isArray(N[O])&&(N[O]=[N[O]])}}return N}function G(E,m){if(E)return m.fromObject(F(E,m))}function C(E,m){var N=E.fullName.split("."),w=m.fullName.split("."),M=0,k=0,O=w.length-1;if(!(E instanceof a)&&m instanceof n)for(;M<N.length&&k<O&&N[M]===w[k];){var Q=m.lookup(N[M++],!0);if(Q!==null&&Q!==m)break;++k}else for(;M<N.length&&k<O&&N[M]===w[k];++M,++k);return w.slice(k).join(".")}function _(E){return E.substring(0,1)+E.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(m,N){return"_"+N.toLowerCase()})}function U(E){if(E.syntax==="editions")switch(E.edition){case s.Edition.EDITION_2023:return"2023";default:throw new Error("Unsupported edition "+E.edition)}return E.syntax==="proto3"?"proto3":"proto2"}function L(E,m){if(E)if(E==="proto2"||E==="proto3")m.syntax=E;else switch(m.syntax="editions",E){case"2023":m.edition=s.Edition.EDITION_2023;break;default:throw new Error("Unsupported edition "+E)}}})(Is,Is.exports);async function El(t){return new Promise((s,r)=>{const n=new FileReader;n.onload=async()=>{try{const a=n.result,i=new Uint8Array(a),o=He.Root.fromDescriptor(i),l=Lr(o);s({name:t.name,messageTypes:l,root:o,uploadedAt:new Date})}catch(a){r(new Error(`解析描述符文件失败: ${a instanceof Error?a.message:String(a)}`))}},n.onerror=()=>{r(new Error("读取文件失败"))},n.readAsArrayBuffer(t)})}async function Tl(t,s){const r=atob(t),n=new Uint8Array(r.length);for(let o=0;o<r.length;o++)n[o]=r.charCodeAt(o);const a=He.Root.fromDescriptor(n),i=Lr(a);return{name:s,messageTypes:i,root:a,uploadedAt:new Date}}function Lr(t){const s=[];function r(n,a){for(const i of n.nestedArray){const o=a?`${a}.${i.name}`:i.name;i instanceof He.Type?(s.push(o),r(i,o)):i instanceof He.Namespace&&r(i,o)}}return r(t,""),s.sort()}function Sl(t,s,r){try{const n=t.root.lookupType(s);let a;if(typeof r=="string"){const l=atob(r);a=new Uint8Array(l.length);for(let c=0;c<l.length;c++)a[c]=l.charCodeAt(c)}else a=r;const i=n.decode(a);return{success:!0,data:n.toObject(i,{longs:String,enums:String,bytes:String,defaults:!1,arrays:!0,objects:!0})}}catch(n){return{success:!1,error:n instanceof Error?n.message:String(n)}}}function Ls(t){try{let s;if(typeof t=="string"){const a=atob(t);s=new Uint8Array(a.length);for(let i=0;i<a.length;i++)s[i]=a.charCodeAt(i)}else s=t;const r=new He.Reader(s),n={};for(;r.pos<r.len;){const a=r.uint32(),i=a>>>3,o=a&7;let l;switch(o){case 0:l=r.int64().toString();break;case 1:l=r.fixed64().toString();break;case 2:const d=r.bytes();try{const x=new TextDecoder("utf-8",{fatal:!0}).decode(d);Il(x)?l=x:l=`[${d.length} bytes]`}catch{l=`[${d.length} bytes]`}break;case 5:l=r.fixed32();break;default:r.skipType(o);continue}const c=`field_${i}`;c in n?Array.isArray(n[c])?n[c].push(l):n[c]=[n[c],l]:n[c]=l}return Object.keys(n).length>0?n:null}catch{return null}}function Il(t){return/^[\x20-\x7E\u4E00-\u9FFF\u3000-\u303F\s]+$/.test(t)}function xt(t,s=0){const r="  ".repeat(s),n=[];for(const[a,i]of Object.entries(t))if(i!=null)if(Array.isArray(i)){if(i.length===0)continue;n.push(`${r}${a}: [`);for(const o of i)typeof o=="object"&&o!==null?(n.push(`${r}  {`),n.push(xt(o,s+2)),n.push(`${r}  }`)):n.push(`${r}  ${Ds(o)}`);n.push(`${r}]`)}else typeof i=="object"?(n.push(`${r}${a}: {`),n.push(xt(i,s+1)),n.push(`${r}}`)):n.push(`${r}${a}: ${Ds(i)}`);return n.join(`
`)}function Ds(t){if(typeof t=="string"){const s=Number(t);if(!isNaN(s)){if(s>1e12&&s<2e12)return`${t} (${new Date(s).toISOString()})`;if(s>1e9&&s<2e9)return`${t} (${new Date(s*1e3).toISOString()})`}return`"${t}"`}return String(t)}async function Ll(t){return new Promise((s,r)=>{const n=new FileReader;n.onload=()=>{const a=n.result,i=a.split(",")[1]||a;s(i)},n.onerror=r,n.readAsDataURL(t)})}const es=ae()(Bt((t,s)=>({descriptorMeta:[],activeDescriptors:new Map,columnConfigs:[],loading:!1,error:null,uploadDescriptor:async r=>{t({loading:!0,error:null});try{const n=await El(r),a=await Ll(r),i=s().descriptorMeta.findIndex(o=>o.name===n.name);t(o=>{const l=[...o.descriptorMeta],c={name:n.name,messageTypes:n.messageTypes,uploadedAt:n.uploadedAt.toISOString(),rawData:a};i>=0?l[i]=c:l.push(c);const d=new Map(o.activeDescriptors);return d.set(n.name,n),{descriptorMeta:l,activeDescriptors:d,loading:!1}})}catch(n){t({error:n instanceof Error?n.message:String(n),loading:!1})}},restoreDescriptor:async r=>{const{activeDescriptors:n,descriptorMeta:a}=s();if(n.has(r))return n.get(r);const i=a.find(o=>o.name===r);if(!i)return null;try{const o=await Tl(i.rawData,i.name);return t(l=>{const c=new Map(l.activeDescriptors);return c.set(r,o),{activeDescriptors:c}}),o}catch(o){return console.error("Failed to restore descriptor:",o),null}},removeDescriptor:r=>{t(n=>({descriptorMeta:n.descriptorMeta.filter(a=>a.name!==r),activeDescriptors:new Map([...n.activeDescriptors].filter(([a])=>a!==r)),columnConfigs:n.columnConfigs.filter(a=>a.descriptorName!==r)}))},addColumnConfig:r=>{t(n=>{const a=n.columnConfigs.findIndex(o=>o.dbId===r.dbId&&o.tableName===r.tableName&&o.columnName===r.columnName),i=[...n.columnConfigs];return a>=0?i[a]=r:i.push(r),{columnConfigs:i}})},removeColumnConfig:(r,n,a)=>{t(i=>({columnConfigs:i.columnConfigs.filter(o=>!(o.dbId===r&&o.tableName===n&&o.columnName===a))}))},getColumnConfig:(r,n,a)=>s().columnConfigs.find(i=>i.dbId===r&&i.tableName===n&&i.columnName===a)||null,decodeBlobData:async(r,n,a,i)=>{const o=s().getColumnConfig(r,n,a);if(!o)return{success:!1,error:"未配置 Protobuf 解析"};const l=await s().restoreDescriptor(o.descriptorName);return l?Sl(l,o.messageType,i):{success:!1,error:`描述符 "${o.descriptorName}" 未找到`}},getAvailableMessageTypes:()=>{const{descriptorMeta:r}=s(),n=[];for(const a of r)n.push(...a.messageTypes);return[...new Set(n)].sort()},clearAll:()=>{t({descriptorMeta:[],activeDescriptors:new Map,columnConfigs:[],error:null})}}),{name:"protobuf-store",partialize:t=>({descriptorMeta:t.descriptorMeta,columnConfigs:t.columnConfigs})}));function Dl({className:t,dbId:s,tableName:r,columns:n,onClose:a}){const{descriptorMeta:i,columnConfigs:o,loading:l,error:c,uploadDescriptor:d,removeDescriptor:x,addColumnConfig:h,removeColumnConfig:j,getColumnConfig:y}=es(),p=u.useRef(null),[g,v]=u.useState("descriptors"),[f,D]=u.useState(null),[T,W]=u.useState(""),[H,z]=u.useState(""),P=n.filter(L=>{var m;const E=(m=L.type)==null?void 0:m.toLowerCase();return E==="blob"||E===null||E===""}),F=u.useCallback(async L=>{var m;const E=(m=L.target.files)==null?void 0:m[0];E&&(await d(E),p.current&&(p.current.value=""))},[d]),G=u.useCallback(()=>{if(!s||!r||!f||!T||!H)return;h({dbId:s,tableName:r,columnName:f,messageType:H,descriptorName:T}),D(null),z("")},[s,r,f,T,H,h]),C=i.find(L=>L.name===T),_=(C==null?void 0:C.messageTypes)||[],U=o.filter(L=>L.dbId===s&&L.tableName===r);return e.jsxs("div",{className:b("bg-bg-dark rounded-lg border border-border shadow-lg",t),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{size:16,className:"text-purple-400"}),e.jsx("h3",{className:"font-medium text-text-primary text-sm",children:"Protobuf 配置"})]}),e.jsx("button",{onClick:a,className:"p-1 rounded hover:bg-bg-light text-text-muted hover:text-text-secondary transition-colors",children:"✕"})]}),e.jsxs("div",{className:"flex border-b border-border",children:[e.jsxs("button",{onClick:()=>v("descriptors"),className:b("flex-1 px-4 py-2 text-xs font-medium transition-colors",g==="descriptors"?"text-primary border-b-2 border-primary":"text-text-muted hover:text-text-secondary"),children:["描述符 (",i.length,")"]}),e.jsxs("button",{onClick:()=>v("columns"),className:b("flex-1 px-4 py-2 text-xs font-medium transition-colors",g==="columns"?"text-primary border-b-2 border-primary":"text-text-muted hover:text-text-secondary"),children:["列映射 (",U.length,")"]})]}),e.jsx("div",{className:"p-4",children:g==="descriptors"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("input",{ref:p,type:"file",accept:".desc,.bin",onChange:F,className:"hidden"}),e.jsx("button",{onClick:()=>{var L;return(L=p.current)==null?void 0:L.click()},disabled:l,className:"w-full px-4 py-2 bg-primary/20 text-primary rounded-lg text-sm font-medium hover:bg-primary/30 disabled:opacity-50 transition-colors flex items-center justify-center gap-2",children:l?"加载中...":e.jsxs(e.Fragment,{children:[e.jsx(Zn,{size:16})," 上传 .desc 文件"]})}),e.jsxs("p",{className:"text-xs text-text-muted mt-2",children:["使用 ",e.jsx("code",{className:"bg-bg-light px-1 rounded",children:"protoc --descriptor_set_out"})," 生成"]})]}),c&&e.jsx("div",{className:"px-3 py-2 bg-red-500/10 border border-red-500/20 rounded text-xs text-red-400",children:c}),i.length>0?e.jsx("div",{className:"space-y-2",children:i.map(L=>e.jsxs("div",{className:"p-3 bg-bg-light rounded-lg border border-border",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-mono text-sm text-text-primary truncate",children:L.name}),e.jsxs("div",{className:"text-xs text-text-muted mt-1",children:[L.messageTypes.length," 个消息类型"]}),e.jsx("div",{className:"text-2xs text-text-muted/50 mt-0.5",children:new Date(L.uploadedAt).toLocaleString()})]}),e.jsx("button",{onClick:()=>x(L.name),className:"p-1 rounded text-red-400 hover:bg-red-500/10 transition-colors",title:"删除",children:e.jsx(Ce,{size:14})})]}),e.jsx("div",{className:"mt-2 max-h-24 overflow-auto",children:e.jsxs("div",{className:"text-2xs font-mono text-text-muted space-y-0.5",children:[L.messageTypes.slice(0,10).map(E=>e.jsx("div",{className:"truncate",children:E},E)),L.messageTypes.length>10&&e.jsxs("div",{className:"text-text-muted/50",children:["... 还有 ",L.messageTypes.length-10," 个"]})]})})]},L.name))}):e.jsxs("div",{className:"text-center py-8 text-text-muted",children:[e.jsx("div",{className:"text-3xl mb-2 opacity-50",children:"📭"}),e.jsx("p",{className:"text-sm",children:"尚未上传描述符文件"})]})]}):e.jsx("div",{className:"space-y-4",children:s&&r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xs text-text-muted",children:["当前表: ",e.jsx("span",{className:"font-mono text-text-secondary",children:r})]}),U.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs font-medium text-text-muted",children:"已配置的列:"}),U.map(L=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-bg-light rounded border border-border",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-mono text-sm text-primary",children:L.columnName}),e.jsxs("div",{className:"text-xs text-text-muted truncate",children:["→ ",L.messageType]})]}),e.jsx("button",{onClick:()=>j(L.dbId,L.tableName,L.columnName),className:"p-1 rounded text-red-400 hover:bg-red-500/10 transition-colors",children:"✕"})]},L.columnName))]}),i.length>0&&P.length>0?e.jsxs("div",{className:"space-y-3 p-3 bg-bg-lighter rounded-lg border border-border",children:[e.jsx("div",{className:"text-xs font-medium text-text-muted",children:"添加配置:"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-2xs text-text-muted mb-1",children:"BLOB 列"}),e.jsxs("select",{value:f||"",onChange:L=>D(L.target.value||null),className:"w-full px-2 py-1.5 bg-bg-dark border border-border rounded text-sm text-text-primary focus:outline-none focus:border-primary",children:[e.jsx("option",{value:"",children:"选择列..."}),P.map(L=>{const E=y(s,r,L.name);return e.jsxs("option",{value:L.name,disabled:!!E,children:[L.name," ",E?"(已配置)":""]},L.name)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-2xs text-text-muted mb-1",children:"描述符"}),e.jsxs("select",{value:T,onChange:L=>{W(L.target.value),z("")},className:"w-full px-2 py-1.5 bg-bg-dark border border-border rounded text-sm text-text-primary focus:outline-none focus:border-primary",children:[e.jsx("option",{value:"",children:"选择描述符..."}),i.map(L=>e.jsx("option",{value:L.name,children:L.name},L.name))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-2xs text-text-muted mb-1",children:"消息类型"}),e.jsxs("select",{value:H,onChange:L=>z(L.target.value),disabled:!T,className:"w-full px-2 py-1.5 bg-bg-dark border border-border rounded text-sm text-text-primary focus:outline-none focus:border-primary disabled:opacity-50",children:[e.jsx("option",{value:"",children:"选择消息类型..."}),_.map(L=>e.jsx("option",{value:L,children:L},L))]})]}),e.jsx("button",{onClick:G,disabled:!f||!T||!H,className:"w-full px-3 py-1.5 bg-primary text-white rounded text-sm font-medium hover:bg-primary/90 disabled:opacity-50 transition-colors",children:"添加映射"})]}):i.length===0?e.jsx("div",{className:"text-center py-4 text-text-muted text-xs",children:"请先上传描述符文件"}):e.jsx("div",{className:"text-center py-4 text-text-muted text-xs",children:"当前表没有 BLOB 类型的列"})]}):e.jsxs("div",{className:"text-center py-8 text-text-muted",children:[e.jsx("div",{className:"text-3xl mb-2 opacity-50",children:"👈"}),e.jsx("p",{className:"text-sm",children:"请先选择一个表"})]})})})]})}function Ml({value:t,dbId:s,tableName:r,columnName:n,maxWidth:a=300}){const{getColumnConfig:i,decodeBlobData:o}=es(),[l,c]=u.useState(!1),[d,x]=u.useState("decoded"),[h,j]=u.useState(null),[y,p]=u.useState(null),[g,v]=u.useState(!1),f=i(s,r,n);u.useEffect(()=>{if(!(!t||!l))if(v(!0),p(null),f)o(s,r,n,t).then(H=>{v(!1),H.success?(j(H.data),p(null)):(j(null),p(H.error))});else{const H=Ls(t);j(H),p(H?null:"无法自动解析"),v(!1)}},[t,l,f,s,r,n,o]);const D=u.useMemo(()=>{try{return atob(t).length}catch{return 0}},[t]),T=u.useMemo(()=>{try{const H=atob(t),z=[];for(let P=0;P<Math.min(H.length,256);P++)z.push(H.charCodeAt(P).toString(16).padStart(2,"0"));return z}catch{return[]}},[t]),W=u.useMemo(()=>d!=="wire"||!l?null:Ls(t),[t,d,l]);return l?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:()=>c(!1),children:e.jsxs("div",{className:"bg-bg-dark rounded-lg border border-border shadow-2xl max-w-2xl w-full max-h-[80vh] flex flex-col",style:{maxWidth:a},onClick:H=>H.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{size:16,className:"text-purple-400"}),e.jsx("span",{className:"font-mono text-sm text-text-primary",children:n}),e.jsxs("span",{className:"text-xs text-text-muted",children:["(",D," bytes)"]}),f&&e.jsx("span",{className:"text-xs text-green-400 bg-green-400/10 px-2 py-0.5 rounded",children:f.messageType})]}),e.jsx("button",{onClick:()=>c(!1),className:"p-1 rounded hover:bg-bg-light text-text-muted hover:text-text-secondary transition-colors",children:"✕"})]}),e.jsxs("div",{className:"flex gap-1 px-4 py-2 border-b border-border",children:[e.jsx("button",{onClick:()=>x("decoded"),className:b("px-3 py-1 text-xs rounded transition-colors",d==="decoded"?"bg-primary/20 text-primary":"text-text-muted hover:text-text-secondary hover:bg-bg-light"),children:f?"Schema 解码":"自动解析"}),e.jsx("button",{onClick:()=>x("wire"),className:b("px-3 py-1 text-xs rounded transition-colors",d==="wire"?"bg-primary/20 text-primary":"text-text-muted hover:text-text-secondary hover:bg-bg-light"),children:"Wire Format"}),e.jsx("button",{onClick:()=>x("hex"),className:b("px-3 py-1 text-xs rounded transition-colors",d==="hex"?"bg-primary/20 text-primary":"text-text-muted hover:text-text-secondary hover:bg-bg-light"),children:"Hex"})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:g?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin w-6 h-6 border-2 border-primary border-t-transparent rounded-full"})}):d==="decoded"?h?e.jsx("pre",{className:"text-xs font-mono text-text-secondary whitespace-pre-wrap",children:xt(h)}):y?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-yellow-400 mb-2 flex justify-center",children:e.jsx(Re,{size:24})}),e.jsx("p",{className:"text-sm text-text-muted",children:y}),!f&&e.jsx("p",{className:"text-xs text-text-muted/50 mt-2",children:"配置 Protobuf Schema 以获得更好的解析结果"})]}):null:d==="wire"?W?e.jsx("pre",{className:"text-xs font-mono text-text-secondary whitespace-pre-wrap",children:xt(W)}):e.jsx("div",{className:"text-center py-8 text-text-muted",children:"无法解析 Wire Format"}):e.jsxs("div",{className:"font-mono text-xs",children:[e.jsxs("div",{className:"flex flex-wrap gap-1",children:[T.map((H,z)=>e.jsx("span",{className:b("px-1 py-0.5 rounded",z%16<8?"bg-bg-light":"bg-bg-lighter"),children:H},z)),D>256&&e.jsxs("span",{className:"text-text-muted px-2",children:["... 还有 ",D-256," bytes"]})]}),e.jsxs("div",{className:"mt-4 text-text-muted",children:["共 ",D," bytes"]})]})}),!f&&d==="decoded"&&e.jsx("div",{className:"px-4 py-2 border-t border-border text-xs text-text-muted bg-bg-darker",children:"💡 提示：上传 .desc 文件并配置列映射可获得精确的解析结果"})]})}):e.jsxs("button",{onClick:()=>c(!0),className:"flex items-center gap-1 text-xs text-purple-400 hover:text-purple-300 transition-colors",title:"点击展开",children:[e.jsx(pe,{size:14,className:"opacity-70"}),e.jsx("span",{className:"font-mono",children:f?`[${f.messageType.split(".").pop()}]`:`[BLOB ${D}B]`}),f&&e.jsx("span",{className:"text-green-400 text-2xs",children:"✓"})]})}function Rl(t){if(!t||typeof t!="string"||t.length<4||t.length%4!==0||!/^[A-Za-z0-9+/]+=*$/.test(t))return!1;try{const r=atob(t);let n=0;for(let a=0;a<Math.min(r.length,100);a++){const i=r.charCodeAt(a);(i<32||i>126)&&n++}return n/Math.min(r.length,100)>.3}catch{return!1}}function Xe({isLoading:t,text:s="刷新中..."}){return t?e.jsx("div",{className:b("absolute inset-0 z-50 flex items-center justify-center","bg-bg-dark/60 backdrop-blur-sm","animate-fadeIn"),children:e.jsxs("div",{className:"flex items-center gap-3 px-5 py-3 rounded-lg bg-bg-dark/90 border border-border shadow-lg",children:[e.jsxs("div",{className:"relative w-5 h-5",children:[e.jsx("div",{className:"absolute inset-0 border-2 border-primary/30 rounded-full"}),e.jsx("div",{className:"absolute inset-0 border-2 border-transparent border-t-primary rounded-full animate-spin"})]}),e.jsx("span",{className:"text-sm font-medium text-text-secondary",children:s})]})}):null}function Ol({deviceId:t}){var Ze;const{databases:s,dbLoading:r,dbError:n,selectedDb:a,selectedTable:i,tables:o,tablesLoading:l,schema:c,showSchema:d,tableData:x,dataLoading:h,dataError:j,page:y,pageSize:p,orderBy:g,ascending:v,queryMode:f,queryInput:D,queryResult:T,queryLoading:W,queryError:H,dbSortOrder:z,dbSortAscending:P,loadDatabases:F,loadTables:G,loadSchema:C,loadTableData:_,selectDb:U,selectTable:L,setShowSchema:E,setSortAndReload:m,setPageAndReload:N,setQueryMode:w,setQueryInput:M,executeQuery:k,setDbSortOrder:O,toggleDbSortDirection:Q,getSortedDatabases:Y}=Nl(),{descriptorMeta:X,getColumnConfig:I}=es(),[V,B]=u.useState(!1);u.useEffect(()=>{s.length===0&&F(t)},[t,s.length,F]),u.useEffect(()=>{a&&o.length===0&&G(t,a)},[t,a,o.length,G]),u.useEffect(()=>{a&&i&&!x&&(C(t,a,i),_(t,a,i))},[t,a,i,x,C,_]);const ee=u.useCallback(R=>{U(R),G(t,R)},[U,G,t]),$=u.useCallback(R=>{L(R),a&&(C(t,a,R),_(t,a,R))},[L,a,t,C,_]),oe=u.useCallback(R=>{m(t,R)},[m,t]),le=u.useCallback(R=>{N(t,R)},[N,t]),te=R=>R===null?"-":R<1024?`${R} B`:R<1024*1024?`${(R/1024).toFixed(1)} KB`:`${(R/(1024*1024)).toFixed(1)} MB`,vt=R=>{switch(R){case"log":return e.jsx(je,{size:16});case"cache":return e.jsx(Xs,{size:16});default:return e.jsx(qe,{size:16})}};return r?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin w-8 h-8 border-2 border-primary border-t-transparent rounded-full"})}):n?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted",children:[e.jsx(Re,{size:36,className:"mb-3 opacity-50"}),e.jsx("p",{className:"text-sm mb-3",children:n}),e.jsx("button",{onClick:()=>F(t),className:"px-4 py-2 bg-primary/20 text-primary rounded-lg hover:bg-primary/30 transition-colors",children:"重试"})]}):s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted",children:[e.jsx(qe,{size:36,className:"mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:"没有注册的数据库"}),e.jsx("p",{className:"text-xs mt-2 text-text-muted",children:"在 iOS App 中使用 DatabaseRegistry.shared.register() 注册数据库"})]}):e.jsxs("div",{className:"flex h-full",children:[e.jsxs("div",{className:"w-64 flex-shrink-0 border-r border-border bg-bg-dark flex flex-col",children:[e.jsxs("div",{className:"p-3 border-b border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-xs font-medium text-text-muted uppercase tracking-wider",children:"数据库"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("select",{value:z,onChange:R=>O(R.target.value),className:"text-2xs bg-bg-light border border-border rounded px-1.5 py-0.5 text-text-secondary focus:outline-none focus:border-primary",title:"排序方式",children:[e.jsx("option",{value:"name",children:"名称"}),e.jsx("option",{value:"size",children:"大小"}),e.jsx("option",{value:"tableCount",children:"表数"})]}),e.jsx("button",{onClick:Q,className:"p-1 rounded hover:bg-bg-light text-text-muted hover:text-text-secondary transition-colors",title:P?"升序":"降序",children:P?e.jsx(Ye,{size:12}):e.jsx(Ge,{size:12})})]})]}),e.jsx("div",{className:"space-y-1",children:Y().map(R=>e.jsx("button",{onClick:()=>ee(R.descriptor.id),className:b("w-full px-3 py-2 rounded-lg text-left text-xs transition-all",a===R.descriptor.id?"bg-primary text-white shadow-sm shadow-primary/30":"text-text-secondary hover:bg-bg-light"),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:vt(R.descriptor.kind)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:R.descriptor.name}),e.jsxs("div",{className:b("text-2xs",a===R.descriptor.id?"text-white/70":"text-text-muted"),children:[R.tableCount," 表 • ",te(R.fileSizeBytes)]})]}),R.descriptor.isSensitive&&e.jsx("span",{className:"text-yellow-500",title:"敏感数据",children:e.jsx(Qn,{size:12})})]})},R.descriptor.id))})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h3",{className:"text-xs font-medium text-text-muted uppercase tracking-wider",children:["表 ",o.length>0&&`(${o.length})`]}),a&&e.jsx("button",{onClick:()=>w(!f),className:b("px-2 py-1 rounded text-xs transition-colors",f?"bg-accent-blue/20 text-accent-blue":"text-text-muted hover:text-text-secondary hover:bg-bg-light"),title:"SQL 查询",children:"</>"})]}),l?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin w-5 h-5 border-2 border-primary border-t-transparent rounded-full"})}):a?e.jsx("div",{className:"space-y-1",children:o.map(R=>e.jsx("button",{onClick:()=>$(R.name),className:b("w-full px-3 py-2 rounded-lg text-left text-xs transition-all",i===R.name?"bg-accent-blue text-white shadow-sm shadow-accent-blue/30":"text-text-secondary hover:bg-bg-light"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-mono truncate",children:R.name}),e.jsx("span",{className:b("tabular-nums",i===R.name?"text-white/70":"text-text-muted"),children:R.rowCount!==null?R.rowCount.toLocaleString():"?"})]})},R.name))}):e.jsx("p",{className:"text-xs text-text-muted text-center py-4",children:"请先选择数据库"})]})]}),e.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:f?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 border-b border-border bg-bg-dark/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xs text-text-muted",children:"SQL 查询"}),e.jsx("span",{className:"text-xs text-text-muted/50",children:"（仅支持 SELECT）"})]}),e.jsx("textarea",{value:D,onChange:R=>M(R.target.value),placeholder:"SELECT * FROM table_name LIMIT 100",className:"w-full h-24 px-3 py-2 bg-bg-light border border-border rounded-lg text-sm font-mono text-text-primary placeholder:text-text-muted resize-none focus:outline-none focus:border-primary/50",onKeyDown:R=>{(R.metaKey||R.ctrlKey)&&R.key==="Enter"&&k(t)}}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-xs text-text-muted",children:T&&e.jsxs(e.Fragment,{children:[T.rowCount," 行 • ",T.executionTimeMs.toFixed(2)," ms"]})}),e.jsx("button",{onClick:()=>k(t),disabled:W||!D.trim(),className:"px-4 py-1.5 bg-primary text-white rounded text-xs font-medium hover:bg-primary/90 disabled:opacity-50 transition-colors",children:W?"执行中...":"执行 (⌘↵)"})]}),H&&e.jsx("div",{className:"mt-2 px-3 py-2 bg-red-500/10 border border-red-500/20 rounded text-xs text-red-400",children:H})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:W?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin w-6 h-6 border-2 border-primary border-t-transparent rounded-full"})}):T?e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"sticky top-0 bg-bg-dark",children:e.jsx("tr",{children:T.columns.map(R=>e.jsx("th",{className:"px-3 py-2 text-left font-medium text-text-muted border-b border-border",children:R.name},R.name))})}),e.jsx("tbody",{className:"font-mono",children:T.rows.map((R,Fe)=>e.jsx("tr",{className:"border-b border-border/30 hover:bg-bg-light/30 transition-colors",children:T.columns.map(A=>e.jsx("td",{className:"px-3 py-2 text-text-secondary max-w-xs truncate",title:R.values[A.name]??"",children:R.values[A.name]===null?e.jsx("span",{className:"text-text-muted italic",children:"NULL"}):R.values[A.name]},A.name))},Fe))})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-text-muted",children:e.jsxs("div",{className:"text-center flex flex-col items-center",children:[e.jsx(Me,{size:36,className:"mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:"输入 SQL 查询语句并执行"})]})})})]}):i?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-4 py-2 border-b border-border bg-bg-dark/50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"font-mono text-sm text-text-primary",children:i}),x&&e.jsxs("span",{className:"text-xs text-text-muted",children:[((Ze=x.totalRows)==null?void 0:Ze.toLocaleString())??"?"," 行"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>B(!V),className:b("px-3 py-1.5 rounded text-xs transition-colors flex items-center gap-1 whitespace-nowrap",V?"bg-purple-500/20 text-purple-400":X.length>0?"bg-purple-500/10 text-purple-400 hover:bg-purple-500/20":"bg-bg-light text-text-secondary hover:bg-bg-lighter"),title:"Protobuf 配置",children:[e.jsx(pe,{size:12})," Protobuf ",X.length>0&&`(${X.length})`]}),e.jsxs("button",{onClick:()=>E(!d),className:b("px-3 py-1.5 rounded text-xs transition-colors flex items-center gap-1",d?"bg-primary/20 text-primary":"bg-bg-light text-text-secondary hover:bg-bg-lighter"),children:[e.jsx(sr,{size:12})," Schema"]}),e.jsxs("button",{onClick:()=>a&&i&&_(t,a,i),disabled:h,className:"px-3 py-1.5 bg-bg-light text-text-secondary rounded text-xs hover:bg-bg-lighter transition-colors disabled:opacity-50 flex items-center gap-1",children:[e.jsx(ft,{size:12,className:h?"animate-spin":""})," 刷新"]})]})]}),V&&e.jsx("div",{className:"px-4 py-3 border-b border-border bg-bg-dark/30",children:e.jsx(Dl,{dbId:a,tableName:i,columns:c.map(R=>({name:R.name,type:R.type})),onClose:()=>B(!1)})}),d&&c.length>0&&e.jsx("div",{className:"px-4 py-3 border-b border-border bg-bg-dark/30",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-text-muted",children:[e.jsx("th",{className:"pb-2 font-medium",children:"列名"}),e.jsx("th",{className:"pb-2 font-medium",children:"类型"}),e.jsx("th",{className:"pb-2 font-medium",children:"主键"}),e.jsx("th",{className:"pb-2 font-medium",children:"非空"}),e.jsx("th",{className:"pb-2 font-medium",children:"默认值"})]})}),e.jsx("tbody",{className:"font-mono",children:c.map(R=>e.jsxs("tr",{className:"border-t border-border/30",children:[e.jsx("td",{className:"py-1.5 text-primary",children:R.name}),e.jsx("td",{className:"py-1.5 text-text-secondary",children:R.type||"-"}),e.jsx("td",{className:"py-1.5",children:R.primaryKey?"✓":""}),e.jsx("td",{className:"py-1.5",children:R.notNull?"✓":""}),e.jsx("td",{className:"py-1.5 text-text-muted",children:R.defaultValue||"-"})]},R.name))})]})}),e.jsxs("div",{className:"flex-1 overflow-auto relative",children:[e.jsx(Xe,{isLoading:h,text:"刷新表数据..."}),x?e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"sticky top-0 bg-bg-dark",children:e.jsx("tr",{children:x.columns.map(R=>e.jsx("th",{onClick:()=>oe(R.name),className:"px-3 py-2 text-left font-medium text-text-muted border-b border-border cursor-pointer hover:bg-bg-light/50 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:R.primaryKey?"text-primary":"",children:R.name}),g===R.name&&e.jsx("span",{className:"text-primary",children:v?e.jsx(Ye,{size:12}):e.jsx(Ge,{size:12})})]})},R.name))})}),e.jsx("tbody",{className:"font-mono",children:x.rows.map((R,Fe)=>e.jsx("tr",{className:"border-b border-border/30 hover:bg-bg-light/30 transition-colors",children:x.columns.map(A=>{var et;const re=R.values[A.name],xe=((et=A.type)==null?void 0:et.toLowerCase())==="blob",ne=a&&i&&I(a,i,A.name),Z=xe||re&&Rl(re)&&ne;return e.jsx("td",{className:"px-3 py-2 text-text-secondary max-w-xs",children:re===null?e.jsx("span",{className:"text-text-muted italic",children:"NULL"}):Z&&a&&i?e.jsx(Ml,{value:re,dbId:a,tableName:i,columnName:A.name}):e.jsx("span",{className:"truncate block",title:re??"",children:re})},A.name)})},Fe))})]}):j?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted",children:[e.jsx(Re,{size:36,className:"mb-3 opacity-50"}),e.jsx("p",{className:"text-sm text-red-400 mb-2",children:j}),e.jsx("button",{onClick:()=>a&&i&&_(t,a,i),className:"px-4 py-2 bg-primary/20 text-primary rounded-lg hover:bg-primary/30 transition-colors text-xs",children:"重试"})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-text-muted",children:"无数据"})]}),x&&x.totalRows!==null&&x.totalRows>p&&e.jsxs("div",{className:"px-4 py-2 border-t border-border bg-bg-dark/50 flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-text-muted",children:["第 ",y," 页 / 共 ",Math.ceil(x.totalRows/p)," 页"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>le(Math.max(1,y-1)),disabled:y<=1,className:"px-3 py-1 bg-bg-light text-text-secondary rounded text-xs hover:bg-bg-lighter disabled:opacity-50 transition-colors",children:"上一页"}),e.jsx("button",{onClick:()=>le(y+1),disabled:y>=Math.ceil(x.totalRows/p),className:"px-3 py-1 bg-bg-light text-text-secondary rounded text-xs hover:bg-bg-lighter disabled:opacity-50 transition-colors",children:"下一页"})]})]})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-text-muted",children:e.jsxs("div",{className:"text-center flex flex-col items-center",children:[e.jsx(Wt,{size:36,className:"mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:a?"选择一个表查看数据":"选择一个数据库"})]})})})]})}function Pl(t){const s=u.useCallback(r=>{const n=r.target,a=n.tagName==="INPUT"||n.tagName==="TEXTAREA"||n.isContentEditable;for(const i of t){const o=r.key.toLowerCase()===i.key.toLowerCase(),l=i.shift?r.shiftKey:!r.shiftKey,c=i.alt?r.altKey:!r.altKey,d=i.ctrl?r.ctrlKey||r.metaKey:!r.ctrlKey&&!r.metaKey;if(o&&d&&l&&c){if(a&&!i.allowInInput)continue;r.preventDefault(),i.action();return}}},[t]);u.useEffect(()=>(window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)),[s])}const Ms=[{id:"http",label:"HTTP",icon:e.jsx(me,{size:16}),description:"HTTP/HTTPS 请求与调试工具"},{id:"websocket",label:"WebSocket",icon:e.jsx(ke,{size:16}),description:"WS 连接"},{id:"logs",label:"日志",icon:e.jsx(je,{size:16}),description:"应用日志"},{id:"database",label:"数据库",icon:e.jsx(qe,{size:16}),description:"SQLite 浏览"}];function Fl(){const{deviceId:t}=Rr(),s=At(),[r,n]=Or(),a=r.get("tab"),i=(a==="network"?"http":a)||"http",[o,l]=u.useState(i),[c,d]=u.useState(!0),[x,h]=u.useState(!0),[j,y]=u.useState(!0),[p,g]=u.useState(!0),[v,f]=u.useState(!1),[D,T]=u.useState(!1),[W,H]=u.useState(!1),z=u.useCallback(A=>{l(A),n({tab:A},{replace:!0})},[n]),{currentDevice:P,selectDevice:F,clearSelection:G,toggleCapture:C,toggleWebSocketCapture:_,toggleDatabaseInspector:U,clearDeviceData:L,toggleFavorite:E,isFavorite:m}=pt(),{setConnected:N,setInDeviceDetail:w}=We(),M=bt(A=>A.toggleTheme),{addActivity:k,clearActivities:O,loadDeviceActivities:Q}=ir(),Y=$t(),X=qs(),I=Gs(),V=Ca(),B=Ea();Pl([...Ms.map((A,re)=>({key:String(re+1),ctrl:!0,description:`切换到${A.label}`,action:()=>z(A.id)})),{key:"k",ctrl:!0,description:"搜索",action:()=>{const A=document.querySelector("[data-search-input]");A==null||A.focus()}},{key:"r",ctrl:!0,description:"刷新",action:()=>{t&&(o==="http"?Y.fetchEvents(t):o==="logs"?X.fetchEvents(t):o==="websocket"&&I.fetchSessions(t))}},{key:"l",ctrl:!0,description:"清屏",action:()=>{o==="http"?Y.clearEvents():o==="logs"&&X.clearEvents()}},{key:"t",ctrl:!0,description:"切换主题",action:M},{key:"/",ctrl:!0,description:"显示快捷键帮助",action:()=>f(!0)},{key:"Escape",description:"取消选择",action:()=>{v?f(!1):V.isEditorOpen?V.closeEditor():Y.isSelectMode?Y.toggleSelectMode():Y.clearSelection()}},{key:"a",ctrl:!0,description:"全选",action:()=>{o==="http"&&Y.isSelectMode&&Y.selectAll()}},{key:"Backspace",description:"删除选中",action:()=>{o==="http"&&Y.isSelectMode&&Y.selectedIds.size>0&&t&&Y.batchDelete(t)}},{key:"f",description:"收藏",action:()=>{o==="http"&&Y.isSelectMode&&Y.selectedIds.size>0&&t&&Y.batchFavorite(t,!0)}}]),u.useEffect(()=>{if(!t)return;w(!0),F(t),Y.fetchEvents(t),X.fetchEvents(t),X.fetchFilterOptions(t),I.fetchSessions(t),V.fetchRules(t),Q(t),Te.connect(t);const A=Te.onMessage(xe=>{if(xe.deviceId===t)switch(xe.type){case"httpEvent":Y.addRealtimeEvent(Sa(xe.payload));break;case"logEvent":X.addRealtimeEvent(Ia(xe.payload));break;case"wsEvent":{const ne=La(xe.payload);if(ne.type==="sessionCreated"){const Z=ne.data;I.addRealtimeSession({id:Z.id,url:Z.url,connectTime:Z.connectTime,disconnectTime:null,closeCode:null,closeReason:null,isOpen:!0})}else if(ne.type==="sessionClosed"){const Z=ne.data;I.updateSessionStatus(Z.id,!1,Z.closeCode,Z.closeReason)}else if(ne.type==="frame"){const Z=ne.data;I.sessions.some(wt=>wt.id===Z.sessionId)||(I.addRealtimeSession({id:Z.sessionId,url:"(loading...)",connectTime:Z.timestamp,disconnectTime:null,closeCode:null,closeReason:null,isOpen:!0}),Fs(t,Z.sessionId).then(wt=>{I.updateSessionUrl(Z.sessionId,wt.url)}).catch(()=>{I.updateSessionUrl(Z.sessionId,"(unknown)")}));const et=Z.payload?Math.floor(Z.payload.length*3/4):0;I.addRealtimeFrame({id:Z.id,sessionId:Z.sessionId,direction:Z.direction,opcode:Z.opcode,payloadPreview:Z.payloadPreview??null,payloadSize:et,timestamp:Z.timestamp,isMocked:Z.isMocked})}break}case"deviceConnected":{const ne=JSON.parse(xe.payload);k({id:`${ne.sessionId}-connected`,deviceId:t,sessionId:ne.sessionId,timestamp:new Date().toISOString(),type:"connected",deviceName:ne.deviceName});break}case"deviceDisconnected":{k({id:`${Date.now()}-disconnected`,deviceId:t,sessionId:"",timestamp:new Date().toISOString(),type:"disconnected"});break}case"breakpointHit":{const ne=JSON.parse(xe.payload);B.addHit(ne),z("http");break}}}),re=Te.onConnection(N);return()=>{A(),re(),Te.disconnect(),G(),Y.clearEvents(),X.clearEvents(),I.clearSessions(),V.clearRules(),B.clear(),O(),w(!1)}},[t]),u.useEffect(()=>{P!=null&&P.deviceInfo&&(d(P.deviceInfo.captureEnabled),h(P.deviceInfo.logCaptureEnabled),y(P.deviceInfo.wsCaptureEnabled),g(P.deviceInfo.dbInspectorEnabled))},[P]);const ee=()=>{s("/")},$=u.useCallback(A=>{d(A),P&&C(A,P.deviceInfo.logCaptureEnabled)},[C,P]),oe=u.useCallback(A=>{h(A),P&&C(P.deviceInfo.captureEnabled,A)},[C,P]),le=u.useCallback(A=>{y(A),_(A)},[_]),te=u.useCallback(A=>{g(A),U(A)},[U]),vt=u.useCallback(async()=>{Te.pauseReconnect(),await L(),Y.clearEvents(),X.clearEvents(),I.clearSessions(),V.clearRules(),B.clear(),T(!1),Te.resumeReconnect()},[L]),Ze=u.useCallback(A=>{t&&Y.selectEvent(t,A)},[t]),R=u.useCallback(A=>{X.setFilter("traceId",A),z("logs")},[]),Fe=u.useCallback((A,re)=>{Y.updateEventFavorite(A,re)},[]);return t?e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("header",{className:"px-4 py-2 bg-bg-dark border-b border-border",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:ee,className:"flex items-center gap-1.5 text-text-secondary hover:text-text-primary transition-colors group px-2 py-1.5 rounded hover:bg-bg-light",children:[e.jsx("span",{className:"group-hover:-translate-x-0.5 transition-transform",children:e.jsx(Wt,{size:16})}),e.jsx("span",{className:"text-sm font-medium",children:"返回"})]}),e.jsx("div",{className:"h-5 w-px bg-border"}),e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center border border-border flex-shrink-0",children:P?qt(P.deviceInfo.platform,18):e.jsx(de,{size:18})}),e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("h1",{className:"text-base font-semibold text-text-primary truncate",children:(P==null?void 0:P.deviceInfo.deviceName)||"加载中..."}),(P==null?void 0:P.deviceInfo.isSimulator)&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded bg-purple-500/20 text-purple-400 border border-purple-500/30 flex-shrink-0",children:"模拟器"}),t&&e.jsx("button",{onClick:()=>E(t),className:b("p-0.5 rounded transition-colors flex-shrink-0",m(t)?"text-yellow-400 hover:text-yellow-300":"text-text-muted hover:text-yellow-400"),title:m(t)?"取消收藏":"收藏设备",children:e.jsx(he,{size:14,filled:m(t)})}),P&&e.jsxs("span",{className:b("text-xs px-2 py-0.5 rounded flex items-center gap-1 flex-shrink-0",P.isOnline?"bg-green-500/10 text-green-400 border border-green-500/30":"bg-red-500/10 text-red-400 border border-red-500/30"),children:[e.jsx("span",{className:b("w-1.5 h-1.5 rounded-full",P.isOnline?"bg-green-400":"bg-red-400")}),P.isOnline?"在线":"离线"]}),P&&e.jsxs("span",{className:"text-xs text-text-muted hidden xl:block truncate",children:[P.deviceInfo.deviceModel," · ",P.deviceInfo.platform," ",P.deviceInfo.systemVersion," · ",P.deviceInfo.appName]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-bg-medium rounded-lg border border-border",children:[e.jsxs("label",{className:"flex items-center gap-1.5 text-xs cursor-pointer group px-2 py-1 rounded hover:bg-bg-light",title:"HTTP 捕获",children:[e.jsx("input",{type:"checkbox",checked:c,onChange:A=>$(A.target.checked),className:"accent-primary w-3.5 h-3.5"}),e.jsx(Wn,{size:14,className:c?"text-primary":"text-text-muted"})]}),e.jsxs("label",{className:"flex items-center gap-1.5 text-xs cursor-pointer group px-2 py-1 rounded hover:bg-bg-light",title:"WebSocket 捕获",children:[e.jsx("input",{type:"checkbox",checked:j,onChange:A=>le(A.target.checked),className:"accent-primary w-3.5 h-3.5"}),e.jsx(Vn,{size:14,className:j?"text-primary":"text-text-muted"})]}),e.jsxs("label",{className:"flex items-center gap-1.5 text-xs cursor-pointer group px-2 py-1 rounded hover:bg-bg-light",title:"日志捕获",children:[e.jsx("input",{type:"checkbox",checked:x,onChange:A=>oe(A.target.checked),className:"accent-primary w-3.5 h-3.5"}),e.jsx(Un,{size:14,className:x?"text-primary":"text-text-muted"})]}),e.jsxs("label",{className:"flex items-center gap-1.5 text-xs cursor-pointer group px-2 py-1 rounded hover:bg-bg-light",title:"数据库监控",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:A=>te(A.target.checked),className:"accent-primary w-3.5 h-3.5"}),e.jsx(qn,{size:14,className:p?"text-primary":"text-text-muted"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>f(!0),className:"btn btn-ghost p-2 rounded",title:"快捷键 (Ctrl+/)",children:e.jsx($n,{size:16})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>H(!W),className:"btn btn-ghost p-2 rounded",title:"更多操作",children:e.jsx(Js,{size:16})}),W&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>H(!1)}),e.jsx("div",{className:"absolute right-0 top-full mt-1 w-48 bg-bg-dark border border-border rounded-lg shadow-lg z-50 overflow-hidden",children:e.jsxs("button",{onClick:()=>{H(!1),T(!0)},className:"w-full px-3 py-2.5 text-left text-sm text-red-400 hover:bg-red-500/10 flex items-center gap-2 transition-colors",children:[e.jsx(Pe,{size:14}),e.jsx("span",{children:"清空设备数据"})]})})]})]})]})]})}),e.jsxs("div",{className:"px-4 py-2 bg-bg-dark border-b border-border flex items-center justify-between gap-4",children:[e.jsx("div",{className:"flex items-center gap-0.5 p-0.5 bg-bg-medium rounded-lg border border-border w-fit",children:Ms.map((A,re)=>e.jsxs("button",{onClick:()=>z(A.id),title:`${A.description} (⌘${re+1})`,className:b("flex items-center gap-1.5 px-3 py-1.5 rounded text-sm font-medium transition-colors relative whitespace-nowrap",o===A.id?"bg-primary text-bg-darkest":"text-text-secondary hover:text-text-primary hover:bg-bg-light"),children:[e.jsx("span",{className:"text-sm",children:A.icon}),e.jsx("span",{children:A.label}),A.id==="http"&&B.pendingHits.length>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-4 h-4 bg-orange-500 text-white text-xs rounded-full flex items-center justify-center animate-pulse",children:B.pendingHits.length})]},A.id))}),t&&e.jsx(xl,{deviceId:t,alwaysShow:!0})]}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[o==="http"&&e.jsx(zl,{deviceId:t,httpStore:Y,mockStore:V,breakpointStore:B,onSelectEvent:Ze,onShowRelatedLogs:R,onFavoriteChange:Fe,onRefresh:()=>Y.fetchEvents(t)}),o==="websocket"&&e.jsx(Hl,{deviceId:t,wsStore:I}),o==="logs"&&e.jsx($l,{deviceId:t,logStore:X,onRefresh:()=>X.fetchEvents(t)}),o==="database"&&e.jsx(Ol,{deviceId:t})]}),e.jsx(Jo,{isOpen:v,onClose:()=>f(!1)}),e.jsx(jt,{isOpen:D,onClose:()=>T(!1),onConfirm:vt,title:"清空设备数据",message:`确定要清空 "${(P==null?void 0:P.deviceInfo.deviceName)||"该设备"}" 的所有数据吗？

这将删除：
• 所有 HTTP 请求记录
• 所有日志事件
• 所有 WebSocket 会话

此操作不可恢复。`,confirmText:"确认清空",cancelText:"取消",type:"danger"})]}):null}function zl({deviceId:t,httpStore:s,mockStore:r,breakpointStore:n,onSelectEvent:a,onShowRelatedLogs:i,onFavoriteChange:o,onRefresh:l}){const[c,d]=u.useState("requests"),[x,h]=u.useState(!1),j=()=>{const v=Array.from(s.selectedIds);v.length>0&&window.open(gn(t,v),"_blank")},y=u.useCallback(async()=>{await s.batchDelete(t),h(!1)},[t,s]),p=s.filteredItems.filter(v=>!("type"in v&&v.type==="session-divider")).length,g=[{id:"requests",label:"请求列表",icon:e.jsx(me,{size:14})},{id:"breakpoints",label:"断点",icon:e.jsx(Ht,{size:14}),badge:n.pendingHits.length},{id:"mock",label:"Mock",icon:e.jsx(ce,{size:14})},{id:"chaos",label:"故障注入",icon:e.jsx(Ve,{size:14})},{id:"rules",label:"流量规则",icon:e.jsx(lt,{size:14})}];return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"px-4 py-2.5 bg-bg-dark/80 border-b border-border flex items-center gap-1 p-1",children:g.map(v=>e.jsxs("button",{onClick:()=>d(v.id),className:b("flex items-center gap-1.5 px-4 py-2 rounded text-sm font-medium transition-colors relative whitespace-nowrap",c===v.id?"bg-accent-blue text-white":"text-text-secondary hover:text-text-primary hover:bg-bg-light"),children:[v.icon,e.jsx("span",{children:v.label}),v.badge&&v.badge>0&&e.jsx("span",{className:"ml-1 px-1.5 py-0.5 bg-orange-500 text-white text-xs rounded-full min-w-[18px] text-center animate-pulse",children:v.badge})]},v.id))}),c==="requests"&&e.jsx(_l,{deviceId:t,httpStore:s,mockStore:r,onSelectEvent:a,onShowRelatedLogs:i,onFavoriteChange:o,onRefresh:l,filteredCount:p,showBatchDeleteConfirm:x,setShowBatchDeleteConfirm:h,handleExportSelected:j,handleBatchDelete:y}),c==="breakpoints"&&e.jsx(gl,{deviceId:t,pendingHits:n.pendingHits,onResumeBreakpoint:(v,f)=>n.resumeBreakpoint(t,v,f)}),c==="mock"&&e.jsx(Wl,{deviceId:t,mockStore:r}),c==="chaos"&&e.jsx(jl,{deviceId:t}),c==="rules"&&e.jsx(Al,{deviceId:t})]})}function _l({deviceId:t,httpStore:s,mockStore:r,onSelectEvent:n,onShowRelatedLogs:a,onFavoriteChange:i,onRefresh:o,filteredCount:l,showBatchDeleteConfirm:c,setShowBatchDeleteConfirm:d,handleExportSelected:x,handleBatchDelete:h}){const[j,y]=u.useState(!1),p=gt(),g=s.filteredItems.filter(f=>!Ue(f)),v=s.selectedIds.size===g.length&&g.length>0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-bg-medium border-b border-border",children:[e.jsxs("div",{className:"px-4 py-2 flex items-center gap-2 flex-nowrap min-w-0",children:[e.jsxs("button",{onClick:o,disabled:s.isLoading,className:b("btn btn-secondary text-xs px-2.5 py-1.5 flex-shrink-0",s.isLoading&&"opacity-70"),title:"刷新列表 (Ctrl+R)",children:[e.jsx("span",{className:s.isLoading?"inline-block animate-spin mr-1":"hidden",children:"⟳"}),"刷新"]}),e.jsx("div",{className:"h-5 w-px bg-border flex-shrink-0"}),e.jsx("button",{onClick:()=>s.toggleSelectMode(),className:b("btn text-xs px-2.5 py-1.5",s.isSelectMode?"btn-primary":"btn-secondary"),title:s.isSelectMode?"退出选择模式":"进入选择模式",children:s.isSelectMode?"取消选择":"批量选择"}),e.jsx("div",{className:"h-5 w-px bg-border flex-shrink-0"}),e.jsxs("select",{value:s.filters.method,onChange:f=>s.setFilter("method",f.target.value),className:"select text-xs py-1.5 px-2",children:[e.jsx("option",{value:"",children:"方法"}),e.jsx("option",{value:"GET",children:"GET"}),e.jsx("option",{value:"POST",children:"POST"}),e.jsx("option",{value:"PUT",children:"PUT"}),e.jsx("option",{value:"DELETE",children:"DELETE"}),e.jsx("option",{value:"PATCH",children:"PATCH"})]}),e.jsx("input",{type:"text",value:s.filters.urlContains,onChange:f=>s.setFilter("urlContains",f.target.value),placeholder:"搜索 URL...",className:"input text-xs py-1.5 px-2.5 w-40","data-search-input":!0}),e.jsxs("label",{className:"flex items-center gap-1.5 text-xs text-text-secondary cursor-pointer hover:text-text-primary px-1.5 flex-shrink-0",children:[e.jsx("input",{type:"checkbox",checked:s.filters.mockedOnly,onChange:f=>s.setFilter("mockedOnly",f.target.checked),className:"accent-primary w-3 h-3"}),"Mock"]}),e.jsxs("label",{className:"flex items-center gap-1.5 text-xs text-text-secondary cursor-pointer hover:text-text-primary px-1.5 flex-shrink-0",children:[e.jsx("input",{type:"checkbox",checked:s.filters.favoritesOnly,onChange:f=>s.setFilter("favoritesOnly",f.target.checked),className:"accent-primary w-3 h-3"}),"收藏"]}),e.jsx("button",{onClick:()=>s.setFilter("statusRange",s.filters.statusRange==="400-599"?"":"400-599"),className:b("px-2 py-1 rounded text-xs font-medium border transition-colors flex-shrink-0",s.filters.statusRange==="400-599"?"bg-red-500/20 text-red-400 border-red-500/20":"bg-bg-light text-text-muted border-border hover:text-text-secondary"),children:"Errors"}),e.jsx("div",{className:"flex-1 min-w-4"}),e.jsxs("span",{className:"text-xs text-text-muted bg-bg-light px-2 py-1 rounded flex-shrink-0",children:[l!==s.events.length?`${l}/${s.events.length}`:`${s.events.length}`," 条"]}),e.jsxs("label",{className:"flex items-center gap-1.5 text-xs text-text-secondary cursor-pointer hover:text-text-primary px-1.5 flex-shrink-0",children:[e.jsx("input",{type:"checkbox",checked:s.autoScroll,onChange:f=>s.setAutoScroll(f.target.checked),className:"accent-primary w-3 h-3"}),"自动滚动"]}),e.jsx("div",{className:"h-5 w-px bg-border"}),e.jsx("button",{onClick:()=>s.clearEvents(),className:"btn btn-ghost text-text-muted hover:text-red-400 text-xs px-2 py-1.5 flex-shrink-0",title:"清空当前列表",children:"清屏"}),e.jsx("div",{className:"h-5 w-px bg-border"}),e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("button",{onClick:()=>y(!j),className:"btn btn-ghost text-xs px-2 py-1.5",title:"更多选项",children:"更多 ▾"}),j&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-[100]",onClick:()=>y(!1)}),e.jsxs("div",{className:"absolute right-0 top-full mt-1 w-48 bg-bg-dark border border-border rounded-lg shadow-lg z-[101] py-1",children:[e.jsxs("div",{className:"px-3 py-2 border-b border-border",children:[e.jsx("span",{className:"text-xs text-text-muted",children:"分组模式"}),e.jsx("div",{className:"flex items-center gap-1 mt-1.5",children:["none","domain","path"].map(f=>e.jsx("button",{onClick:()=>s.setGroupMode(f),className:b("px-2 py-1 text-xs rounded transition-colors",s.groupMode===f?"bg-primary text-white":"bg-bg-light text-text-muted hover:text-text-secondary"),children:f==="none"?"无":f==="domain"?"域名":"路径"},f))})]}),e.jsxs("label",{className:"flex items-center gap-2 px-3 py-2 text-xs text-text-secondary cursor-pointer hover:bg-bg-light",children:[e.jsx("input",{type:"checkbox",checked:s.filters.showBlacklisted,onChange:f=>s.setFilter("showBlacklisted",f.target.checked),className:"accent-primary w-3 h-3"}),"显示黑名单域名"]}),e.jsx("div",{className:"border-t border-border my-1"}),e.jsx("a",{href:fn(t),target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-3 py-2 text-xs text-text-secondary hover:bg-bg-light hover:text-text-primary",onClick:()=>y(!1),children:"导出全部 HAR"})]})]})]})]}),s.isSelectMode&&e.jsxs("div",{className:"px-4 py-2 bg-primary/5 border-t border-border flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-text-secondary",children:["已选 ",e.jsx("span",{className:"text-primary font-medium",children:s.selectedIds.size})," / ",g.length," 项"]}),e.jsx("div",{className:"h-4 w-px bg-border"}),e.jsx("button",{onClick:()=>s.selectAll(),className:"btn btn-secondary text-xs px-2.5 py-1",children:v?"取消全选":"全选"}),e.jsx("button",{onClick:()=>s.clearSelectedIds(),className:"btn btn-secondary text-xs px-2.5 py-1",disabled:s.selectedIds.size===0,children:"清除选择"}),e.jsx("div",{className:"h-4 w-px bg-border"}),e.jsx("button",{onClick:async()=>{try{const f=await s.batchFavorite(t,!0);f&&p.show("success",`已收藏 ${f} 条请求`)}catch{p.show("error","收藏失败")}},disabled:s.selectedIds.size===0,className:"btn bg-yellow-500/10 text-yellow-400 border border-yellow-500/20 hover:bg-yellow-500/20 text-xs px-2.5 py-1",children:"收藏"}),e.jsx("button",{onClick:async()=>{try{const f=await s.batchFavorite(t,!1);f&&p.show("success",`已取消收藏 ${f} 条请求`)}catch{p.show("error","取消收藏失败")}},disabled:s.selectedIds.size===0,className:"btn btn-secondary text-xs px-2.5 py-1",children:"取消收藏"}),e.jsx("button",{onClick:x,disabled:s.selectedIds.size===0,className:"btn btn-secondary text-xs px-2.5 py-1",children:"导出选中"}),e.jsx("button",{onClick:()=>d(!0),disabled:s.selectedIds.size===0,className:"btn btn-danger text-xs px-2.5 py-1",children:"删除选中"})]})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsxs("div",{className:"flex-1 min-w-[400px] border-r border-border flex flex-col relative",children:[e.jsx(Xe,{isLoading:s.isLoading,text:"刷新 HTTP 列表..."}),s.groupMode==="none"?e.jsx(yo,{items:s.filteredItems,selectedId:s.selectedEventId,onSelect:n,autoScroll:s.autoScroll,deviceId:t,isSelectMode:s.isSelectMode,selectedIds:s.selectedIds,onToggleSelect:s.toggleSelectId,mockRules:r.rules,onEditMockRule:f=>{r.openEditor(f)}}):e.jsx(Eo,{events:s.filteredItems.filter(f=>!("type"in f&&f.type==="session-divider")),groupMode:s.groupMode,selectedId:s.selectedEventId,onSelect:n,deviceId:t,isSelectMode:s.isSelectMode,selectedIds:s.selectedIds,onToggleSelect:s.toggleSelectId})]}),e.jsx("div",{className:"w-[45%] min-w-[400px] bg-bg-dark/50",children:e.jsx($o,{event:s.selectedEvent,deviceId:t,onShowRelatedLogs:a,onFavoriteChange:i,mockRules:r.rules,onEditMockRule:f=>{r.openEditor(f)},onCreateMockFromRequest:(f,D,T,W)=>{r.openEditorWithTemplate({url:f,method:D,responseBody:T,responseHeaders:W})}})})]}),e.jsx(jt,{isOpen:c,onClose:()=>d(!1),onConfirm:h,title:"删除 HTTP 请求",message:`确定要删除选中的 ${s.selectedIds.size} 个 HTTP 请求吗？

此操作不可恢复。`,confirmText:"确认删除",cancelText:"取消",type:"danger"}),e.jsx(Sr,{rule:r.editingRule,isOpen:r.isEditorOpen,onClose:r.closeEditor,onSave:async f=>{var D;(D=r.editingRule)!=null&&D.id?await r.updateRule(t,r.editingRule.id,f):await r.createRule(t,f)},loading:r.loading,httpOnly:!0})]})}function Al({deviceId:t}){const{rules:s,isLoading:r,fetchRules:n,createOrUpdateRule:a,deleteRule:i}=Oe(),[o,l]=u.useState(!1),[c,d]=u.useState(null);u.useEffect(()=>{n()},[n]);const x=async v=>{await a({...v,isEnabled:!v.isEnabled})},h=()=>{d({name:"",matchType:"domain",matchValue:"",action:"highlight",isEnabled:!0,priority:0}),l(!0)},j=v=>{d({...v}),l(!0)},y=async()=>{c&&(await a(c),l(!1),d(null))},p=v=>{switch(v){case"highlight":return{label:"高亮",color:"text-green-400",bgColor:"bg-green-500/5 border-green-500/20",icon:"✓"};case"hide":return{label:"隐藏",color:"text-red-400",bgColor:"bg-red-500/5 border-red-500/20",icon:"✗"};case"mark":return{label:"标记",color:"text-yellow-400",bgColor:"bg-yellow-500/5 border-yellow-500/20",icon:"★"};default:return{label:v,color:"text-text-secondary",bgColor:"bg-bg-light border-border",icon:""}}},g=v=>{switch(v){case"domain":return"域名";case"urlRegex":return"正则";case"header":return"请求头";default:return v}};return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-border bg-bg-dark/50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(lt,{size:24,className:"text-text-primary"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-text-primary",children:"流量规则"}),e.jsx("p",{className:"text-xs text-text-muted",children:"配置域名的高亮、隐藏、标记策略"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs text-text-muted bg-bg-light px-2 py-1 rounded-lg",children:[s.length," 条规则"]}),e.jsx("button",{onClick:h,className:"btn btn-primary text-sm",children:"+ 新建规则"})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4",children:r?e.jsx("div",{className:"flex items-center justify-center h-full text-text-muted",children:"加载中..."}):s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted",children:[e.jsx(lt,{size:48,className:"mb-3 opacity-50"}),e.jsx("p",{className:"text-sm mb-3",children:"暂无流量规则"}),e.jsx("button",{onClick:h,className:"btn btn-primary text-sm",children:"+ 新建规则"})]}):e.jsx("div",{className:"space-y-2",children:s.map(v=>{const f=p(v.action);return e.jsxs("div",{className:b("flex items-center justify-between p-4 rounded-lg border transition-colors group",v.isEnabled?f.bgColor:"bg-bg-light border-border opacity-60"),children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:v.isEnabled,onChange:()=>x(v),className:"sr-only peer"}),e.jsx("div",{className:"w-9 h-5 bg-bg-medium rounded-full peer peer-checked:bg-primary transition-colors"}),e.jsx("div",{className:"absolute left-0.5 top-0.5 w-4 h-4 bg-white rounded-full transition-transform peer-checked:translate-x-4"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-text-primary flex items-center gap-2",children:[e.jsx("span",{className:b("text-sm",f.color),children:f.icon}),v.name||v.matchValue]}),e.jsxs("div",{className:"text-xs text-text-muted mt-0.5",children:[e.jsx("span",{className:"px-1.5 py-0.5 bg-bg-medium rounded text-2xs mr-1.5",children:g(v.matchType)}),v.matchValue,e.jsx("span",{className:"mx-1.5",children:"·"}),e.jsx("span",{className:f.color,children:f.label})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>j(v),className:"btn btn-ghost text-text-muted hover:text-text-primary text-sm",children:"编辑"}),e.jsx("button",{onClick:()=>i(v.id),className:"btn btn-ghost text-red-400 hover:text-red-300 text-sm",children:"删除"})]})]},v.id)})})}),o&&c&&e.jsx(Bl,{rule:c,onChange:d,onSave:y,onCancel:()=>{l(!1),d(null)}})]})}function Bl({rule:t,onChange:s,onSave:r,onCancel:n}){return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-bg-dark border border-border rounded-xl shadow-2xl w-full max-w-lg",children:[e.jsx("div",{className:"px-5 py-4 border-b border-border",children:e.jsx("h3",{className:"font-semibold text-text-primary",children:t.id?"编辑规则":"新建规则"})}),e.jsxs("div",{className:"p-5 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-secondary mb-1.5",children:"规则名称"}),e.jsx("input",{type:"text",value:t.name||"",onChange:a=>s({...t,name:a.target.value}),placeholder:"可选，留空将使用匹配值作为名称",className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-secondary mb-1.5",children:"匹配类型"}),e.jsx("div",{className:"flex gap-2",children:[{value:"domain",label:"域名匹配"},{value:"urlRegex",label:"正则匹配"},{value:"header",label:"请求头"}].map(a=>e.jsx("button",{onClick:()=>s({...t,matchType:a.value}),className:b("px-3 py-1.5 rounded-lg text-sm transition-colors",t.matchType===a.value?"bg-primary text-white":"bg-bg-light text-text-secondary hover:text-text-primary"),children:a.label},a.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-secondary mb-1.5",children:t.matchType==="domain"?"域名":t.matchType==="urlRegex"?"正则表达式":"请求头名称"}),e.jsx("input",{type:"text",value:t.matchValue||"",onChange:a=>s({...t,matchValue:a.target.value}),placeholder:t.matchType==="domain"?"example.com":t.matchType==="urlRegex"?".*api/v1.*":"X-Custom-Header",className:"input w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-text-secondary mb-1.5",children:"动作"}),e.jsx("div",{className:"flex gap-2",children:[{value:"highlight",label:"高亮显示",color:"text-green-400 border-green-500/30"},{value:"hide",label:"隐藏",color:"text-red-400 border-red-500/30"},{value:"mark",label:"标记",color:"text-yellow-400 border-yellow-500/30"}].map(a=>e.jsx("button",{onClick:()=>s({...t,action:a.value}),className:b("px-3 py-1.5 rounded-lg text-sm border transition-colors",t.action===a.value?`${a.color} bg-bg-light`:"border-border text-text-secondary hover:text-text-primary"),children:a.label},a.value))})]})]}),e.jsxs("div",{className:"px-5 py-4 border-t border-border flex justify-end gap-3",children:[e.jsx("button",{onClick:n,className:"btn btn-secondary",children:"取消"}),e.jsx("button",{onClick:r,disabled:!t.matchValue,className:"btn btn-primary",children:"保存"})]})]})})}function $l({deviceId:t,logStore:s,onRefresh:r}){const n=s.filteredEvents.length,a=s.events.length,i=gt(),[o,l]=u.useState(!1),[c,d]=u.useState(!1),x=s.selectedIds.size===n&&n>0,h=u.useCallback(async()=>{const y=s.selectedIds.size;try{await s.batchDelete(t),i.show("success",`已删除 ${y} 条日志`)}catch{i.show("error","删除失败")}l(!1)},[t,s,i]),j=u.useCallback(()=>{const y=Array.from(s.selectedIds);if(y.length>0){const p=`${ns(t)}&ids=${y.join(",")}`;window.open(p,"_blank")}},[t,s.selectedIds]);return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"bg-bg-medium/50 border-b border-border",children:[e.jsxs("div",{className:"px-4 py-2 flex items-center gap-2 flex-nowrap min-w-0",children:[e.jsxs("button",{onClick:r,disabled:s.isLoading,className:b("btn btn-secondary text-xs px-2.5 py-1.5",s.isLoading&&"opacity-70"),title:"刷新列表 (Ctrl+R)",children:[e.jsx("span",{className:s.isLoading?"inline-block animate-spin mr-1":"hidden",children:"⟳"}),"刷新"]}),e.jsx("div",{className:"h-5 w-px bg-border flex-shrink-0"}),e.jsx("button",{onClick:()=>s.toggleSelectMode(),className:b("btn text-xs px-2.5 py-1.5",s.isSelectMode?"btn-primary":"btn-secondary"),title:s.isSelectMode?"退出选择模式":"进入选择模式",children:s.isSelectMode?"取消选择":"批量选择"}),e.jsx("div",{className:"h-5 w-px bg-border flex-shrink-0"}),e.jsx(Yo,{minLevel:s.filters.minLevel,subsystems:s.subsystems,categories:s.categories,selectedSubsystem:s.filters.subsystem,selectedCategory:s.filters.category,searchText:s.filters.text,searchQuery:s.filters.searchQuery,onMinLevelChange:s.setMinLevel,onSubsystemChange:y=>s.setFilter("subsystem",y),onCategoryChange:y=>s.setFilter("category",y),onSearchChange:y=>s.setFilter("text",y),onSearchQueryChange:s.setSearchQuery}),e.jsx("div",{className:"flex-1 min-w-4"}),e.jsxs("span",{className:"text-xs text-text-muted bg-bg-light px-2 py-1 rounded flex-shrink-0",children:[n!==a?`${n}/${a}`:`${a}`," 条"]}),e.jsxs("label",{className:"flex items-center gap-1.5 text-xs text-text-secondary cursor-pointer hover:text-text-primary px-1.5 flex-shrink-0",children:[e.jsx("input",{type:"checkbox",checked:s.autoScroll,onChange:y=>s.setAutoScroll(y.target.checked),className:"accent-primary w-3 h-3"}),"自动滚动"]}),e.jsx("div",{className:"h-5 w-px bg-border"}),e.jsx("button",{onClick:()=>s.clearEvents(),className:"btn btn-ghost text-text-muted hover:text-red-400 text-xs px-2 py-1.5 flex-shrink-0",title:"清空当前列表",children:"清屏"}),e.jsx("div",{className:"h-5 w-px bg-border"}),e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("button",{onClick:()=>d(!c),className:"btn btn-ghost text-xs px-2 py-1.5",title:"更多选项",children:"更多 ▾"}),c&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-[100]",onClick:()=>d(!1)}),e.jsx("div",{className:"absolute right-0 top-full mt-1 w-40 bg-bg-dark border border-border rounded-lg shadow-lg z-[101] py-1",children:e.jsx("a",{href:ns(t),target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-3 py-2 text-xs text-text-secondary hover:bg-bg-light hover:text-text-primary",onClick:()=>d(!1),children:"导出全部"})})]})]})]}),s.isSelectMode&&e.jsxs("div",{className:"px-4 py-2 bg-primary/5 border-t border-border flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-text-secondary",children:["已选 ",e.jsx("span",{className:"text-primary font-medium",children:s.selectedIds.size})," / ",n," 项"]}),e.jsx("div",{className:"h-4 w-px bg-border"}),e.jsx("button",{onClick:()=>s.selectAll(),className:"btn btn-secondary text-xs px-2.5 py-1",children:x?"取消全选":"全选"}),e.jsx("button",{onClick:()=>s.clearSelectedIds(),className:"btn btn-secondary text-xs px-2.5 py-1",disabled:s.selectedIds.size===0,children:"清除选择"}),e.jsx("div",{className:"h-4 w-px bg-border"}),e.jsx("button",{onClick:j,disabled:s.selectedIds.size===0,className:"btn btn-secondary text-xs px-2.5 py-1",children:"导出选中"}),e.jsx("button",{onClick:()=>l(!0),disabled:s.selectedIds.size===0,className:"btn btn-danger text-xs px-2.5 py-1",children:"删除选中"})]})]}),e.jsxs("div",{className:"flex-1 relative overflow-hidden",children:[e.jsx(Xe,{isLoading:s.isLoading,text:"刷新日志列表..."}),e.jsx(Vo,{events:s.filteredEvents,autoScroll:s.autoScroll,isSelectMode:s.isSelectMode,selectedIds:s.selectedIds,onToggleSelect:s.toggleSelectId})]}),e.jsx(jt,{isOpen:o,onClose:()=>l(!1),onConfirm:h,title:"确认删除",message:`确定要删除选中的 ${s.selectedIds.size} 条日志吗？

此操作不可恢复。`,confirmText:"删除",type:"danger"})]})}function Hl({deviceId:t,wsStore:s}){const r=u.useRef(null),[n,a]=u.useState(!1),i=u.useCallback(async()=>{await s.batchDelete(t),a(!1)},[t,s]),o=u.useCallback(h=>{s.selectedSessionId===h?s.clearSelection():s.selectSession(t,h)},[t,s.selectedSessionId]),l=u.useCallback(()=>{s.selectedSessionId&&s.loadMoreFrames(t,s.selectedSessionId)},[t,s.selectedSessionId]),c=u.useCallback(h=>{s.setFrameDirection(h),s.selectedSessionId&&s.fetchFrames(t,s.selectedSessionId)},[t,s.selectedSessionId]),d=u.useCallback(h=>{s.setFilter("urlContains",h),r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{s.fetchSessions(t)},300)},[t]),x=u.useCallback(h=>{s.setFilter("isOpen",h===""?void 0:h==="true"),s.fetchSessions(t)},[t]);return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"px-4 py-3 bg-bg-medium/50 border-b border-border flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>s.fetchSessions(t),disabled:s.sessionsLoading,className:b("btn btn-secondary",s.sessionsLoading&&"opacity-70"),title:"刷新列表",children:[e.jsx("span",{className:s.sessionsLoading?"inline-block animate-spin mr-1":"hidden",children:"⟳"}),"刷新"]}),e.jsx("div",{className:"h-6 w-px bg-border"}),e.jsx("button",{onClick:()=>s.toggleSelectMode(),className:b("btn",s.isSelectMode?"btn-primary":"btn-secondary"),title:s.isSelectMode?"退出选择模式":"进入选择模式",children:s.isSelectMode?"取消选择":"批量选择"}),s.isSelectMode&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>s.selectAll(),className:"btn btn-secondary",title:"全选/取消全选",children:s.selectedIds.size===s.sessions.length?"取消全选":"全选"}),e.jsxs("button",{onClick:()=>a(!0),disabled:s.selectedIds.size===0,className:"btn btn-danger",title:"删除选中的会话",children:["删除 (",s.selectedIds.size,")"]})]}),e.jsx("div",{className:"h-6 w-px bg-border"}),e.jsx("input",{type:"text",value:s.filters.urlContains||"",onChange:h=>d(h.target.value),placeholder:"搜索 URL...",className:"input w-56"}),e.jsxs("select",{value:s.filters.isOpen===void 0?"":String(s.filters.isOpen),onChange:h=>x(h.target.value),className:"select",children:[e.jsx("option",{value:"",children:"所有状态"}),e.jsx("option",{value:"true",children:"连接中"}),e.jsx("option",{value:"false",children:"已关闭"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs text-text-muted bg-bg-light px-2 py-1 rounded-lg",children:[s.totalSessions," 个会话"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-text-secondary cursor-pointer hover:text-text-primary transition-colors",children:[e.jsx("input",{type:"checkbox",checked:s.autoScroll,onChange:h=>s.setAutoScroll(h.target.checked),className:"accent-primary"}),"自动滚动"]}),e.jsx("div",{className:"h-6 w-px bg-border"}),e.jsx("button",{onClick:()=>s.clearSessions(),className:"btn btn-ghost text-text-muted hover:text-text-secondary",title:"清空当前列表（不删除数据库）",children:"清屏"})]})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsxs("div",{className:"w-[40%] min-w-[300px] border-r border-border relative",children:[e.jsx(Xe,{isLoading:s.sessionsLoading,text:"刷新 WebSocket 列表..."}),e.jsx(Qo,{sessions:s.sessions,selectedId:s.selectedSessionId,onSelect:o,loading:s.sessionsLoading,autoScroll:s.autoScroll,isSelectMode:s.isSelectMode,selectedIds:s.selectedIds,onToggleSelect:s.toggleSelectId})]}),e.jsx("div",{className:"flex-1 min-w-[400px] bg-bg-dark/50",children:e.jsx(Zo,{deviceId:t,session:s.selectedSession,frames:s.frames,loading:s.framesLoading,onLoadMore:l,hasMore:s.frames.length<s.totalFrames,frameDirection:s.frameDirection,onFrameDirectionChange:c})})]}),e.jsx(jt,{isOpen:n,onClose:()=>a(!1),onConfirm:i,title:"删除 WebSocket 会话",message:`确定要删除选中的 ${s.selectedIds.size} 个 WebSocket 会话吗？

此操作将同时删除这些会话的所有帧数据，不可恢复。`,confirmText:"确认删除",cancelText:"取消",type:"danger"})]})}function Wl({deviceId:t,mockStore:s}){const r=u.useCallback(()=>{s.openEditor()},[]),n=u.useCallback(l=>{s.openEditor(l)},[]),a=u.useCallback(l=>{s.deleteRule(t,l)},[t]),i=u.useCallback(l=>{s.toggleRuleEnabled(t,l)},[t]),o=u.useCallback(async l=>{s.editingRule?await s.updateRule(t,s.editingRule.id,l):await s.createRule(t,l)},[t,s.editingRule]);return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-border bg-bg-dark/50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ce,{size:24,className:"text-text-primary"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-text-primary",children:"Mock 规则"}),e.jsx("p",{className:"text-xs text-text-muted",children:"模拟接口响应数据"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs text-text-muted bg-bg-light px-2 py-1 rounded-lg",children:[s.rules.length," 条规则"]}),e.jsx("button",{onClick:r,className:"btn btn-primary text-sm",children:"+ 新建规则"})]})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsx(il,{rules:s.rules,loading:s.loading,onEdit:n,onDelete:a,onToggleEnabled:i,onCreateNew:r})}),e.jsx(Sr,{rule:s.editingRule,isOpen:s.isEditorOpen,onClose:s.closeEditor,onSave:o,loading:s.loading,httpOnly:!0})]})}function Ul({device:t,style:s}){const r=At(),{favoriteDeviceIds:n,toggleFavorite:a,removeDevice:i}=pt(),o=n.has(t.deviceId),l=!t.isOnline,c=x=>{x.stopPropagation(),a(t.deviceId)},d=async x=>{x.stopPropagation(),confirm(`确定要移除设备 "${t.deviceName}" 吗？`)&&await i(t.deviceId)};return e.jsx("div",{onClick:()=>r(`/device/${t.deviceId}`),className:b("glass-card p-2.5 cursor-pointer transition-all group animate-fadeIn card-interactive",t.isOnline?"hover:border-primary":"opacity-60 hover:opacity-80"),style:s,children:e.jsxs("div",{className:"flex items-start gap-2.5",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("div",{className:b("w-10 h-10 rounded-lg flex items-center justify-center border border-border",t.isOnline?"bg-primary/20":"bg-bg-medium/50"),children:qt(t.platform)}),e.jsx("span",{className:b("absolute -bottom-0.5 -right-0.5 w-3 h-3 border-2 border-bg-dark rounded-full",t.isOnline?"bg-green-500 status-dot-online":"bg-gray-500")})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-medium text-sm text-text-primary group-hover:text-primary transition-colors truncate",children:t.deviceName}),t.isSimulator&&e.jsx("span",{className:"text-2xs px-1 py-0.5 rounded bg-purple-500/20 text-purple-400 flex-shrink-0",children:"模拟器"}),l&&e.jsx("span",{className:"text-2xs px-1 py-0.5 rounded bg-gray-500/20 text-gray-400 flex-shrink-0",children:"离线"})]}),e.jsxs("p",{className:"text-xs text-text-muted truncate mt-0.5",children:[t.deviceModel," · ",t.platform," ",t.systemVersion]}),e.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5 pt-1.5 border-t border-border",children:[e.jsx("div",{className:"w-4 h-4 rounded overflow-hidden bg-bg-light flex items-center justify-center flex-shrink-0",title:t.appName,children:t.appIcon?e.jsx("img",{src:`data:image/png;base64,${t.appIcon}`,alt:t.appName,className:"w-full h-full object-cover"}):e.jsx(pe,{size:10,className:"text-text-muted"})}),e.jsx("span",{className:"text-xs text-text-secondary truncate",title:`${t.appName} ${t.appVersion}`,children:t.appName}),e.jsx("span",{className:"text-xs text-text-muted/60 truncate flex-shrink-0",children:t.appVersion}),e.jsx("span",{className:"flex-1"}),e.jsx("span",{className:"text-2xs text-text-muted/50 flex-shrink-0",children:vr(t.lastSeenAt)})]})]}),e.jsxs("div",{className:"flex items-center gap-0.5",children:[l&&e.jsx("button",{onClick:d,className:"p-1 rounded transition-all text-red-400/50 opacity-0 group-hover:opacity-100 hover:text-red-400",title:"移除设备",children:e.jsx(Pe,{size:14})}),e.jsx("button",{onClick:c,className:b("p-1 rounded transition-all flex-shrink-0",o?"text-yellow-400 hover:text-yellow-300":"text-text-muted opacity-0 group-hover:opacity-100 hover:text-yellow-400"),title:o?"取消收藏":"收藏设备",children:e.jsx(he,{size:14,filled:o})})]})]})})}function Vl(){const{devices:t,isLoading:s,fetchDevices:r,removeAllOfflineDevices:n}=pt(),{isServerOnline:a}=We(),[i,o]=u.useState("all"),l=t.filter(h=>h.isOnline).length,c=t.filter(h=>!h.isOnline).length,d=u.useMemo(()=>{switch(i){case"online":return t.filter(h=>h.isOnline);case"offline":return t.filter(h=>!h.isOnline);default:return t}},[t,i]);u.useEffect(()=>{r();const h=setInterval(r,5e3);return()=>clearInterval(h)},[r]);const x=async()=>{confirm(`确定要移除所有 ${c} 个离线设备吗？`)&&await n()};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("header",{className:"px-6 py-5 bg-bg-dark border-b border-border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-text-primary",children:"设备列表"}),e.jsxs("p",{className:"text-sm text-text-muted mt-1",children:["管理已连接的调试设备 · ",l," 在线 / ",t.length," 总计"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-0.5 p-0.5 bg-bg-medium rounded-lg border border-border",children:[e.jsxs("button",{onClick:()=>o("all"),className:b("px-3 py-1.5 text-xs font-medium rounded transition-colors",i==="all"?"bg-primary text-bg-darkest":"text-text-secondary hover:text-text-primary hover:bg-bg-light"),children:["全部 (",t.length,")"]}),e.jsxs("button",{onClick:()=>o("online"),className:b("px-3 py-1.5 text-xs font-medium rounded transition-colors",i==="online"?"bg-green-500 text-white":"text-text-secondary hover:text-text-primary hover:bg-bg-light"),children:["在线 (",l,")"]}),e.jsxs("button",{onClick:()=>o("offline"),className:b("px-3 py-1.5 text-xs font-medium rounded transition-colors",i==="offline"?"bg-gray-500 text-white":"text-text-secondary hover:text-text-primary hover:bg-bg-light"),children:["离线 (",c,")"]})]}),c>0&&e.jsxs("button",{onClick:x,className:"btn btn-secondary text-red-400 hover:text-red-300 flex items-center gap-2",children:[e.jsx(Pe,{size:16}),e.jsx("span",{children:"移除离线"})]}),e.jsxs("button",{onClick:r,disabled:s,className:"btn btn-primary disabled:opacity-50 flex items-center gap-2",children:[e.jsx("span",{className:s?"animate-spin":"",children:e.jsx(ft,{size:16})}),e.jsx("span",{children:"刷新"})]})]})]})}),e.jsxs("div",{className:"flex-1 overflow-auto p-6 relative",children:[d.length>0&&a&&e.jsx(Xe,{isLoading:s,text:"刷新设备列表..."}),a?d.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:d.map((h,j)=>e.jsx(Ul,{device:h,style:{animationDelay:`${j*50}ms`}},h.deviceId))}):e.jsx(ql,{isLoading:s,filter:i,totalCount:t.length}):e.jsx(Yl,{onRetry:r,isLoading:s})]})]})}function ql({isLoading:t,filter:s,totalCount:r}){return r>0&&!t?e.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:e.jsxs("div",{className:"glass-card p-12 text-center max-w-md",children:[e.jsx(de,{size:48,className:"mx-auto mb-4 text-text-muted opacity-50"}),e.jsxs("h2",{className:"text-xl font-semibold text-text-primary mb-2",children:["没有",s==="online"?"在线":"离线","设备"]}),e.jsx("p",{className:"text-text-muted",children:s==="online"?"当前没有设备在线":"所有设备都在线"})]})}):e.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:e.jsx("div",{className:"glass-card p-12 text-center max-w-md",children:t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-6 rounded-full bg-bg-light animate-pulse"}),e.jsx("div",{className:"h-6 bg-bg-light rounded w-48 mx-auto mb-3 animate-pulse"}),e.jsx("div",{className:"h-4 bg-bg-light rounded w-64 mx-auto animate-pulse"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-6 rounded-full bg-bg-light flex items-center justify-center text-text-muted",children:e.jsx(de,{size:40})}),e.jsx("h2",{className:"text-lg font-semibold text-text-primary mb-2",children:"暂无在线设备"}),e.jsx("p",{className:"text-sm text-text-muted mb-6",children:"请确保 iOS App 已集成 DebugProbe 并连接到 Debug Hub"}),e.jsxs("div",{className:"text-left bg-bg-medium rounded-xl p-4 text-xs font-mono text-text-secondary overflow-x-auto",children:[e.jsx("p",{className:"text-text-muted mb-2",children:"// 在 AppDelegate 中初始化"}),e.jsxs("p",{children:[e.jsx("span",{className:"text-purple-400",children:"let"})," config = ",e.jsx("span",{className:"text-primary",children:"DebugProbe.Configuration"}),"("]}),e.jsxs("p",{className:"pl-4",children:["hubURL: ",e.jsxs("span",{className:"text-green-400",children:['"ws://',"<","host",">",":","<","port",">",'/debug-bridge"']})]}),e.jsx("p",{children:")"}),e.jsxs("p",{className:"mt-1",children:[e.jsx("span",{className:"text-primary",children:"DebugProbe"}),".shared.start(configuration: config)"]})]})]})})})}function Yl({onRetry:t,isLoading:s}){return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsxs("div",{className:"fixed inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 bg-red-500/5 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-96 h-96 bg-accent-blue/5 rounded-full blur-3xl"})]}),e.jsx("div",{className:"max-w-lg w-full relative",children:e.jsxs("div",{className:"glass-card p-10 text-center",children:[e.jsxs("div",{className:"w-28 h-28 mx-auto mb-8 rounded-full flex items-center justify-center text-5xl relative bg-red-500/10",children:[e.jsx("div",{className:"absolute inset-0 rounded-full animate-ping opacity-25 bg-red-500",style:{animationDuration:"2s"}}),e.jsx("span",{className:"relative z-10",children:e.jsx(nr,{size:48})})]}),e.jsx("h1",{className:"text-3xl font-bold mb-3 text-red-400",children:"服务未启动"}),e.jsx("p",{className:"text-text-secondary mb-10",children:"无法连接到 Debug Hub 服务"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-10",children:[e.jsxs("div",{className:"bg-bg-medium/50 rounded-xl p-4 border border-red-500/30 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Qs,{size:16}),e.jsx("span",{className:"text-xs text-text-muted uppercase tracking-wider",children:"状态"})]}),e.jsx("div",{className:"text-xl font-semibold text-red-400",children:"OFFLINE"})]}),e.jsxs("div",{className:"bg-bg-medium/50 rounded-xl p-4 border border-border transition-all",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(pe,{size:16}),e.jsx("span",{className:"text-xs text-text-muted uppercase tracking-wider",children:"服务"})]}),e.jsx("div",{className:"text-xl font-semibold text-primary",children:"Debug Hub"})]})]}),e.jsxs("div",{className:"text-xs text-text-muted mb-8 p-3 bg-bg-medium/50 rounded-xl",children:[e.jsx("span",{className:"opacity-70",children:"提示:"}),e.jsx("span",{className:"ml-2 text-text-secondary",children:"请确保 Debug Hub 服务已启动并运行在正确的端口上"})]}),e.jsxs("button",{onClick:t,disabled:s,className:"btn btn-primary flex items-center gap-2 mx-auto",children:[e.jsx("span",{className:s?"animate-spin":"",children:e.jsx(ft,{size:16})}),e.jsx("span",{children:s?"连接中...":"重试连接"})]})]})})]})}const Gl=[{icon:e.jsx(de,{size:20}),title:"设备管理",endpoints:[{method:"GET",path:"/api/devices",description:"获取在线设备列表"},{method:"GET",path:"/api/devices/:deviceId",description:"获取设备详情"},{method:"POST",path:"/api/devices/:deviceId/control/toggle-capture",description:"切换捕获状态"},{method:"DELETE",path:"/api/devices/:deviceId/data",description:"清空设备数据"}]},{icon:e.jsx(me,{size:20}),title:"HTTP 事件",endpoints:[{method:"GET",path:"/api/devices/:deviceId/http-events",description:"获取 HTTP 事件列表"},{method:"GET",path:"/api/devices/:deviceId/http-events/:eventId",description:"获取 HTTP 事件详情"},{method:"POST",path:"/api/devices/:deviceId/http-events/:eventId/replay",description:"重放 HTTP 请求"},{method:"PUT",path:"/api/devices/:deviceId/http-events/:eventId/favorite",description:"收藏/取消收藏"}]},{icon:e.jsx(je,{size:20}),title:"日志事件",endpoints:[{method:"GET",path:"/api/devices/:deviceId/log-events",description:"获取日志事件列表"}]},{icon:e.jsx(ke,{size:20}),title:"WebSocket 会话",endpoints:[{method:"GET",path:"/api/devices/:deviceId/ws-sessions",description:"获取 WebSocket 会话列表"},{method:"GET",path:"/api/devices/:deviceId/ws-sessions/:sessionId/frames",description:"获取 WebSocket 帧数据"}]},{icon:e.jsx(ce,{size:20}),title:"Mock 规则",endpoints:[{method:"GET",path:"/api/devices/:deviceId/mock-rules",description:"获取 Mock 规则列表"},{method:"POST",path:"/api/devices/:deviceId/mock-rules",description:"创建 Mock 规则"},{method:"PUT",path:"/api/devices/:deviceId/mock-rules/:ruleId",description:"更新 Mock 规则"},{method:"DELETE",path:"/api/devices/:deviceId/mock-rules/:ruleId",description:"删除 Mock 规则"}]},{icon:e.jsx(Ht,{size:20}),title:"断点调试",endpoints:[{method:"GET",path:"/api/devices/:deviceId/breakpoints",description:"获取断点规则列表"},{method:"POST",path:"/api/devices/:deviceId/breakpoints",description:"创建断点规则"}]},{icon:e.jsx(Ve,{size:20}),title:"故障注入",endpoints:[{method:"GET",path:"/api/devices/:deviceId/chaos-rules",description:"获取故障注入规则"},{method:"POST",path:"/api/devices/:deviceId/chaos-rules",description:"创建故障注入规则"}]},{icon:e.jsx(Bn,{size:20}),title:"数据导出",endpoints:[{method:"GET",path:"/api/export/har/:deviceId",description:"导出 HAR 文件"},{method:"GET",path:"/api/devices/:deviceId/http-events/:eventId/curl",description:"导出 cURL 命令"}]},{icon:e.jsx(Gn,{size:20}),title:"WebSocket 连接",endpoints:[{method:"WS",path:"/debug-bridge",description:"iOS 设备连接端点"},{method:"WS",path:"/ws/live",description:"实时事件流订阅"}]},{icon:e.jsx(Ce,{size:20}),title:"数据管理",endpoints:[{method:"GET",path:"/api/cleanup/config",description:"获取清理配置"},{method:"PUT",path:"/api/cleanup/config",description:"更新清理配置"},{method:"POST",path:"/api/cleanup/run",description:"执行过期数据清理"},{method:"POST",path:"/api/cleanup/truncate",description:"清空所有数据（危险）"}]},{icon:e.jsx(Ke,{size:20}),title:"系统状态",endpoints:[{method:"GET",path:"/api/health",description:"健康检查"}]}],Jl={GET:"bg-green-500/20 text-green-400",POST:"bg-blue-500/20 text-blue-400",PUT:"bg-yellow-500/20 text-yellow-400",DELETE:"bg-red-500/20 text-red-400",WS:"bg-purple-500/20 text-purple-400"};function Ql(){return e.jsx("div",{className:"h-full overflow-auto",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-6 py-12",children:[e.jsxs("header",{className:"text-center mb-16",children:[e.jsx("div",{className:"flex justify-center mb-4 text-primary",children:e.jsx(Rt,{size:64})}),e.jsx("h1",{className:"text-4xl font-bold mb-2 text-text-primary",children:"Debug Hub API"}),e.jsx("p",{className:"text-text-secondary text-lg mb-4",children:"网络和日志一体化调试平台"}),e.jsx("span",{className:"inline-block px-4 py-1 bg-bg-light rounded text-sm text-primary border border-border",children:"1.0.0"}),e.jsxs("nav",{className:"flex justify-center gap-4 mt-6",children:[e.jsxs(ye,{to:"/",className:"flex items-center text-text-secondary hover:text-primary transition-colors px-4 py-2 rounded hover:bg-bg-light",children:[e.jsx(de,{size:16,className:"mr-2"}),"设备列表"]}),e.jsxs(ye,{to:"/health",className:"flex items-center text-text-secondary hover:text-primary transition-colors px-4 py-2 rounded hover:bg-bg-light",children:[e.jsx(Ke,{size:16,className:"mr-2"}),"健康检查"]})]})]}),e.jsx("div",{className:"space-y-6",children:Gl.map(t=>e.jsxs("section",{className:"bg-bg-dark border border-border rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 bg-bg-medium border-b border-border flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:t.icon}),e.jsx("h2",{className:"text-lg font-semibold",children:t.title})]}),e.jsx("div",{className:"p-2",children:t.endpoints.map(s=>e.jsxs("div",{className:"flex items-center gap-4 px-4 py-3 rounded-lg hover:bg-bg-medium transition-colors",children:[e.jsx("span",{className:`font-mono text-xs font-bold px-2 py-1 rounded min-w-[60px] text-center ${Jl[s.method]}`,children:s.method}),e.jsx("code",{className:"font-mono text-sm text-text-primary flex-1",children:s.path}),e.jsx("span",{className:"text-text-secondary text-sm",children:s.description})]},`${s.method}-${s.path}`))})]},t.title))}),e.jsxs("section",{className:"mt-8 bg-bg-dark border border-border rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 bg-bg-medium border-b border-border flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:e.jsx(Jn,{size:20})}),e.jsx("h2",{className:"text-lg font-semibold",children:"快速开始"})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-text-secondary text-sm mb-2",children:"获取设备列表："}),e.jsx("pre",{className:"bg-bg-darkest border border-border rounded-lg p-4 font-mono text-sm overflow-x-auto",children:e.jsxs("code",{children:[e.jsx("span",{className:"text-info",children:"curl"})," ",e.jsx("span",{className:"text-green-400",children:"http://localhost:8081/api/devices"})]})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-text-secondary text-sm mb-2",children:"连接实时事件流："}),e.jsx("pre",{className:"bg-bg-darkest border border-border rounded-lg p-4 font-mono text-sm overflow-x-auto",children:e.jsxs("code",{children:[e.jsx("span",{className:"text-info",children:"websocat"})," ",e.jsx("span",{className:"text-green-400",children:"ws://localhost:8081/ws/live"})]})})]})]})]}),e.jsx("footer",{className:"text-center mt-12 py-8 text-text-secondary text-sm",children:e.jsx("p",{children:"Debug Hub © 2025 Sun. All rights reserved."})})]})})}function Kl(t){const s=Math.floor(t/86400),r=Math.floor(t%86400/3600),n=Math.floor(t%3600/60),a=t%60,i=o=>o.toString().padStart(2,"0");return s>0?`${s}天 ${i(r)}:${i(n)}:${i(a)}`:`${i(r)}:${i(n)}:${i(a)}`}function Xl(t){try{return new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return t}}function Zl(){var x;const[t,s]=u.useState(null),[r,n]=u.useState(null),[a,i]=u.useState(new Date),[o,l]=u.useState("--:--:--"),c=u.useRef(null);u.useEffect(()=>{async function h(){try{const y=await fetch("/api/health",{headers:{Accept:"application/json"}});if(!y.ok)throw new Error("Failed to fetch health status");const p=await y.json();if(s(p),n(null),p.startTime){const g=new Date(p.startTime);c.current=g.getTime()}}catch(y){n(y instanceof Error?y.message:"Unknown error")}}h();const j=setInterval(h,3e4);return()=>clearInterval(j)},[]),u.useEffect(()=>{const h=()=>{if(i(new Date),c.current){const y=Math.floor((Date.now()-c.current)/1e3);l(Kl(Math.max(0,y)))}};h();const j=setInterval(h,1e3);return()=>clearInterval(j)},[]);const d=!r&&(t==null?void 0:t.status)==="healthy";return e.jsxs("div",{className:"h-full overflow-auto flex items-center justify-center p-6",children:[e.jsxs("div",{className:"fixed inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 bg-primary/5 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-96 h-96 bg-accent-blue/5 rounded-full blur-3xl"})]}),e.jsxs("div",{className:"max-w-lg w-full relative",children:[e.jsxs("div",{className:"glass-card p-10 text-center",children:[e.jsxs("div",{className:`w-28 h-28 mx-auto mb-8 rounded-full flex items-center justify-center text-5xl relative ${r?"bg-red-500/10":"bg-green-500/10"}`,children:[e.jsx("div",{className:`absolute inset-0 rounded-full animate-ping opacity-25 ${r?"bg-red-500":"bg-green-500"}`,style:{animationDuration:"2s"}}),e.jsx("span",{className:"relative z-10",children:r?e.jsx(nr,{size:48}):e.jsx(Yn,{size:48})})]}),e.jsx("h1",{className:`text-3xl font-bold mb-3 ${r?"text-red-400":"text-green-400"}`,children:r?"服务异常":"服务正常运行"}),e.jsx("p",{className:"text-text-secondary mb-10",children:r||"Debug Hub 所有系统运行正常"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-10",children:[e.jsx(it,{label:"状态",value:((x=t==null?void 0:t.status)==null?void 0:x.toUpperCase())||"--",icon:e.jsx(Qs,{size:16}),highlight:d}),e.jsx(it,{label:"版本",value:(t==null?void 0:t.version)||"--",icon:e.jsx(pe,{size:16})}),e.jsx(it,{label:"运行时间",value:o,icon:e.jsx(ot,{size:16}),mono:!0}),e.jsx(it,{label:"当前时间",value:a.toLocaleTimeString("zh-CN"),icon:e.jsx(ot,{size:16}),mono:!0})]}),(t==null?void 0:t.startTime)&&e.jsxs("div",{className:"text-xs text-text-muted mb-8 p-3 bg-bg-medium/50 rounded-xl",children:[e.jsx("span",{className:"opacity-70",children:"服务启动于:"}),e.jsx("span",{className:"ml-2 font-mono text-text-secondary",children:Xl(t.startTime)})]}),e.jsxs("nav",{className:"flex justify-center gap-3",children:[e.jsxs(ye,{to:"/",className:"btn btn-secondary flex items-center gap-2",children:[e.jsx(de,{size:16})," 设备列表"]}),e.jsxs(ye,{to:"/api-docs",className:"btn btn-secondary flex items-center gap-2",children:[e.jsx(Ks,{size:16})," API 文档"]})]})]}),e.jsx("p",{className:"text-center mt-8 text-text-muted text-sm",children:e.jsx("span",{className:"opacity-70",children:"Debug Hub © 2025 Sun"})})]})]})}function it({label:t,value:s,icon:r,mono:n=!1,highlight:a=!1}){return e.jsxs("div",{className:`bg-bg-medium/50 rounded-xl p-4 border border-border transition-all ${a?"border-green-500/30":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r,e.jsx("span",{className:"text-xs text-text-muted uppercase tracking-wider",children:t})]}),e.jsx("div",{className:`text-xl font-semibold text-primary ${n?"font-mono":""}`,children:s})]})}function ec(){const{rules:t,fetchRules:s,createOrUpdateRule:r,deleteRule:n,isLoading:a}=Oe(),[i,o]=u.useState(null),[l,c]=u.useState(!1);u.useEffect(()=>{s()},[]);const d=()=>{o({name:"",matchType:"domain",matchValue:"",action:"highlight",isEnabled:!0,priority:0}),c(!0)},x=p=>{o({...p}),c(!0)},h=async()=>{if(i)try{await r(i),c(!1),o(null)}catch(p){console.error("Failed to save rule",p)}},j=async p=>{confirm("确定要删除这条规则吗？")&&await n(p)},y=async p=>{await r({...p,isEnabled:!p.isEnabled})};return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("header",{className:"px-6 py-4 bg-bg-dark border-b border-border",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(ye,{to:"/",className:"flex items-center gap-2 text-text-secondary hover:text-text-primary transition-colors group",children:[e.jsx("span",{className:"group-hover:-translate-x-1 transition-transform",children:e.jsx(Wt,{size:16})}),e.jsx("span",{children:"返回"})]}),e.jsx("div",{className:"h-6 w-px bg-border"}),e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center border border-border text-primary",children:e.jsx(Hn,{size:20})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-text-primary",children:"流量规则"}),e.jsx("p",{className:"text-xs text-text-muted",children:"管理域名高亮、隐藏等过滤规则"})]})]}),e.jsx("button",{onClick:d,className:"btn btn-primary",children:"+ 新建规则"})]})}),e.jsx("div",{className:"flex-1 overflow-auto p-6",children:a?e.jsx("div",{className:"flex items-center justify-center h-full text-text-muted",children:"加载中..."}):t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted",children:[e.jsx("div",{className:"mb-4 opacity-50",children:e.jsx(je,{size:48})}),e.jsx("h2",{className:"text-lg font-medium text-text-primary mb-2",children:"暂无规则"}),e.jsx("p",{className:"text-sm mb-4",children:'点击"新建规则"添加流量过滤规则'}),e.jsx("button",{onClick:d,className:"btn btn-primary",children:"+ 新建规则"})]}):e.jsx("div",{className:"space-y-3",children:t.map(p=>e.jsx("div",{className:b("p-4 bg-bg-dark border border-border rounded-xl transition-all",!p.isEnabled&&"opacity-50"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>y(p),className:b("w-10 h-6 rounded-full transition-colors relative",p.isEnabled?"bg-primary":"bg-bg-light"),children:e.jsx("span",{className:b("absolute top-1 w-4 h-4 bg-white rounded-full transition-transform",p.isEnabled?"left-5":"left-1")})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-text-primary",children:p.name||p.matchValue}),e.jsxs("div",{className:"text-xs text-text-muted",children:[p.matchType==="domain"&&"域名匹配",p.matchType==="urlRegex"&&"正则匹配",p.matchType==="header"&&"请求头匹配",": ",e.jsx("code",{className:"text-text-secondary",children:p.matchValue})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:b("badge",p.action==="highlight"&&"badge-warning",p.action==="hide"&&"badge-danger",p.action==="mark"&&"badge-info"),children:[p.action==="highlight"&&e.jsxs(e.Fragment,{children:[e.jsx(he,{size:14,filled:!0,className:"mr-1"})," 高亮"]}),p.action==="hide"&&e.jsxs(e.Fragment,{children:[e.jsx(Pe,{size:14,className:"mr-1"})," 隐藏"]}),p.action==="mark"&&e.jsxs(e.Fragment,{children:[e.jsx(Vt,{size:14,className:"mr-1"})," 标记"]})]}),e.jsx("button",{onClick:()=>x(p),className:"btn btn-ghost px-3",title:"编辑",children:e.jsx(Me,{size:16})}),e.jsx("button",{onClick:()=>p.id&&j(p.id),className:"btn btn-ghost px-3 text-red-400 hover:bg-red-500/10",title:"删除",children:e.jsx(Ce,{size:16})})]})]})},p.id))})}),l&&i&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40",onClick:()=>c(!1)}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-bg-dark border border-border rounded-2xl shadow-2xl w-full max-w-md",children:[e.jsx("div",{className:"p-4 border-b border-border",children:e.jsx("h2",{className:"text-lg font-semibold text-text-primary",children:i.id?"编辑规则":"新建规则"})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"规则名称"}),e.jsx("input",{type:"text",value:i.name||"",onChange:p=>o({...i,name:p.target.value}),placeholder:"例如：隐藏广告域名",className:"w-full px-3 py-2 bg-bg-medium border border-border rounded-lg text-text-primary focus:outline-none focus:border-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"匹配类型"}),e.jsxs("select",{value:i.matchType||"domain",onChange:p=>o({...i,matchType:p.target.value}),className:"w-full px-3 py-2 bg-bg-medium border border-border rounded-lg text-text-primary focus:outline-none focus:border-primary",children:[e.jsx("option",{value:"domain",children:"域名"}),e.jsx("option",{value:"urlRegex",children:"URL 正则"}),e.jsx("option",{value:"header",children:"请求头"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"匹配值"}),e.jsx("input",{type:"text",value:i.matchValue||"",onChange:p=>o({...i,matchValue:p.target.value}),placeholder:i.matchType==="domain"?"example.com":".*\\.example\\.com",className:"w-full px-3 py-2 bg-bg-medium border border-border rounded-lg text-text-primary focus:outline-none focus:border-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"动作"}),e.jsxs("select",{value:i.action||"highlight",onChange:p=>o({...i,action:p.target.value}),className:"w-full px-3 py-2 bg-bg-medium border border-border rounded-lg text-text-primary focus:outline-none focus:border-primary",children:[e.jsx("option",{value:"highlight",children:"高亮显示"}),e.jsx("option",{value:"hide",children:"隐藏"}),e.jsx("option",{value:"mark",children:"标记"})]})]})]}),e.jsxs("div",{className:"p-4 border-t border-border flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>c(!1),className:"btn btn-ghost",children:"取消"}),e.jsx("button",{onClick:h,className:"btn btn-primary",disabled:!i.matchValue,children:"保存"})]})]})})]})]})}function tc(){const{toasts:t,remove:s}=gt();return t.length===0?null:e.jsx("div",{className:"fixed bottom-4 right-4 z-[9999] flex flex-col gap-2",children:t.map(r=>e.jsxs("div",{className:b("px-4 py-3 rounded-lg shadow-lg text-sm font-medium flex items-center gap-2 min-w-[200px] max-w-[400px] animate-slide-in-up",{"bg-green-500/90 text-white":r.type==="success","bg-red-500/90 text-white":r.type==="error","bg-blue-500/90 text-white":r.type==="info","bg-yellow-500/90 text-black":r.type==="warning"}),onClick:()=>s(r.id),children:[e.jsxs("span",{className:"text-base",children:[r.type==="success"&&"✓",r.type==="error"&&"✕",r.type==="info"&&"ℹ",r.type==="warning"&&"⚠"]}),e.jsx("span",{children:r.message})]},r.id))})}function sc({isRefreshing:t}){const[s,r]=u.useState(!1),[n,a]=u.useState(0);return u.useEffect(()=>{if(t){r(!0),a(0);const i=setInterval(()=>{a(o=>o>=90?o:o+Math.random()*10)},100);return()=>clearInterval(i)}else{a(100);const i=setTimeout(()=>{r(!1),a(0)},300);return()=>clearTimeout(i)}},[t]),s?e.jsx("div",{className:"fixed top-0 left-0 right-0 z-[200] h-1 bg-primary/10",children:e.jsx("div",{className:"h-full bg-primary transition-all duration-200 ease-out",style:{width:`${n}%`}})}):null}const rc=["/api-docs","/health"];function nc(){const t=Rs(),s=!rc.includes(t.pathname),[r,n]=u.useState(!0);return u.useEffect(()=>{n(!0);const a=setTimeout(()=>n(!1),500);return()=>clearTimeout(a)},[t.pathname]),e.jsxs("div",{className:"flex h-screen bg-bg-darkest text-text-primary",children:[e.jsx(sc,{isRefreshing:r}),s&&e.jsx(ka,{}),e.jsx("main",{className:"flex-1 flex flex-col overflow-hidden",children:e.jsx("div",{className:"flex-1 overflow-hidden relative",children:e.jsxs(Fr,{children:[e.jsx(ze,{path:"/",element:e.jsx(Vl,{})}),e.jsx(ze,{path:"/device/:deviceId",element:e.jsx(Fl,{})}),e.jsx(ze,{path:"/rules",element:e.jsx(ec,{})}),e.jsx(ze,{path:"/api-docs",element:e.jsx(Ql,{})}),e.jsx(ze,{path:"/health",element:e.jsx(Zl,{})})]})})})]})}function ac(){const{theme:t,setTheme:s}=bt();return u.useEffect(()=>{s(t)},[]),u.useEffect(()=>(Vr(),()=>qr()),[]),e.jsxs(Pr,{children:[e.jsx(nc,{}),e.jsx(tc,{})]})}Lt.createRoot(document.getElementById("root")).render(e.jsx(zr.StrictMode,{children:e.jsx(ac,{})}));
