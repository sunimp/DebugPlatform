# Debug Platform

ä¸€å¥—ä¸“ä¸ºå†…éƒ¨ iOS App è®¾è®¡çš„è°ƒè¯•ç³»ç»Ÿï¼Œç±»ä¼¼äºå†…éƒ¨ç‰ˆçš„ Proxy Tool + Log Viewerã€‚

> **å½“å‰ç‰ˆæœ¬**: v1.2.0 | [æ›´æ–°æ—¥å¿—](docs/CHANGELOG.md) | [å¼€å‘è·¯çº¿å›¾](docs/ROADMAP.md)

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒè°ƒè¯•èƒ½åŠ›
- ğŸŒ **HTTP/HTTPS æ•è·** - URLProtocol è‡ªåŠ¨æ‹¦æˆª + URLSessionTaskMetrics æ€§èƒ½æ—¶é—´çº¿
- ğŸ”Œ **WebSocket æ•è·** - è¿æ¥çº§ç›‘æ§ + æ¶ˆæ¯å¸§å®Œæ•´å†…å®¹æŸ¥çœ‹ï¼ˆText/JSON/Hex/Base64ï¼‰
- ğŸ“ **æ—¥å¿—æ•è·** - CocoaLumberjack + os_log æ”¯æŒ
- ğŸ­ **Mock è§„åˆ™å¼•æ“** - HTTP/WS è¯·æ±‚æ‹¦æˆªä¸å“åº”æ¨¡æ‹Ÿ
- ğŸ”„ **è¯·æ±‚é‡æ”¾** - ä¸€é”®é‡æ”¾å†å²è¯·æ±‚
- â¸ï¸ **æ–­ç‚¹è°ƒè¯•** - è¯·æ±‚/å“åº”æ‹¦æˆªä¸ä¿®æ”¹
- ğŸ’¥ **æ•…éšœæ³¨å…¥** - å»¶è¿Ÿã€è¶…æ—¶ã€é”™è¯¯ç æ³¨å…¥

### æ•°æ®åˆ†æ
- ğŸ” **é«˜çº§æœç´¢è¯­æ³•** - `method:POST status:4xx duration:>500ms`
- ğŸ“Š **è¯·æ±‚ Diff å¯¹æ¯”** - å¹¶æ’å¯¹æ¯”ä¸¤ä¸ªè¯·æ±‚å·®å¼‚
- ğŸ“¦ **Protobuf è§£æ** - Wire Format è‡ªåŠ¨è§£æ
- ï¿½ï¿½ï¸ **å›¾ç‰‡å“åº”é¢„è§ˆ** - æ£€æµ‹å›¾ç‰‡ç±»å‹å¹¶å†…è”æ¸²æŸ“
- â±ï¸ **æ€§èƒ½æ—¶é—´çº¿** - DNS/TCP/TLS/TTFB ç€‘å¸ƒå›¾

### æ•°æ®å¯¼å‡º
- ğŸ“‹ **cURL å¯¼å‡º** - ç”Ÿæˆå¯å¤åˆ¶çš„ cURL å‘½ä»¤
- ğŸ“ **HAR å¯¼å‡º** - HTTP Archive 1.2 æ ¼å¼

### ç”¨æˆ·ä½“éªŒ
- ğŸŒ™ **æ·±è‰²/æµ…è‰²ä¸»é¢˜** - æ”¯æŒè·Ÿéšç³»ç»Ÿ
- âŒ¨ï¸ **é”®ç›˜å¿«æ·é”®** - å…¨å±€å¿«æ·é”®æ”¯æŒ
- â­ **è¯·æ±‚æ”¶è—** - æ”¶è—é‡è¦è¯·æ±‚ï¼Œé˜²æ­¢è¢«æ¸…ç†
- ğŸ“¦ **æ‰¹é‡æ“ä½œ** - å¤šé€‰ + æ‰¹é‡åˆ é™¤/æ”¶è—/å¯¼å‡º
- ğŸ§¹ **è‡ªåŠ¨æ¸…ç†** - å¯é…ç½®çš„æ•°æ®è¿‡æœŸç­–ç•¥

### å¯é æ€§
- ğŸ’¾ **äº‹ä»¶æŒä¹…åŒ–** - æ–­çº¿æ—¶æœ¬åœ° SQLite ç¼“å­˜ï¼Œé‡è¿åè‡ªåŠ¨æ¢å¤
- ğŸ˜ **PostgreSQL æ”¯æŒ** - ç”Ÿäº§ç¯å¢ƒé«˜å¹¶å‘æ•°æ®åº“
- âš™ï¸ **è¿è¡Œæ—¶é…ç½®** - åŠ¨æ€ä¿®æ”¹ Hub åœ°å€ï¼Œæ— éœ€é‡æ–°ç¼–è¯‘

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          iOS App                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                     iOS Probe SDK                       â”‚   â”‚
â”‚   â”‚   NetworkInstrumentation â†’ DebugEventBus â†’ BridgeClient â”‚   â”‚
â”‚   â”‚            â†“ æ–­çº¿æ—¶                                     â”‚   â”‚
â”‚   â”‚   EventPersistenceQueue (SQLite)                        â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚ WebSocket
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Debug Hub (Vapor)                            â”‚
â”‚   WebSocket Handlers â†’ Services â†’ Controllers â†’ PostgreSQL      â”‚
â”‚                           â†“                                     â”‚
â”‚                    Public/ (WebUI é™æ€èµ„æº)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚ HTTP + WebSocket
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Web UI (React + TypeScript)                     â”‚
â”‚   DeviceListPage â”‚ DeviceDetailPage â”‚ ApiDocsPage â”‚ HealthPage  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨ Debug Hub

```bash
cd DebugPlatform/DebugHub

# ä¸€é”®éƒ¨ç½²ï¼ˆPostgreSQL + Releaseï¼‰
./deploy.sh

# æˆ–ä½¿ç”¨ SQLiteï¼ˆé›¶é…ç½®ï¼‰
./deploy.sh --sqlite

# åŒæ—¶æ„å»º WebUI
./deploy.sh --with-webui
```

æœåŠ¡å¯åŠ¨åï¼š
- Web UI: http://localhost:8081
- API æ–‡æ¡£: http://localhost:8081/api-docs
- å¥åº·æ£€æŸ¥: http://localhost:8081/health

### 2. iOS App é›†æˆ

å°† `iOSProbe/Sources/` æ·»åŠ åˆ° Xcode é¡¹ç›®ï¼š

```swift
#if !APPSTORE
import DebugProbe

func setupDebugProbe() {
    guard DebugProbeSettings.shared.isEnabled else { return }
    
    var config = DebugProbe.Configuration(
        hubURL: DebugProbeSettings.shared.hubURL,
        token: DebugProbeSettings.shared.token
    )
    config.enablePersistence = true
    
    DebugProbe.shared.start(configuration: config)
}
#endif
```

SDK é»˜è®¤è‡ªåŠ¨æ‹¦æˆªæ‰€æœ‰ HTTP è¯·æ±‚ï¼ˆMethod Swizzlingï¼‰ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚

### 3. å¼€å‘æ¨¡å¼

```bash
# å‰ç«¯å¼€å‘æœåŠ¡å™¨
cd WebUI && npm run dev

# æ„å»ºå¹¶éƒ¨ç½²åˆ° DebugHub
npm run deploy
```

---

## ğŸ“¡ API å‚è€ƒ

è¯¦è§ http://localhost:8081/api-docs

### ä¸»è¦ç«¯ç‚¹

| ç«¯ç‚¹ | è¯´æ˜ |
|------|------|
| `GET /api/devices` | è·å–åœ¨çº¿è®¾å¤‡åˆ—è¡¨ |
| `GET /api/devices/{id}/http` | æŸ¥è¯¢ HTTP äº‹ä»¶ |
| `GET /api/devices/{id}/ws-sessions` | æŸ¥è¯¢ WebSocket ä¼šè¯ |
| `GET /api/devices/{id}/logs` | æŸ¥è¯¢æ—¥å¿—äº‹ä»¶ |
| `POST /api/devices/{id}/mock` | ç®¡ç† Mock è§„åˆ™ |
| `POST /api/devices/{id}/breakpoints` | ç®¡ç†æ–­ç‚¹è§„åˆ™ |
| `POST /api/devices/{id}/chaos` | ç®¡ç†æ•…éšœæ³¨å…¥è§„åˆ™ |

### WebSocket ç«¯ç‚¹

| ç«¯ç‚¹ | è¯´æ˜ |
|------|------|
| `/debug-bridge` | iOS è®¾å¤‡è¿æ¥ |
| `/ws/live?deviceId=xxx` | Web UI å®æ—¶äº‹ä»¶æµ |

---

## âŒ¨ï¸ é”®ç›˜å¿«æ·é”®

| å¿«æ·é”® | åŠŸèƒ½ |
|--------|------|
| `âŒ˜K` | æœç´¢ |
| `âŒ˜R` | åˆ·æ–° |
| `âŒ˜T` | åˆ‡æ¢ä¸»é¢˜ |
| `âŒ˜/` | å¿«æ·é”®å¸®åŠ© |
| `F` | æ”¶è— |
| `Del` | åˆ é™¤é€‰ä¸­ |

---

## ğŸ”§ ç¯å¢ƒå˜é‡

| å˜é‡ | é»˜è®¤å€¼ | è¯´æ˜ |
|-----|-------|------|
| `DATABASE_MODE` | `postgres` | æ•°æ®åº“æ¨¡å¼ï¼š`sqlite` æˆ– `postgres` |
| `POSTGRES_HOST` | `localhost` | PostgreSQL ä¸»æœº |
| `POSTGRES_PORT` | `5432` | PostgreSQL ç«¯å£ |
| `POSTGRES_USER` | `debug_hub` | PostgreSQL ç”¨æˆ· |
| `POSTGRES_PASSWORD` | `debug_hub_password` | PostgreSQL å¯†ç  |
| `POSTGRES_DB` | `debug_hub` | PostgreSQL æ•°æ®åº“å |
| `DEBUG_HUB_TOKEN` | - | è®¾å¤‡è¿æ¥è®¤è¯ Token |

---

## ğŸ”’ å®‰å…¨æ€§

1. **Token è®¤è¯**: Debug Bridge è¿æ¥éœ€è¦æœ‰æ•ˆ Token
2. **æ¡ä»¶ç¼–è¯‘**: ä½¿ç”¨ `#if !APPSTORE` ä¿æŠ¤è°ƒè¯•ä»£ç 
3. **å†…ç½‘éƒ¨ç½²**: Debug Hub å»ºè®®ä»…åœ¨å†…ç½‘ä½¿ç”¨
4. **è‡ªåŠ¨æ¸…ç†**: é»˜è®¤ 3 å¤©è‡ªåŠ¨æ¸…ç†ï¼Œæ”¶è—è¯·æ±‚é™¤å¤–

---

## ğŸ“ License

This project is licensed under the [MIT License](LICENSE).
